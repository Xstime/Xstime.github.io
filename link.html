<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>由此出发🛫</title>
    <link rel="icon" type="image/png" href="touxiang.png">   
    <link rel="stylesheet" href="styles/variables.css">
    <link rel="stylesheet" href="styles/base.css">
    <link rel="stylesheet" href="styles/components.css">
    <link rel="stylesheet" href="styles/layout.css">
    <link rel="stylesheet" href="styles/animations.css">
    <link rel="stylesheet" href="styles/link.css">
</head>
<body>

    <a href="index.html" class="fixed-button back-button">←</a>
    <button class="fixed-button theme-toggle" onclick="toggleTheme()">🌗</button>
    <a href="http://192.168.5.1/cgi-bin/luci/" target="_blank" class="fixed-button router-button">🛜</a>

    <!-- 主内容容器 - Main Content Container -->
    <div class="main-container">
        
        <!-- 内容卡片1：由此出发 - Content Card 1: Launch Pad -->
        <div id="content-home" class="content-card active">
            <div class="container">
                <h1 class="main-title">由此出发</h1>
                <div id="link-list"></div>
            </div>
        </div>

        <!-- 内容卡片2：搜索发现 - Content Card 2: Search & Discovery -->
        <div id="content-search" class="content-card">
            <div class="container">
                <h1>学术资源</h1>
                <div class="search-content">
                    <div class="search-box">
                        <input type="text" id="search-input" placeholder="搜索学术数据库、论文或工具..." class="search-input">
                        <button class="search-button">🔍</button>
                    </div>
                    <div class="search-suggestions">
                        <h3>常用学术标签</h3>
                        <div class="suggestion-tags">
                            <span class="tag">论文检索</span>
                            <span class="tag">学术数据库</span>
                            <span class="tag">文献管理</span>
                            <span class="tag">学术写作</span>
                            <span class="tag">开源期刊</span>
                        </div>
                    </div>
                    <div class="quick-access">
                        <h3>快速访问</h3>
                        <div class="quick-links">
                            <a href="https://scholar.google.com" target="_blank" class="quick-link">
                                <img src="icon/scholar.google.com.png" alt="Google Scholar" class="quick-icon" 
                                     onerror="this.src='https://www.google.com/s2/favicons?domain=scholar.google.com&sz=32'">
                                <span>Google Scholar</span>
                            </a>
                            <a href="https://www.cnki.net" target="_blank" class="quick-link">
                                <img src="icon/www.cnki.net.png" alt="中国知网" class="quick-icon"
                                    onerror="this.src='https://www.google.com/s2/favicons?domain=www.cnki.net&sz=32'">
                                <span>中国知网</span>
                            </a>
                            <a href="https://www.webofscience.com" target="_blank" class="quick-link">
                                <img src="icon/www.webofscience.com.png" alt="Web of Science" class="quick-icon" 
                                     onerror="this.src='https://www.google.com/s2/favicons?domain=www.webofscience.com&sz=32'">
                                <span>Web of Science</span>
                            </a>
                            <a href="https://www.wanfangdata.com.cn" target="_blank" class="quick-link">
                                <img src="icon/www.wanfangdata.com.cn.png" alt="万方数据" class="quick-icon"
                                     onerror="this.src='https://www.google.com/s2/favicons?domain=www.wanfangdata.com.cn&sz=32'">
                                <span>万方数据</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 内容卡片3：系统设置 - Content Card 3: System Settings -->
        <div id="content-settings" class="content-card">
            <div class="container">
                <h1>系统设置</h1>
                <div class="settings-content">
                    <div class="settings-section">
                        <h3>外观设置</h3>
                        <div class="setting-item">
                            <label>主题模式</label>
                            <div class="theme-selector">
                                <button class="theme-option active" data-theme="auto">🌗 自动</button>
                                <button class="theme-option" data-theme="light">☀️ 明亮</button>
                                <button class="theme-option" data-theme="dark">🌙 深色</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="dock">
        <div class="dock-bubble"></div>
        <a href="#" class="dock-item active" data-content="home">
            <span class="dock-icon">🏠</span>
            <span class="dock-label">主页</span>
        </a>
        <a href="#" class="dock-item" data-content="search">
            <span class="dock-icon">👨‍🎓</span>
            <span class="dock-label">学术</span>
        </a>
        <a href="#" class="dock-item" data-content="settings">
            <span class="dock-icon">⚙️</span>
            <span class="dock-label">设置</span>
        </a>
    </div>

    <script>
        const linkList = document.getElementById('link-list');
        const turbulence = document.getElementById('turbulence');
        let frame = 0;
        let rad = Math.PI / 180;

        function animateTurbulence() {
            const bfx = 0.01 + 0.005 * Math.cos(frame * rad);
            const bfy = 0.01 + 0.005 * Math.sin(frame * rad);
            turbulence.setAttribute('baseFrequency', `${bfx} ${bfy}`);
            frame += 0.5;
            requestAnimationFrame(animateTurbulence);
        }

        // 从 links.json 文件加载链接
        async function loadLinks() {
            try {
                const response = await fetch('./links.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const links = await response.json();
                renderLinks(links);
            } catch (error) {
                console.error('无法加载 links.json 文件:', error);
                linkList.innerHTML = '<p style="text-align:center; color: #ff453a;">加载链接失败。请检查 links.json 文件是否存在且格式正确。</p>';
            }
        }

        // 渲染链接到页面
        function renderLinks(links = []) {
            linkList.innerHTML = '';
            if (links.length === 0) {
                linkList.innerHTML = '<p style="text-align:center;">没有找到链接。</p>';
                return;
            }
            links.forEach(link => {
                const linkItem = document.createElement('a');
                linkItem.href = link.url;
                linkItem.target = '_blank';
                linkItem.className = 'link-item';

                // Create and add the favicon
                const favicon = document.createElement('img');
                favicon.className = 'favicon';
                try {
                    const domain = new URL(link.url).hostname;
                    // 优先从本地 /icon 文件夹加载图标
                    favicon.src = `icon/${domain}.png`;

                    // 如果本地图标加载失败，则回退到从 Google 服务获取
                    favicon.onerror = () => {
                        favicon.src = `https://www.google.com/s2/favicons?domain=${domain}&sz=32`;
                        // 防止回退也失败时进入死循环
                        favicon.onerror = null; 
                    };
                } catch (e) {
                    // 如果 URL 无效，则隐藏图标
                    favicon.style.display = 'none';
                }
                linkItem.appendChild(favicon);
                
                const nameSpan = document.createElement('span');
                nameSpan.textContent = link.name;
                linkItem.appendChild(nameSpan);

                linkList.appendChild(linkItem);
            });
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
        }

        // 标签切换功能 - Tab Switching Functionality
        function switchContent(targetContent) {
            // 获取菜单项顺序映射
            const menuOrder = {
                'home': 0,
                'search': 1,
                'settings': 2
            };
            
            // 获取当前活动的菜单项和内容卡片
            const currentMenuItem = document.querySelector('.dock-item.active');
            const currentContent = currentMenuItem ? currentMenuItem.getAttribute('data-content') : 'home';
            const currentCard = document.getElementById(`content-${currentContent}`);
            
            // 如果目标内容和当前内容相同，不需要切换
            if (currentContent === targetContent) return;
            
            // 比较位置决定动画方向
            const currentIndex = menuOrder[currentContent];
            const targetIndex = menuOrder[targetContent];
            const isMovingRight = targetIndex > currentIndex;
            
            // 为当前卡片添加滑出动画
            if (currentCard) {
                if (isMovingRight) {
                    currentCard.classList.add('exit-left');
                } else {
                    currentCard.classList.add('exit-right');
                }
            }
            
            // 移除菜单项的活动状态
            document.querySelectorAll('.dock-item').forEach(item => {
                item.classList.remove('active');
            });

            // 激活目标内容和菜单项
            const targetCard = document.getElementById(`content-${targetContent}`);
            const targetMenuItem = document.querySelector(`.dock-item[data-content="${targetContent}"]`);
            
            if (targetCard && targetMenuItem) {
                // 延迟显示新内容，让滑出动画先开始
                setTimeout(() => {
                    // 清理所有内容卡片的状态
                    document.querySelectorAll('.content-card').forEach(card => {
                        card.classList.remove('active', 'prev', 'next', 'from-right', 'from-left', 'exit-left', 'exit-right');
                    });
                    
                    // 激活目标卡片
                    targetCard.classList.add('active');
                    
                    // 根据方向添加滑入动画
                    if (isMovingRight) {
                        targetCard.classList.add('from-right');
                    } else {
                        targetCard.classList.add('from-left');
                    }
                    
                    // 动画完成后清理方向类
                    setTimeout(() => {
                        targetCard.classList.remove('from-right', 'from-left');
                    }, 500);
                }, 50);
                
                targetMenuItem.classList.add('active');
                
                // 更新气泡位置
                moveBubbleTo(targetMenuItem);
            }
        }

        // 初始加载
        loadLinks();
        
        // Liquid Dock Logic with Enhanced Effects
        const dock = document.querySelector('.dock');
        const bubble = document.querySelector('.dock-bubble');
        const dockItems = document.querySelectorAll('.dock-item');
        const activeItem = document.querySelector('.dock-item.active');

        // Enhanced bubble movement with elastic easing
        function moveBubbleTo(item) {
            if (!item) return;
            
            const itemRect = item.getBoundingClientRect();
            const dockRect = dock.getBoundingClientRect();
            const left = itemRect.left - dockRect.left;
            const width = itemRect.width;

            // Apply smooth transform with enhanced properties
            bubble.style.left = `${left}px`;
            bubble.style.width = `${width}px`;
            bubble.style.opacity = '1';
            bubble.style.transform = 'scale(1)';
            
            // Add subtle glow effect for active state
            if (item.classList.contains('active')) {
                const isDarkMode = document.body.classList.contains('dark-mode');
                const glowColor = isDarkMode ? 'rgba(10, 132, 255, 0.2)' : 'rgba(0, 113, 227, 0.15)';
                bubble.style.boxShadow = `
                    0 4px 16px rgba(0, 0, 0, 0.1),
                    inset 0 1px 1px rgba(255, 255, 255, 0.3),
                    0 0 20px ${glowColor}
                `;
            } else {
                bubble.style.boxShadow = `
                    0 4px 16px rgba(0, 0, 0, 0.1),
                    inset 0 1px 1px rgba(255, 255, 255, 0.3)
                `;
            }
        }

        // Hide bubble with smooth transition
        function hideBubble() {
            bubble.style.opacity = '0';
            bubble.style.transform = 'scale(0.9)';
        }

        // Set initial position for the bubble on the active item
        if (activeItem) {
            setTimeout(() => {
                moveBubbleTo(activeItem);
            }, 100);
        }

        // Enhanced hover effects with magnetic attraction
        dockItems.forEach((item, index) => {
            // 添加点击事件处理
            item.addEventListener('click', (e) => {
                e.preventDefault();
                const targetContent = item.getAttribute('data-content');
                switchContent(targetContent);
            });

            item.addEventListener('mouseenter', (e) => {
                moveBubbleTo(item);
                
                // Add magnetic effect to neighboring items
                dockItems.forEach((otherItem, otherIndex) => {
                    const distance = Math.abs(index - otherIndex);
                    if (distance === 1) {
                        // Slight attraction for adjacent items
                        otherItem.style.transform = index > otherIndex 
                            ? 'translateX(2px) scale(1.02)' 
                            : 'translateX(-2px) scale(1.02)';
                    } else if (distance > 1) {
                        // Reset for distant items
                        otherItem.style.transform = '';
                    }
                });
            });

            item.addEventListener('mouseleave', () => {
                // Reset all transforms
                dockItems.forEach(otherItem => {
                    otherItem.style.transform = '';
                });
            });

            // Enhanced click effect
            item.addEventListener('mousedown', () => {
                item.style.transform = 'translateY(1px) scale(0.95)';
                bubble.style.transform = 'scale(0.95)';
            });

            item.addEventListener('mouseup', () => {
                item.style.transform = '';
                bubble.style.transform = 'scale(1)';
            });
        });

        // Improved dock hover behavior
        dock.addEventListener('mouseenter', () => {
            dock.style.transform = 'translateX(-50%) translateY(-2px) scale(1.02)';
        });

        dock.addEventListener('mouseleave', () => {
            dock.style.transform = 'translateX(-50%) translateY(0) scale(1)';
            
            // Return bubble to active item with delay for better UX
            setTimeout(() => {
                const currentActiveItem = document.querySelector('.dock-item.active');
                if (currentActiveItem) {
                    moveBubbleTo(currentActiveItem);
                } else {
                    hideBubble();
                }
                
                // Reset all item transforms
                dockItems.forEach(item => {
                    item.style.transform = '';
                });
            }, 150);
        });

        // Add subtle parallax effect on scroll
        let ticking = false;
        function updateDockParallax() {
            const scrolled = window.pageYOffset;
            const parallax = scrolled * 0.02; // Subtle effect
            
            dock.style.transform = `translateX(-50%) translateY(${parallax}px)`;
            ticking = false;
        }

        function requestTick() {
            if (!ticking) {
                requestAnimationFrame(updateDockParallax);
                ticking = true;
            }
        }

        window.addEventListener('scroll', requestTick);

        // Add touch support for mobile devices
        if ('ontouchstart' in window) {
            dockItems.forEach(item => {
                item.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    moveBubbleTo(item);
                    item.style.transform = 'scale(0.95)';
                });

                item.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    item.style.transform = '';
                    // Simulate click
                    const targetContent = item.getAttribute('data-content');
                    switchContent(targetContent);
                });
            });
        }

        // 搜索功能 - Search Functionality
        const searchInput = document.getElementById('search-input');
        const searchButton = document.querySelector('.search-button');
        const suggestionTags = document.querySelectorAll('.tag');

        if (searchButton) {
            searchButton.addEventListener('click', () => {
                const query = searchInput.value.trim();
                if (query) {
                    // 在新标签页中打开Google搜索
                    window.open(`https://www.google.com/search?q=${encodeURIComponent(query)}`, '_blank');
                }
            });
        }

        if (searchInput) {
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    searchButton.click();
                }
            });
        }

        // 标签点击搜索
        suggestionTags.forEach(tag => {
            tag.addEventListener('click', () => {
                const query = tag.textContent;
                window.open(`https://www.google.com/search?q=${encodeURIComponent(query)}`, '_blank');
            });
        });

        // 设置功能 - Settings Functionality
        const themeOptions = document.querySelectorAll('.theme-option');

        // 主题切换
        themeOptions.forEach(option => {
            option.addEventListener('click', () => {
                themeOptions.forEach(opt => opt.classList.remove('active'));
                option.classList.add('active');
                
                const theme = option.getAttribute('data-theme');
                if (theme === 'dark') {
                    document.body.classList.add('dark-mode');
                } else if (theme === 'light') {
                    document.body.classList.remove('dark-mode');
                } else {
                    // Auto theme - 可以根据系统主题或时间来决定
                    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    if (isDarkMode) {
                        document.body.classList.add('dark-mode');
                    } else {
                        document.body.classList.remove('dark-mode');
                    }
                }
            });
        });
    </script>
</body>
</html>
