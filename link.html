<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>由此出发🛫</title>
    <link rel="icon" type="image/png" href="touxiang.png">   
    <link rel="stylesheet" href="styles/variables.css">
    <link rel="stylesheet" href="styles/base.css">
    <link rel="stylesheet" href="styles/safe-area.css">
    <link rel="stylesheet" href="styles/components.css">
    <link rel="stylesheet" href="styles/layout.css">
    <link rel="stylesheet" href="styles/animations.css">
    <link rel="stylesheet" href="styles/link.css">
    <link rel="stylesheet" href="styles/loading.css">
    
    <!-- IP和操作系统检测脚本 -->
    <script>
        (function() {
            'use strict';
            
            // 检测操作系统
            function isAppleDevice() {
                const userAgent = navigator.userAgent || navigator.vendor || window.opera;
                const platform = navigator.platform || '';
                
                // 检测 iOS 设备
                const isiOS = /iPad|iPhone|iPod/.test(userAgent) && !window.MSStream;
                
                // 检测 macOS
                const isMac = /Mac|Macintosh|MacIntel|MacPPC|Mac68K/.test(platform) || 
                             /Mac/.test(userAgent);
                
                // 检测 iPadOS (iOS 13+ iPad 可能显示为 Mac)
                const isiPad = (platform === 'MacIntel' && navigator.maxTouchPoints > 1) ||
                              /iPad/.test(userAgent);
                
                return isiOS || isMac || isiPad;
            }
            
            // 检测 IP 地址是否属于中国大陆
            async function checkIPLocation() {
                try {
                    // 使用多个免费 IP 地理位置 API 作为备选
                    const apis = [
                        'https://ipapi.co/json/',
                        'https://ip-api.com/json/',
                        'https://ipinfo.io/json'
                    ];
                    
                    for (const api of apis) {
                        try {
                            const response = await fetch(api, { 
                                timeout: 5000,
                                signal: AbortSignal.timeout(5000)
                            });
                            
                            if (!response.ok) continue;
                            
                            const data = await response.json();
                            
                            // 检查国家代码
                            const countryCode = data.country || data.country_code || data.countryCode;
                            
                            console.log('🌍 IP检测结果:', {
                                ip: data.ip || data.query,
                                country: countryCode,
                                api: api
                            });
                            
                            return countryCode === 'CN';
                        } catch (err) {
                            console.warn('⚠️ API请求失败:', api, err);
                            continue;
                        }
                    }
                    
                    // 如果所有 API 都失败，默认不在中国大陆（使用 Google）
                    console.warn('⚠️ 所有IP检测API都失败，默认使用Google');
                    return false;
                    
                } catch (error) {
                    console.error('❌ IP检测错误:', error);
                    return false; // 默认不在中国大陆
                }
            }
            
            // 主检测逻辑
            async function performChecks() {
                console.log('🔍 开始设备和IP检测...');
                
                // 1. 检查是否为 Apple 设备
                if (!isAppleDevice()) {
                    console.log('❌ 非Apple设备，重定向到提示页面');
                    window.location.href = 'RefuseToResponse.html';
                    return;
                }
                
                console.log('✅ Apple设备检测通过');
                
                // 2. 检查 IP 位置
                const isChinaMainland = await checkIPLocation();
                
                // 3. 根据 IP 位置设置搜索引擎
                if (isChinaMainland) {
                    console.log('🇨🇳 检测到中国大陆IP，设置默认搜索引擎为百度');
                    sessionStorage.setItem('defaultSearchEngine', 'baidu');
                } else {
                    console.log('🌍 检测到非中国大陆IP，设置默认搜索引擎为Google');
                    sessionStorage.setItem('defaultSearchEngine', 'google');
                }
            }
            
            // 页面加载时执行检测
            performChecks();
        })();
    </script>

    <script>
        console.log('🟢 定时隐藏脚本开始');
        
        // 全局错误捕获
        window.onerror = function(msg, url, line, col, error) {
            console.error('🚨 JavaScript错误:', msg, 'at', line + ':' + col);
            return false;
        };
        
        // 页面加载完成后1秒自动隐藏dock
        window.addEventListener('load', function() {
            setTimeout(() => {
                try {
                    const dock = document.querySelector('.dock');
                    if (dock) {
                        // 创建底部指示器
                        const indicator = document.createElement('div');
                        indicator.className = 'bottom-indicator';
                        indicator.style.cssText = `
                            position: fixed;
                            bottom: 8px;
                            left: 50%;
                            transform: translateX(-50%);
                            width: 40px;
                            height: 4px;
                            background: rgba(120, 120, 120, 0.8);
                            border-radius: 2px;
                            opacity: 0.8;
                            transition: all 0.3s ease;
                            z-index: 1001;
                            cursor: pointer;
                        `;
                        document.body.appendChild(indicator);
                        // 隐藏dock (向正下隐藏)
                        dock.style.setProperty('transform', 'translateX(-50%) translateY(100%)', 'important');
                        dock.style.setProperty('opacity', '0', 'important');
                        dock.style.setProperty('transition', 'all 0.3s ease', 'important');
                        
                        // 鼠标悬停指示器时显示dock
                        let showTimeout = null;
                        indicator.addEventListener('mouseenter', function() {
                            if (showTimeout) {
                                clearTimeout(showTimeout);
                                showTimeout = null;
                            }
                            
                            dock.style.setProperty('transform', 'translateX(-50%) translateY(0)', 'important');
                            dock.style.setProperty('opacity', '1', 'important');
                            indicator.style.opacity = '0';
                        });
                        // 鼠标离开指示器时设置3秒延迟隐藏
                        indicator.addEventListener('mouseleave', function() {
                            showTimeout = setTimeout(function() {
                                dock.style.setProperty('transform', 'translateX(-50%) translateY(100%)', 'important');
                                dock.style.setProperty('opacity', '0', 'important');
                                indicator.style.opacity = '0.8';
                                showTimeout = null;
                            }, 3000);
                        });
                    }
                } catch (err) {
                    console.error('❌ 错误:', err);
                }
            }, 1000);
        });
    </script>
</head>
<body>

    <a href="index.html" class="fixed-button back-button">←</a>
    <button class="fixed-button theme-toggle">🌗</button>
    <a href="http://192.168.5.1/cgi-bin/luci/" target="_blank" class="fixed-button router-button">🛜</a>

    <!-- 全局加载遮罩 - Global Loading Overlay -->
    <div id="global-loading" class="loading-overlay">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p class="loading-text">正在加载...</p>
        </div>
    </div>

    <!-- 全局错误提示 - Global Error Toast -->
    <div id="error-toast" class="error-toast">
        <div class="error-content">
            <span class="error-icon">⚠️</span>
            <span class="error-message"></span>
            <button class="error-close" onclick="hideErrorToast()">×</button>
        </div>
    </div>

    <!-- 主内容容器 - Main Content Container -->
    <div class="main-container">
        
        <!-- 内容卡片1：由此出发 - Content Card 1: Launch Pad -->
        <div id="content-home" class="content-card active">
            <div class="container">
                <h1 class="main-title">由此出发</h1>
                
                <!-- 主搜索框 - Main Search Box -->
                <div class="main-search-container">
                    <div class="search-box main-search-box">
                        <input type="text" id="main-search-input" placeholder="搜索..." class="search-input main-search-input">
                        <button class="search-button" id="main-search-btn">
                            <span class="search-icon">🔍</span>
                            <span class="search-loading" style="display: none;">⏳</span>
                        </button>
                    </div>
                </div>
                
                <!-- 链接列表加载状态 -->
                <div id="link-loading" class="section-loading">
                    <div class="skeleton-grid">
                        <div class="skeleton-item" v-for="i in 8"></div>
                        <div class="skeleton-item"></div>
                        <div class="skeleton-item"></div>
                        <div class="skeleton-item"></div>
                        <div class="skeleton-item"></div>
                        <div class="skeleton-item"></div>
                        <div class="skeleton-item"></div>
                        <div class="skeleton-item"></div>
                        <div class="skeleton-item"></div>
                    </div>
                </div>
                <div id="link-list"></div>
                <!-- 链接列表错误状态 -->
                <div id="link-error" class="error-state" style="display: none;">
                    <div class="error-icon">😵</div>
                    <h3>加载失败</h3>
                    <p>无法加载链接数据，请检查网络连接</p>
                    <button class="retry-button" onclick="retryLoadLinks()">重试</button>
                </div>
            </div>
        </div>

        <!-- 内容卡片2：搜索发现 - Content Card 2: Search & Discovery -->
        <div id="content-search" class="content-card">
            <div class="container">
                <h1 class="main-title">学术资源</h1>
                <div class="search-content">
                    <div class="search-box">
                        <input type="text" id="scholar-search-input" placeholder="搜索学术论文、作者或期刊..." class="search-input">
                        <button class="search-button" id="scholar-search-btn">
                            <span class="search-icon">🎓</span>
                            <span class="search-loading" style="display: none;">⏳</span>
                        </button>
                    </div>
                    <div class="search-suggestions">
                        <h3>常用学术标签</h3>
                        <div class="suggestion-tags">
                            <span class="tag">论文检索</span>
                            <span class="tag">学术数据库</span>
                            <span class="tag">文献管理</span>
                            <span class="tag">学术写作</span>
                            <span class="tag">开源期刊</span>
                        </div>
                    </div>
                    <div class="quick-access">
                        <h3>快速访问</h3>
                        <div class="quick-links">
                            <a href="https://scholar.google.com" target="_blank" class="quick-link">
                          <img src="icon/scholar.google.com.png" alt="Google Scholar" class="quick-icon" 
                              onerror="this.onerror=null;this.src='icon/default.png';">
                                <span>Google Scholar</span>
                            </a>
                            <a href="https://www.cnki.net" target="_blank" class="quick-link">
                          <img src="icon/www.cnki.net.png" alt="中国知网" class="quick-icon"
                             onerror="this.onerror=null;this.src='icon/default.png';">
                                <span>中国知网</span>
                            </a>
                            <a href="https://www.webofscience.com" target="_blank" class="quick-link">
                          <img src="icon/www.webofscience.com.png" alt="Web of Science" class="quick-icon" 
                              onerror="this.onerror=null;this.src='icon/default.png';">
                                <span>Web of Science</span>
                            </a>
                            <a href="https://www.wanfangdata.com.cn" target="_blank" class="quick-link">
                          <img src="icon/www.wanfangdata.com.cn.png" alt="万方数据" class="quick-icon"
                              onerror="this.onerror=null;this.src='icon/default.png';">
                                <span>万方数据</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 内容卡片3：编码资源 - Content Card 3: Coding Resources -->
        <div id="content-coding" class="content-card">
            <div class="container">
                <h1 class="main-title">编码资源</h1>
                <div class="search-content">
                    <div class="search-box">
                        <input type="text" id="coding-search-input" placeholder="搜索编程文档、教程或工具..." class="search-input">
                        <button class="search-button" id="coding-search-btn">
                            <span class="search-icon">💻</span>
                            <span class="search-loading" style="display: none;">⏳</span>
                        </button>
                    </div>
                    <div class="search-suggestions">
                        <h3>常用编程标签</h3>
                        <div class="suggestion-tags">
                            <span class="tag">前端开发</span>
                            <span class="tag">后端开发</span>
                            <span class="tag">移动开发</span>
                            <span class="tag">数据科学</span>
                            <span class="tag">机器学习</span>
                            <span class="tag">开源项目</span>
                        </div>
                    </div>
                    <div class="quick-access">
                        <h3>快速访问</h3>
                        <div class="quick-links">
                            <a href="https://github.com" target="_blank" class="quick-link">
                                <img src="icon/github.com.png" alt="GitHub" class="quick-icon" 
                                    onerror="this.onerror=null;this.src='icon/default.png';">
                                <span>GitHub</span>
                            </a>
                            <a href="https://stackoverflow.com" target="_blank" class="quick-link">
                                <img src="icon/stackoverflow.com.png" alt="Stack Overflow" class="quick-icon"
                                   onerror="this.onerror=null;this.src='icon/default.png';">
                                <span>Stack Overflow</span>
                            </a>
                            <a href="https://developer.mozilla.org" target="_blank" class="quick-link">
                                <img src="icon/developer.mozilla.org.png" alt="MDN Web Docs" class="quick-icon" 
                                    onerror="this.onerror=null;this.src='icon/default.png';">
                                <span>MDN Web Docs</span>
                            </a>
                            <a href="https://www.runoob.com" target="_blank" class="quick-link">
                                <img src="icon/www.runoob.com.png" alt="菜鸟教程" class="quick-icon"
                                    onerror="this.onerror=null;this.src='icon/default.png';">
                                <span>菜鸟教程</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 内容卡片4：系统设置 - Content Card 4: System Settings -->
        <div id="content-settings" class="content-card">
            <div class="container">
                <h1 class="main-title">系统设置</h1>
                <div class="settings-content">
                    <div class="settings-section">
                        <h3>外观设置</h3>
                        <div class="setting-item">
                            <label>主题模式</label>
                            <div class="theme-selector">
                                <button class="theme-option active" data-theme="auto">🌗 自动</button>
                                <button class="theme-option" data-theme="light">☀️ 明亮</button>
                                <button class="theme-option" data-theme="dark">🌙 深色</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="dock">
        <div class="dock-bubble"></div>
        <a href="#" class="dock-item active" data-content="home">
            <span class="dock-icon">🏠</span>
            <span class="dock-label">主页</span>
        </a>
        <a href="#" class="dock-item" data-content="search">
            <span class="dock-icon">👨‍🎓</span>
            <span class="dock-label">学术</span>
        </a>
        <a href="#" class="dock-item" data-content="coding">
            <span class="dock-icon">💻</span>
            <span class="dock-label">编码</span>
        </a>
        <a href="#" class="dock-item" data-content="settings">
            <span class="dock-icon">⚙️</span>
            <span class="dock-label">设置</span>
        </a>
    </div>

    <!-- iOS-style bottom indicator -->
    <div class="bottom-indicator"></div>

    <script>
        // 全局配置常量 - Global Configuration Constants
        const CONFIG = {
            ANIMATION_DURATION: 500,
            LOADING_DELAY: 300,
            ERROR_DISPLAY_TIME: 5000,
            PARALLAX_FACTOR: 0.02,
            BUBBLE_TRANSITION: 'cubic-bezier(0.4, 0, 0.2, 1)',
            RETRY_ATTEMPTS: 3,
            RETRY_DELAY: 1000
        };

        // 全局状态管理 - Global State Management
        const AppState = {
            isLoading: false,
            currentTheme: 'auto',
            currentContent: 'home',
            retryCount: 0,
            links: [],
            isOffline: false
        };

        // 工具函数 - Utility Functions
        const Utils = {
            // 防抖函数
            debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            },

            // 节流函数
            throttle(func, limit) {
                let inThrottle;
                return function() {
                    const args = arguments;
                    const context = this;
                    if (!inThrottle) {
                        func.apply(context, args);
                        inThrottle = true;
                        setTimeout(() => inThrottle = false, limit);
                    }
                }
            },

            // 延迟执行
            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            },

            // 安全的DOM操作
            safeQuerySelector(selector) {
                try {
                    return document.querySelector(selector);
                } catch (e) {
                    console.warn(`Invalid selector: ${selector}`);
                    return null;
                }
            },

            // 获取域名
            getDomain(url) {
                try {
                    return new URL(url).hostname;
                } catch (e) {
                    console.warn(`Invalid URL: ${url}`);
                    return null;
                }
            }
        };

        // 加载状态管理 - Loading State Management
        const LoadingManager = {
            show(text = '正在加载...') {
                const overlay = document.getElementById('global-loading');
                const loadingText = overlay?.querySelector('.loading-text');
                if (overlay) {
                    if (loadingText) loadingText.textContent = text;
                    overlay.style.display = 'flex';
                    AppState.isLoading = true;
                }
            },

            hide() {
                const overlay = document.getElementById('global-loading');
                if (overlay) {
                    overlay.style.display = 'none';
                    AppState.isLoading = false;
                }
            },

            showSection(sectionId) {
                const section = document.getElementById(`${sectionId}-loading`);
                if (section) section.style.display = 'block';
            },

            hideSection(sectionId) {
                const section = document.getElementById(`${sectionId}-loading`);
                if (section) section.style.display = 'none';
            }
        };

        // 错误处理管理 - Error Handling Management
        const ErrorManager = {
            show(message, type = 'error', duration = CONFIG.ERROR_DISPLAY_TIME) {
                const toast = document.getElementById('error-toast');
                const messageEl = toast?.querySelector('.error-message');
                const iconEl = toast?.querySelector('.error-icon');
                
                if (toast && messageEl && iconEl) {
                    // 清除之前的隐藏计时器和动画类
                    if (this.hideTimer) {
                        clearTimeout(this.hideTimer);
                    }
                    toast.classList.remove('hide');
                    
                    messageEl.textContent = message;
                    iconEl.textContent = type === 'warning' ? '⚠️' : type === 'success' ? '✅' : '❌';
                    toast.className = `error-toast ${type} show`;
                    
                    // 自动隐藏
                    this.hideTimer = setTimeout(() => this.hide(), duration);
                }
            },

            hide() {
                const toast = document.getElementById('error-toast');
                if (toast) {
                    // 添加隐藏动画类
                    toast.classList.add('hide');
                    toast.classList.remove('show');
                    
                    // 动画完成后完全隐藏
                    setTimeout(() => {
                        toast.style.visibility = 'hidden';
                        toast.classList.remove('hide');
                    }, 300); // 与CSS动画时间匹配
                    
                    if (this.hideTimer) {
                        clearTimeout(this.hideTimer);
                        this.hideTimer = null;
                    }
                }
            },

            showSection(sectionId, message, retryCallback) {
                const errorEl = document.getElementById(`${sectionId}-error`);
                const messageEl = errorEl?.querySelector('p');
                const retryBtn = errorEl?.querySelector('.retry-button');
                
                if (errorEl) {
                    if (messageEl) messageEl.textContent = message;
                    if (retryBtn && retryCallback) {
                        retryBtn.onclick = retryCallback;
                    }
                    errorEl.style.display = 'block';
                }
            },

            hideSection(sectionId) {
                const errorEl = document.getElementById(`${sectionId}-error`);
                if (errorEl) errorEl.style.display = 'none';
            }
        };

        // 全局错误处理函数
        window.hideErrorToast = () => ErrorManager.hide();
        window.retryLoadLinks = () => LinkManager.loadWithRetry();

        // 搜索引擎管理 - Search Engine Management
        const SearchManager = {
            defaultEngine: sessionStorage.getItem('defaultSearchEngine') || 'google',
            currentEngine: sessionStorage.getItem('defaultSearchEngine') || 'google',
            
            updateSearchIcon(engine) {
                const searchIcon = document.querySelector('#main-search-btn .search-icon');
                const searchButton = document.getElementById('main-search-btn');
                if (!searchIcon || !searchButton) return;
                
                // 清空当前内容
                searchIcon.innerHTML = '';
                
                switch (engine) {
                    case 'google':
                        // 尝试使用本地图标，如果失败则使用文本
                        const googleImg = document.createElement('img');
                        googleImg.setAttribute('src', 'icon/google.com.png');
                        googleImg.setAttribute('alt', 'Google');
                        googleImg.setAttribute('style', 'width: 16px; height: 16px;');
                        
                        // 设置错误处理 - 避免使用Google的favicon服务
                        googleImg.addEventListener('error', function() {
                            // 直接使用文本图标而不是Google服务
                            const textIcon = document.createElement('span');
                            textIcon.textContent = 'G';
                            textIcon.style.cssText = `
                                display: inline-flex;
                                align-items: center;
                                justify-content: center;
                                width: 16px;
                                height: 16px;
                                background: #4285f4;
                                color: white;
                                border-radius: 2px;
                                font-size: 10px;
                                font-weight: bold;
                            `;
                            this.parentNode.replaceChild(textIcon, this);
                        });
                        
                        searchIcon.appendChild(googleImg);
                        searchButton.setAttribute('title', '使用 Google 搜索');
                        break;
                        
                    case 'baidu':
                        // 使用本地图标或文本
                        const baiduImg = document.createElement('img');
                        baiduImg.setAttribute('src', 'icon/baidu.com.png');
                        baiduImg.setAttribute('alt', '百度');
                        baiduImg.setAttribute('style', 'width: 16px; height: 16px;');
                        
                        // 设置错误处理
                        baiduImg.addEventListener('error', function() {
                            const textIcon = document.createElement('span');
                            textIcon.textContent = '百';
                            textIcon.style.cssText = `
                                display: inline-flex;
                                align-items: center;
                                justify-content: center;
                                width: 16px;
                                height: 16px;
                                background: #2932e1;
                                color: white;
                                border-radius: 2px;
                                font-size: 10px;
                                font-weight: bold;
                            `;
                            this.parentNode.replaceChild(textIcon, this);
                        });
                        
                        searchIcon.appendChild(baiduImg);
                        searchButton.setAttribute('title', '使用百度搜索');
                        break;
                        
                    default:
                        searchIcon.textContent = '🔍';
                        searchButton.setAttribute('title', '搜索');
                }
            },
            
            search(query, engine = this.currentEngine) {
                if (!query.trim()) {
                    ErrorManager.show('请输入搜索内容', 'warning', 2000);
                    return;
                }
                
                const encodedQuery = encodeURIComponent(query.trim());
                let searchUrl;
                
                switch (engine) {
                    case 'google':
                        searchUrl = `https://www.google.com/search?q=${encodedQuery}`;
                        break;
                    case 'baidu':
                        searchUrl = `https://www.baidu.com/s?wd=${encodedQuery}`;
                        break;
                    case 'scholar':
                        // 学术搜索也要根据当前引擎选择
                        if (this.currentEngine === 'baidu') {
                            // 使用百度学术
                            searchUrl = `https://xueshu.baidu.com/s?wd=${encodedQuery}`;
                        } else {
                            // 默认使用Google Scholar
                            searchUrl = `https://scholar.google.com/scholar?q=${encodedQuery}`;
                        }
                        break;
                    case 'coding':
                        // 编码搜索优先使用GitHub和Stack Overflow
                        searchUrl = `https://github.com/search?q=${encodedQuery}&type=repositories`;
                        // 同时在新标签页中打开Stack Overflow搜索
                        setTimeout(() => {
                            window.open(`https://stackoverflow.com/search?q=${encodedQuery}`, '_blank');
                        }, 100);
                        break;
                    default:
                        // 默认情况下根据当前检测到的引擎选择
                        if (this.currentEngine === 'baidu') {
                            searchUrl = `https://www.baidu.com/s?wd=${encodedQuery}`;
                        } else {
                            searchUrl = `https://www.google.com/search?q=${encodedQuery}`;
                        }
                }
                
                window.open(searchUrl, '_blank');
            }
        };

        // 链接管理 - Link Management
        const LinkManager = {
            async load() {
                try {
                    LoadingManager.showSection('link');
                    ErrorManager.hideSection('link');
                    
                    const response = await fetch('./links.json');
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const links = await response.json();
                    if (!Array.isArray(links)) {
                        throw new Error('链接数据格式错误');
                    }
                    
                    AppState.links = links;
                    this.render(links);
                    AppState.retryCount = 0; // 重置重试计数
                    
                } catch (error) {
                    console.error('加载链接失败:', error);
                    this.handleError(error);
                } finally {
                    LoadingManager.hideSection('link');
                }
            },

            async loadWithRetry() {
                if (AppState.retryCount >= CONFIG.RETRY_ATTEMPTS) {
                    ErrorManager.show('重试次数过多，请稍后再试', 'error');
                    return;
                }
                
                AppState.retryCount++;
                await Utils.delay(CONFIG.RETRY_DELAY * AppState.retryCount);
                this.load();
            },

            handleError(error) {
                const message = error.message || '加载链接失败，请检查网络连接';
                ErrorManager.showSection('link', message, () => this.loadWithRetry());
                ErrorManager.show(message, 'error');
            },

            render(links = []) {
                const linkList = document.getElementById('link-list');
                if (!linkList) return;

                linkList.innerHTML = '';
                
                if (links.length === 0) {
                    linkList.innerHTML = '<p style="text-align:center; color: var(--text-secondary);">暂无链接数据</p>';
                    return;
                }

                const fragment = document.createDocumentFragment();
                
                links.forEach(link => {
                    if (!link.url || !link.name) {
                        console.warn('跳过无效链接:', link);
                        return;
                    }
                    
                    const linkItem = this.createLinkElement(link);
                    fragment.appendChild(linkItem);
                });

                linkList.appendChild(fragment);
            },

            createLinkElement(link) {
                const linkItem = document.createElement('a');
                linkItem.href = link.url;
                linkItem.target = '_blank';
                linkItem.className = 'link-item';

                // 创建图标
                const favicon = this.createFaviconElement(link.url);
                linkItem.appendChild(favicon);
                
                // 创建名称
                const nameSpan = document.createElement('span');
                nameSpan.textContent = link.name;
                nameSpan.title = link.name; // 添加工具提示
                linkItem.appendChild(nameSpan);

                return linkItem;
            },

            createFaviconElement(url) {
                const favicon = document.createElement('img');
                favicon.className = 'favicon';
                favicon.loading = 'lazy'; // 添加懒加载
                
                const domain = Utils.getDomain(url);
                if (domain) {
                    favicon.src = `icon/${domain}.png`;
                } else {
                    favicon.style.display = 'none';
                }
                
                return favicon;
            },
        };

        // 主题管理 - Theme Management
        const ThemeManager = {
            init() {
                // 从本地存储恢复主题设置
                const savedTheme = localStorage.getItem('theme') || 'auto';
                this.setTheme(savedTheme);
                this.updateThemeUI(savedTheme);
            },

            setTheme(theme) {
                AppState.currentTheme = theme;
                localStorage.setItem('theme', theme);
                
                if (theme === 'dark') {
                    document.body.classList.add('dark-mode');
                } else if (theme === 'light') {
                    document.body.classList.remove('dark-mode');
                } else {
                    // Auto theme
                    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    document.body.classList.toggle('dark-mode', isDarkMode);
                }
            },

            updateThemeUI(theme) {
                const themeOptions = document.querySelectorAll('.theme-option');
                themeOptions.forEach(option => {
                    option.classList.toggle('active', option.getAttribute('data-theme') === theme);
                });
            },

            toggle() {
                const currentTheme = AppState.currentTheme;
                const nextTheme = currentTheme === 'light' ? 'dark' : 'light';
                this.setTheme(nextTheme);
                this.updateThemeUI(nextTheme);
            }
        };

        // 内容切换管理 - Content Switching Management
        const ContentManager = {
            menuOrder: { 'home': 0, 'search': 1, 'coding': 2, 'settings': 3 },
            
            init() {
                // 确保只有当前活动的内容卡片显示，其他隐藏
                this.initializeContentCards();
                // 确保菜单项状态正确
                this.updateActiveStates(AppState.currentContent);
            },
            
            initializeContentCards() {
                // 获取所有内容卡片
                const contentCards = document.querySelectorAll('.content-card');
                
                contentCards.forEach(card => {
                    const cardId = card.id;
                    const contentType = cardId.replace('content-', '');
                    
                    // 清理所有动画类
                    card.classList.remove('active', 'prev', 'next', 'from-right', 'from-left', 'exit-left', 'exit-right');
                    
                    // 只给当前活动内容添加 active 类
                    if (contentType === AppState.currentContent) {
                        card.classList.add('active');
                    }
                });
            },
            
            switch(targetContent) {
                if (AppState.currentContent === targetContent) return;
                
                const currentIndex = this.menuOrder[AppState.currentContent];
                const targetIndex = this.menuOrder[targetContent];
                const isMovingRight = targetIndex > currentIndex;
                
                this.animateTransition(AppState.currentContent, targetContent, isMovingRight);
                this.updateActiveStates(targetContent);
                
                AppState.currentContent = targetContent;
            },

            animateTransition(currentContent, targetContent, isMovingRight) {
                const currentCard = document.getElementById(`content-${currentContent}`);
                const targetCard = document.getElementById(`content-${targetContent}`);
                
                if (!currentCard || !targetCard) return;
                
                // 添加退出动画
                currentCard.classList.add(isMovingRight ? 'exit-left' : 'exit-right');
                
                setTimeout(() => {
                    // 清理所有状态
                    document.querySelectorAll('.content-card').forEach(card => {
                        card.classList.remove('active', 'prev', 'next', 'from-right', 'from-left', 'exit-left', 'exit-right');
                    });
                    
                    // 激活目标卡片
                    targetCard.classList.add('active');
                    targetCard.classList.add(isMovingRight ? 'from-right' : 'from-left');
                    
                    // 清理动画类
                    setTimeout(() => {
                        targetCard.classList.remove('from-right', 'from-left');
                    }, CONFIG.ANIMATION_DURATION);
                    
                }, 50);
            },

            updateActiveStates(targetContent) {
                // 更新菜单项状态
                document.querySelectorAll('.dock-item').forEach(item => {
                    const isActive = item.getAttribute('data-content') === targetContent;
                    item.classList.toggle('active', isActive);
                });
                
                // 更新气泡位置
                const targetMenuItem = document.querySelector(`.dock-item[data-content="${targetContent}"]`);
                if (targetMenuItem) {
                    DockManager.moveBubbleTo(targetMenuItem);
                }
            }
        };

        // 事件处理管理 - Event Handler Management
        const EventManager = {
            init() {
                this.setupDockEvents();
                this.setupSearchEvents();
                this.setupThemeEvents();
                this.setupKeyboardEvents();
                this.setupGlobalEvents();
            },

            setupDockEvents() {
                const dockItems = document.querySelectorAll('.dock-item');
                dockItems.forEach(item => {
                    item.addEventListener('click', this.handleDockItemClick.bind(this));
                    item.addEventListener('mouseenter', this.handleDockItemHover.bind(this));
                    item.addEventListener('mouseleave', this.handleDockItemLeave.bind(this));
                    
                    // 触摸事件支持
                    if ('ontouchstart' in window) {
                        item.addEventListener('touchstart', this.handleDockItemTouch.bind(this));
                        item.addEventListener('touchend', this.handleDockItemTouchEnd.bind(this));
                    }
                });

                const dock = document.querySelector('.dock');
                if (dock) {
                    dock.addEventListener('mouseenter', this.handleDockHover.bind(this));
                    dock.addEventListener('mouseleave', this.handleDockLeave.bind(this));
                }
            },

            setupSearchEvents() {
                // 主搜索框事件
                const mainSearchInput = document.getElementById('main-search-input');
                const mainSearchButton = document.getElementById('main-search-btn');
                
                if (mainSearchButton) {
                    mainSearchButton.addEventListener('click', () => this.handleMainSearch());
                }
                
                if (mainSearchInput) {
                    mainSearchInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            this.handleMainSearch();
                        }
                    });
                }

                // 学术搜索框事件
                const scholarSearchInput = document.getElementById('scholar-search-input');
                const scholarSearchButton = document.getElementById('scholar-search-btn');
                
                if (scholarSearchButton) {
                    scholarSearchButton.addEventListener('click', () => this.handleScholarSearch());
                }

                if (scholarSearchInput) {
                    scholarSearchInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            this.handleScholarSearch();
                        }
                    });
                }

                // 编码搜索框事件
                const codingSearchInput = document.getElementById('coding-search-input');
                const codingSearchButton = document.getElementById('coding-search-btn');
                
                if (codingSearchButton) {
                    codingSearchButton.addEventListener('click', () => this.handleCodingSearch());
                }

                if (codingSearchInput) {
                    codingSearchInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            this.handleCodingSearch();
                        }
                    });
                }

                // 标签点击搜索
                const suggestionTags = document.querySelectorAll('.tag');
                suggestionTags.forEach(tag => {
                    tag.addEventListener('click', this.handleTagClick.bind(this));
                });
            },

            setupThemeEvents() {
                const themeToggle = document.querySelector('.theme-toggle');
                const themeOptions = document.querySelectorAll('.theme-option');
                
                if (themeToggle) {
                    themeToggle.addEventListener('click', (e) => {
                        e.preventDefault();
                        ThemeManager.toggle();
                    });
                }

                themeOptions.forEach(option => {
                    option.addEventListener('click', this.handleThemeOptionClick.bind(this));
                });
            },

            setupKeyboardEvents() {
                document.addEventListener('keydown', this.handleKeyDown.bind(this));
            },

            setupGlobalEvents() {
                window.addEventListener('resize', Utils.debounce(this.handleResize.bind(this), 250));
                
                // 监听系统主题变化
                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', this.handleSystemThemeChange.bind(this));
            },

            // 事件处理方法
            handleDockItemClick(e) {
                e.preventDefault();
                const targetContent = e.currentTarget.getAttribute('data-content');
                ContentManager.switch(targetContent);
            },

            handleDockItemHover(e) {
                DockManager.moveBubbleTo(e.currentTarget);
                DockManager.addMagneticEffect(e.currentTarget);
            },

            handleDockItemLeave(e) {
                DockManager.resetMagneticEffect();
            },

            handleDockItemTouch(e) {
                e.preventDefault();
                DockManager.moveBubbleTo(e.currentTarget);
                e.currentTarget.style.transform = 'scale(0.95)';
            },

            handleDockItemTouchEnd(e) {
                e.preventDefault();
                e.currentTarget.style.transform = '';
                const targetContent = e.currentTarget.getAttribute('data-content');
                ContentManager.switch(targetContent);
            },

            handleDockHover(e) {
                e.currentTarget.style.transform = 'translateX(-50%) translateY(-2px) scale(1.02)';
            },

            handleDockLeave(e) {
                e.currentTarget.style.transform = 'translateX(-50%) translateY(0) scale(1)';
                
                setTimeout(() => {
                    const activeItem = document.querySelector('.dock-item.active');
                    if (activeItem) {
                        DockManager.moveBubbleTo(activeItem);
                    }
                    DockManager.resetMagneticEffect();
                }, 150);
            },

            async handleMainSearch() {
                const searchInput = document.getElementById('main-search-input');
                const query = searchInput?.value.trim();
                
                if (!query) {
                    ErrorManager.show('请输入搜索内容', 'warning', 2000);
                    return;
                }

                try {
                    this.setMainSearchLoading(true);
                    await Utils.delay(300); // 短暂延迟以显示加载状态
                    SearchManager.search(query);
                } catch (error) {
                    ErrorManager.show('搜索失败，请重试', 'error');
                } finally {
                    this.setMainSearchLoading(false);
                }
            },

            async handleScholarSearch() {
                const searchInput = document.getElementById('scholar-search-input');
                const query = searchInput?.value.trim();
                
                if (!query) {
                    ErrorManager.show('请输入搜索内容', 'warning', 2000);
                    return;
                }

                try {
                    this.setScholarSearchLoading(true);
                    await Utils.delay(300);
                    SearchManager.search(query, 'scholar');
                } catch (error) {
                    ErrorManager.show('学术搜索失败，请重试', 'error');
                } finally {
                    this.setScholarSearchLoading(false);
                }
            },

            async handleCodingSearch() {
                const searchInput = document.getElementById('coding-search-input');
                const query = searchInput?.value.trim();
                
                if (!query) {
                    ErrorManager.show('请输入搜索内容', 'warning', 2000);
                    return;
                }

                try {
                    this.setCodingSearchLoading(true);
                    await Utils.delay(300);
                    SearchManager.search(query, 'coding');
                } catch (error) {
                    ErrorManager.show('编码搜索失败，请重试', 'error');
                } finally {
                    this.setCodingSearchLoading(false);
                }
            },

            handleSearch() {
                // 保留原有的搜索方法以兼容
                this.handleScholarSearch();
            },

            handleSearchKeyPress(e) {
                if (e.key === 'Enter') {
                    this.handleScholarSearch();
                }
            },

            handleSearchInput(e) {
                // 可以在这里添加搜索建议逻辑
                const query = e.target.value.trim();
                console.log('搜索输入:', query);
            },

            handleTagClick(e) {
                const query = e.target.textContent;
                // 根据当前页面选择搜索引擎
                let searchEngine;
                if (AppState.currentContent === 'search') {
                    searchEngine = 'scholar';
                } else if (AppState.currentContent === 'coding') {
                    searchEngine = 'coding';
                } else {
                    searchEngine = SearchManager.currentEngine;
                }
                SearchManager.search(query, searchEngine);
            },

            handleThemeOptionClick(e) {
                const theme = e.currentTarget.getAttribute('data-theme');
                ThemeManager.setTheme(theme);
                ThemeManager.updateThemeUI(theme);
            },

            handleKeyDown(e) {
                // 键盘快捷键
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key) {
                        case '1':
                            e.preventDefault();
                            ContentManager.switch('home');
                            break;
                        case '2':
                            e.preventDefault();
                            ContentManager.switch('search');
                            break;
                        case '3':
                            e.preventDefault();
                            ContentManager.switch('settings');
                            break;
                        case 'd':
                            e.preventDefault();
                            ThemeManager.toggle();
                            break;
                    }
                }
                
                // ESC 键隐藏错误提示
                if (e.key === 'Escape') {
                    ErrorManager.hide();
                }
            },

            handleResize() {
                // 响应式处理
                console.log('窗口大小改变');
            },

            handleSystemThemeChange(e) {
                if (AppState.currentTheme === 'auto') {
                    document.body.classList.toggle('dark-mode', e.matches);
                }
            },

            setMainSearchLoading(isLoading) {
                const searchIcon = document.querySelector('#main-search-btn .search-icon');
                const searchLoading = document.querySelector('#main-search-btn .search-loading');
                const searchButton = document.getElementById('main-search-btn');
                
                if (searchIcon && searchLoading && searchButton) {
                    searchIcon.style.display = isLoading ? 'none' : 'inline-flex';
                    searchLoading.style.display = isLoading ? 'inline' : 'none';
                    searchButton.disabled = isLoading;
                }
            },

            setScholarSearchLoading(isLoading) {
                const searchIcon = document.querySelector('#scholar-search-btn .search-icon');
                const searchLoading = document.querySelector('#scholar-search-btn .search-loading');
                const searchButton = document.getElementById('scholar-search-btn');
                
                if (searchIcon && searchLoading && searchButton) {
                    searchIcon.style.display = isLoading ? 'none' : 'inline';
                    searchLoading.style.display = isLoading ? 'inline' : 'none';
                    searchButton.disabled = isLoading;
                }
            },

            setCodingSearchLoading(isLoading) {
                const searchIcon = document.querySelector('#coding-search-btn .search-icon');
                const searchLoading = document.querySelector('#coding-search-btn .search-loading');
                const searchButton = document.getElementById('coding-search-btn');
                
                if (searchIcon && searchLoading && searchButton) {
                    searchIcon.style.display = isLoading ? 'none' : 'inline';
                    searchLoading.style.display = isLoading ? 'inline' : 'none';
                    searchButton.disabled = isLoading;
                }
            },

            setSearchLoading(isLoading) {
                // 兼容方法，调用学术搜索加载状态
                this.setScholarSearchLoading(isLoading);
            }
        };
        // Dock管理 - Dock Management
        const DockManager = {
            init() {
                const activeItem = document.querySelector('.dock-item.active');
                if (activeItem) {
                    setTimeout(() => this.moveBubbleTo(activeItem), 100);
                }
            },

            moveBubbleTo(item) {
                if (!item) return;
                
                const bubble = document.querySelector('.dock-bubble');
                const dock = document.querySelector('.dock');
                if (!bubble || !dock) return;
                
                const itemRect = item.getBoundingClientRect();
                const dockRect = dock.getBoundingClientRect();
                const left = itemRect.left - dockRect.left;
                const width = itemRect.width;

                bubble.style.left = `${left}px`;
                bubble.style.width = `${width}px`;
                bubble.style.opacity = '1';
                bubble.style.transform = 'scale(1)';
                
                // 添加发光效果
                const isDarkMode = document.body.classList.contains('dark-mode');
                const glowColor = isDarkMode ? 'rgba(10, 132, 255, 0.2)' : 'rgba(0, 113, 227, 0.15)';
                
                if (item.classList.contains('active')) {
                    bubble.style.boxShadow = `
                        0 4px 16px rgba(0, 0, 0, 0.1),
                        inset 0 1px 1px rgba(255, 255, 255, 0.3),
                        0 0 20px ${glowColor}
                    `;
                } else {
                    bubble.style.boxShadow = `
                        0 4px 16px rgba(0, 0, 0, 0.1),
                        inset 0 1px 1px rgba(255, 255, 255, 0.3)
                    `;
                }
            },

            addMagneticEffect(hoveredItem) {
                const dockItems = document.querySelectorAll('.dock-item');
                const hoveredIndex = Array.from(dockItems).indexOf(hoveredItem);
                
                dockItems.forEach((item, index) => {
                    const distance = Math.abs(index - hoveredIndex);
                    if (distance === 1) {
                        const direction = index < hoveredIndex ? 2 : -2;
                        item.style.transform = `translateX(${direction}px) scale(1.02)`;
                    } else if (distance > 1) {
                        item.style.transform = '';
                    }
                });
            },

            resetMagneticEffect() {
                document.querySelectorAll('.dock-item').forEach(item => {
                    item.style.transform = '';
                });
            },

            hide() {
                const bubble = document.querySelector('.dock-bubble');
                if (bubble) {
                    bubble.style.opacity = '0';
                    bubble.style.transform = 'scale(0.9)';
                }
            }
        };

        // Dock自动隐藏管理 - Dock Auto Hide Management
        const DockAutoHideManager = {
            isAtBottom: false,
            isDockHidden: false,
            lastScrollY: 0,
            scrollDirection: 'up',
            isMouseOverIndicator: false,
            hideTimeout: null,
            showTimeout: null, // 新增：用于3秒显示计时

            init() {
                console.log('=== DockAutoHideManager 开始初始化 ===');
                try {
                    this.setupHoverEvents();
                    this.lastScrollY = window.scrollY;
                    console.log('=== DockAutoHideManager 初始化完成 ===');
                    

                } catch (error) {
                    console.error('DockAutoHideManager 初始化失败:', error);
                }
            },

            setupHoverEvents() {
                console.log('设置悬停事件...');
                const dock = document.querySelector('.dock');
                const indicator = document.querySelector('.bottom-indicator');

                console.log('Dock元素:', dock);
                console.log('Indicator元素:', indicator);

                if (indicator) {
                    // 鼠标进入指示器
                    indicator.addEventListener('mouseenter', () => {
                        console.log('鼠标进入指示器');
                        this.isMouseOverIndicator = true;
                        
                        // 清除任何现有的计时器
                        this.clearShowTimeout();
                        this.clearHideTimeout();
                        
                        if (this.isDockHidden) {
                            this.showDock();
                        }
                    });

                    // 鼠标离开指示器
                    indicator.addEventListener('mouseleave', () => {
                        console.log('鼠标离开指示器，设置3秒后隐藏');
                        this.isMouseOverIndicator = false;
                        
                        if (this.isDockHidden === false) {
                            // 设置3秒后隐藏
                            this.scheduleShowTimeout();
                        }
                    });

                    // 点击指示器
                    indicator.addEventListener('click', (e) => {
                        console.log('点击指示器');
                        e.preventDefault();
                        e.stopPropagation();
                        if (this.isDockHidden) {
                            this.showDock();
                            // 显示3秒后再次隐藏
                            this.scheduleShowTimeout();
                        }
                    });
                    console.log('指示器事件绑定完成');
                }

                if (dock) {
                    // 鼠标进入dock时
                    dock.addEventListener('mouseenter', () => {
                        console.log('鼠标进入dock');
                        if (this.isDockHidden) {
                            this.showDock();
                        }
                        // 清除所有计时器
                        this.clearHideTimeout();
                        this.clearShowTimeout();
                    });

                    // 鼠标离开dock时
                    dock.addEventListener('mouseleave', () => {
                        console.log('鼠标离开dock');
                        if (!this.isMouseOverIndicator) {
                            // 设置3秒后隐藏
                            this.scheduleShowTimeout();
                        }
                    });
                    console.log('Dock事件绑定完成');
                }
                console.log('悬停事件设置完成');
            },
            scheduleHideDock() {
                console.log('计划隐藏dock (800ms后)');
                this.clearHideTimeout();
                this.hideTimeout = setTimeout(() => {
                    if (this.isAtBottom && !this.isMouseOverIndicator) {
                        console.log('执行隐藏dock');
                        this.hideDock();
                    } else {
                        console.log('取消隐藏dock - 条件不满足');
                    }
                }, 800); // 延迟800ms后隐藏
            },

            hideDock() {
                console.log('隐藏dock');
                const dock = document.querySelector('.dock');
                const indicator = document.querySelector('.bottom-indicator');
                
                if (dock && !this.isDockHidden) {
                    dock.classList.add('hidden');
                    dock.classList.remove('showing');
                    this.isDockHidden = true;
                    console.log('Dock已隐藏');
                }
                
                if (indicator) {
                    indicator.classList.add('visible');
                    console.log('指示器已显示');
                }
            },

            showDock() {
                console.log('显示dock');
                const dock = document.querySelector('.dock');
                const indicator = document.querySelector('.bottom-indicator');
                
                if (dock) {
                    dock.classList.remove('hidden');
                    dock.classList.add('showing');
                    this.isDockHidden = false;
                    
                    // 恢复parallax位置，但需要延迟执行避免被CSS transition覆盖
                    setTimeout(() => {
                        if (!this.isDockHidden) {
                            const parallax = this.lastScrollY * CONFIG.PARALLAX_FACTOR;
                            dock.style.transform = `translateX(-50%) translateY(${parallax}px)`;
                        }
                    }, 100);
                    console.log('Dock已显示');
                }
                
                if (indicator) {
                    indicator.classList.remove('visible');
                    console.log('指示器已隐藏');
                }
            },

            clearHideTimeout() {
                if (this.hideTimeout) {
                    clearTimeout(this.hideTimeout);
                    this.hideTimeout = null;
                    console.log('清除隐藏计时器');
                }
            },

            scheduleShowTimeout() {
                console.log('设置3秒后隐藏dock');
                this.clearShowTimeout();
                this.showTimeout = setTimeout(() => {
                    console.log('3秒时间到，隐藏dock');
                    if (!this.isMouseOverIndicator) {
                        this.hideDock();
                    }
                    this.showTimeout = null;
                }, 3000);
            },

            clearShowTimeout() {
                if (this.showTimeout) {
                    clearTimeout(this.showTimeout);
                    this.showTimeout = null;
                    console.log('清除3秒显示计时器');
                }
            }
        };

        // 应用初始化 - Application Initialization
        const App = {
            async init() {
                try {
                    LoadingManager.show('正在初始化应用...');
                    
                    // 预加载关键资源
                    this.preloadResources();
                    
                    // 初始化各个管理器
                    console.log('开始初始化各个管理器...');
                    ThemeManager.init();
                    console.log('ThemeManager 初始化完成');
                    DockManager.init();
                    console.log('DockManager 初始化完成');
                    // DockAutoHideManager 已被新版本替换，不再需要初始化
                    ContentManager.init();
                    console.log('ContentManager 初始化完成');
                    EventManager.init();
                    console.log('EventManager 初始化完成');
                    
                    // 根据IP检测结果设置默认搜索引擎图标
                    const defaultEngine = sessionStorage.getItem('defaultSearchEngine') || 'google';
                    SearchManager.updateSearchIcon(defaultEngine);
                    console.log('搜索引擎初始化完成，当前引擎:', defaultEngine);
                    
                    // 加载链接数据
                    await LinkManager.load();
                    
                    // 性能优化：预加载图标
                    this.preloadIcons();
                    
                    // 初始化完成
                    LoadingManager.hide();
                    
                    // 显示使用提示（仅首次访问）
                    this.showFirstTimeHints();
                    
                } catch (error) {
                    console.error('应用初始化失败:', error);
                    LoadingManager.hide();
                    ErrorManager.show('应用初始化失败，请刷新页面重试', 'error');
                }
            },

            preloadResources() {
                // 预加载关键CSS和字体
                const criticalResources = [
                    'styles/variables.css',
                    'styles/base.css'
                ];
                
                criticalResources.forEach(href => {
                    const link = document.createElement('link');
                    link.rel = 'preload';
                    link.as = 'style';
                    link.href = href;
                    document.head.appendChild(link);
                });
            },

            preloadIcons() {
                // 预加载常用域名的图标
                const commonDomains = [
                    'google.com', 'github.com', 'baidu.com', 
                    'apple.com.cn', 'microsoft.com'
                ];
                
                commonDomains.forEach(domain => {
                    const img = new Image();
                    img.src = `icon/${domain}.png`;
                    img.onerror = () => {
                        // 如果本地图标不存在，预加载Google图标
                        const fallbackImg = new Image();
                        fallbackImg.src = `https://www.google.com/s2/favicons?domain=${domain}&sz=32`;
                    };
                });
            },

            showFirstTimeHints() {
                const hasVisited = localStorage.getItem('hasVisited');
                if (!hasVisited) {
                    setTimeout(() => {
                        ErrorManager.show('💡 提示：使用 Ctrl/Cmd + 1/2/3 快速切换页面，Ctrl/Cmd + D 切换主题。搜索按钮图标显示当前使用的搜索引擎！', 'success', 10000);
                        localStorage.setItem('hasVisited', 'true');
                    }, 3000);
                }
            }
        };

        // 页面加载完成后初始化应用
        document.addEventListener('DOMContentLoaded', () => {
            App.init();
        });

        // 兼容旧版本的全局函数
        window.toggleTheme = () => ThemeManager.toggle();
        window.switchContent = (content) => ContentManager.switch(content);
    </script>
</body>
</html>
