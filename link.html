<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>ç”±æ­¤å‡ºå‘ğŸ›«</title>
    <link rel="icon" type="image/png" href="touxiang.png">   
    <link rel="stylesheet" href="styles/variables.css">
    <link rel="stylesheet" href="styles/base.css">
    <link rel="stylesheet" href="styles/safe-area.css">
    <link rel="stylesheet" href="styles/components.css">
    <link rel="stylesheet" href="styles/layout.css">
    <link rel="stylesheet" href="styles/animations.css">
    <link rel="stylesheet" href="styles/link.css">
    <link rel="stylesheet" href="styles/loading.css">
    
    <script>
        (() => {
            'use strict';
            const API_ENDPOINTS = [
                'https://ipapi.co/json/',
                'https://ip-api.com/json/',
                'https://ipinfo.io/json'
            ];
            const DEFAULT_ENGINE = 'google';
            const TIMEOUT_MS = 1200;

            const setEngine = (engine) => {
                sessionStorage.setItem('defaultSearchEngine', engine);
            };

            const detectCountry = async (signal) => {
                const requests = API_ENDPOINTS.map(async (api) => {
                    const response = await fetch(api, { signal });
                    if (!response.ok) throw new Error('bad response');
                    const data = await response.json();
                    const countryCode = data.country || data.country_code || data.countryCode;
                    return countryCode === 'CN';
                });
                return Promise.any(requests);
            };

            const initSearchEngine = () => {
                if (!sessionStorage.getItem('defaultSearchEngine')) {
                    setEngine(DEFAULT_ENGINE);
                }

                if (!window.fetch || !window.AbortController) {
                    return;
                }

                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), TIMEOUT_MS);

                detectCountry(controller.signal)
                    .then((isChinaMainland) => {
                        setEngine(isChinaMainland ? 'baidu' : DEFAULT_ENGINE);
                    })
                    .catch(() => {
                        // Keep the default engine on failure or timeout.
                    })
                    .finally(() => {
                        clearTimeout(timeoutId);
                    });
            };

            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initSearchEngine);
            } else {
                initSearchEngine();
            }
        })();
    </script>

    <script>        
        window.onerror = function(msg, url, line, col, error) {
            return false;
        };
        
        window.addEventListener('load', function() {
            setTimeout(() => {
                try {
                    const isMobile = Utils.isMobileDevice();                    
                    if (isMobile) {
                        return;
                    }
                    
                    const dock = document.querySelector('.dock');
                    if (dock) {
                        const indicator = document.createElement('div');
                        indicator.className = 'bottom-indicator';
                        indicator.style.cssText = `
                            position: fixed;
                            bottom: 8px;
                            left: 50%;
                            transform: translateX(-50%);
                            width: 40px;
                            height: 4px;
                            background: rgba(120, 120, 120, 0.8);
                            border-radius: 2px;
                            opacity: 0.8;
                            transition: all 0.3s ease;
                            z-index: 1001;
                            cursor: pointer;
                        `;
                        document.body.appendChild(indicator);
                        dock.style.setProperty('transform', 'translateX(-50%) translateY(100%)', 'important');
                        dock.style.setProperty('opacity', '0', 'important');
                        dock.style.setProperty('transition', 'all 0.3s ease', 'important');
                        let showTimeout = null;
                        indicator.addEventListener('mouseenter', function() {
                            if (showTimeout) {
                                clearTimeout(showTimeout);
                                showTimeout = null;
                            }
                            
                            dock.style.setProperty('transform', 'translateX(-50%) translateY(0)', 'important');
                            dock.style.setProperty('opacity', '1', 'important');
                            indicator.style.opacity = '0';
                        });
                        indicator.addEventListener('mouseleave', function() {
                            showTimeout = setTimeout(function() {
                                dock.style.setProperty('transform', 'translateX(-50%) translateY(100%)', 'important');
                                dock.style.setProperty('opacity', '0', 'important');
                                indicator.style.opacity = '0.8';
                                showTimeout = null;
                            }, 3000);
                        });
                    }
                } catch (err) {
                    console.error('âŒ é”™è¯¯:', err);
                }
            }, 1000);
        });
    </script>
</head>
<body>

    <a href="index.html" class="fixed-button back-button">â†</a>
    <button class="fixed-button theme-toggle">ğŸŒ—</button>
    <a href="http://192.168.5.1/cgi-bin/luci/" target="_blank" class="fixed-button router-button">ğŸ›œ</a>

    <!-- å…¨å±€åŠ è½½é®ç½© -->
    <div id="global-loading" class="loading-overlay">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p class="loading-text">æ­£åœ¨åŠ è½½...</p>
        </div>
    </div>

    <!-- å…¨å±€é”™è¯¯æç¤º -->
    <div id="error-toast" class="error-toast">
        <div class="error-content">
            <span class="error-icon">âš ï¸</span>
            <span class="error-message"></span>
            <button class="error-close" onclick="hideErrorToast()">Ã—</button>
        </div>
    </div>

    <!-- ä¸»å†…å®¹å®¹å™¨ -->
    <div class="main-container">
        
        <!-- å†…å®¹å¡ç‰‡1ï¼šç”±æ­¤å‡ºå‘ -->
        <div id="content-home" class="content-card active">
            <div class="container">
                <h1 class="main-title">ç”±æ­¤å‡ºå‘</h1>
                
                <!-- ä¸»æœç´¢æ¡† -->
                <div class="main-search-container">
                    <div class="search-box main-search-box">
                        <input type="text" id="main-search-input" placeholder="æœç´¢..." class="search-input main-search-input">
                        <button class="search-button" id="main-search-btn">
                            <span class="search-icon">ğŸ”</span>
                            <span class="search-loading" style="display: none;">â³</span>
                        </button>
                    </div>
                </div>
                
                <!-- é“¾æ¥åˆ—è¡¨åŠ è½½çŠ¶æ€ -->
                <div id="link-loading" class="section-loading">
                    <div class="skeleton-grid">
                        <div class="skeleton-item" v-for="i in 8"></div>
                        <div class="skeleton-item"></div>
                        <div class="skeleton-item"></div>
                        <div class="skeleton-item"></div>
                        <div class="skeleton-item"></div>
                        <div class="skeleton-item"></div>
                        <div class="skeleton-item"></div>
                        <div class="skeleton-item"></div>
                        <div class="skeleton-item"></div>
                    </div>
                </div>
                <div id="link-list"></div>
                <!-- é“¾æ¥åˆ—è¡¨é”™è¯¯çŠ¶æ€ -->
                <div id="link-error" class="error-state" style="display: none;">
                    <div class="error-icon">ğŸ˜µ</div>
                    <h3>åŠ è½½å¤±è´¥</h3>
                    <p>æ— æ³•åŠ è½½é“¾æ¥æ•°æ®ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥</p>
                    <button class="retry-button" onclick="retryLoadLinks()">é‡è¯•</button>
                </div>
            </div>
        </div>

        <!-- å†…å®¹å¡ç‰‡2ï¼šæœç´¢å‘ç° -->
        <div id="content-search" class="content-card">
            <div class="container">
                <h1 class="main-title">å­¦æœ¯èµ„æº</h1>
                <div class="search-content">
                    <div class="search-box">
                        <input type="text" id="scholar-search-input" placeholder="æœç´¢å­¦æœ¯è®ºæ–‡ã€ä½œè€…æˆ–æœŸåˆŠ..." class="search-input">
                        <button class="search-button" id="scholar-search-btn">
                            <span class="search-icon">ğŸ“</span>
                            <span class="search-loading" style="display: none;">â³</span>
                        </button>
                    </div>
                    <div class="search-suggestions">
                        <h3>å¸¸ç”¨å­¦æœ¯æ ‡ç­¾</h3>
                        <div class="suggestion-tags">
                            <span class="tag">è®ºæ–‡æ£€ç´¢</span>
                            <span class="tag">å­¦æœ¯æ•°æ®åº“</span>
                            <span class="tag">æ–‡çŒ®ç®¡ç†</span>
                            <span class="tag">å­¦æœ¯å†™ä½œ</span>
                            <span class="tag">å¼€æºæœŸåˆŠ</span>
                        </div>
                    </div>
                    <div class="quick-access">
                        <h3>å¿«é€Ÿè®¿é—®</h3>
                        <div class="quick-links">
                            <a href="https://scholar.google.com" target="_blank" class="quick-link">
                          <img src="icon/scholar.google.com.png" alt="Google Scholar" class="quick-icon" 
                              onerror="this.onerror=null;this.src='icon/default.png';">
                                <span>Google Scholar</span>
                            </a>
                            <a href="https://www.cnki.net" target="_blank" class="quick-link">
                          <img src="icon/www.cnki.net.png" alt="ä¸­å›½çŸ¥ç½‘" class="quick-icon"
                             onerror="this.onerror=null;this.src='icon/default.png';">
                                <span>ä¸­å›½çŸ¥ç½‘</span>
                            </a>
                            <a href="https://www.webofscience.com" target="_blank" class="quick-link">
                          <img src="icon/www.webofscience.com.png" alt="Web of Science" class="quick-icon" 
                              onerror="this.onerror=null;this.src='icon/default.png';">
                                <span>Web of Science</span>
                            </a>
                            <a href="https://www.wanfangdata.com.cn" target="_blank" class="quick-link">
                          <img src="icon/www.wanfangdata.com.cn.png" alt="ä¸‡æ–¹æ•°æ®" class="quick-icon"
                              onerror="this.onerror=null;this.src='icon/default.png';">
                                <span>ä¸‡æ–¹æ•°æ®</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å†…å®¹å¡ç‰‡3ï¼šç¼–ç èµ„æº -->
        <div id="content-coding" class="content-card">
            <div class="container">
                <h1 class="main-title">ç¼–ç èµ„æº</h1>
                <div class="search-content">
                    <div class="search-box">
                        <input type="text" id="coding-search-input" placeholder="æœç´¢ç¼–ç¨‹æ–‡æ¡£ã€æ•™ç¨‹æˆ–å·¥å…·..." class="search-input">
                        <button class="search-button" id="coding-search-btn">
                            <span class="search-icon">ğŸ’»</span>
                            <span class="search-loading" style="display: none;">â³</span>
                        </button>
                    </div>
                    <div class="search-suggestions">
                        <h3>å¸¸ç”¨ç¼–ç¨‹æ ‡ç­¾</h3>
                        <div class="suggestion-tags">
                            <span class="tag">å‰ç«¯å¼€å‘</span>
                            <span class="tag">åç«¯å¼€å‘</span>
                            <span class="tag">ç§»åŠ¨å¼€å‘</span>
                            <span class="tag">æ•°æ®ç§‘å­¦</span>
                            <span class="tag">æœºå™¨å­¦ä¹ </span>
                            <span class="tag">å¼€æºé¡¹ç›®</span>
                        </div>
                    </div>
                    <div class="quick-access">
                        <h3>å¿«é€Ÿè®¿é—®</h3>
                        <div class="quick-links">
                            <a href="https://github.com" target="_blank" class="quick-link">
                                <img src="icon/github.com.png" alt="GitHub" class="quick-icon" 
                                    onerror="this.onerror=null;this.src='icon/default.png';">
                                <span>GitHub</span>
                            </a>
                            <a href="https://stackoverflow.com" target="_blank" class="quick-link">
                                <img src="icon/stackoverflow.com.png" alt="Stack Overflow" class="quick-icon"
                                   onerror="this.onerror=null;this.src='icon/default.png';">
                                <span>Stack Overflow</span>
                            </a>
                            <a href="https://developer.mozilla.org" target="_blank" class="quick-link">
                                <img src="icon/developer.mozilla.org.png" alt="MDN Web Docs" class="quick-icon" 
                                    onerror="this.onerror=null;this.src='icon/default.png';">
                                <span>MDN Web Docs</span>
                            </a>
                            <a href="https://www.runoob.com" target="_blank" class="quick-link">
                                <img src="icon/www.runoob.com.png" alt="èœé¸Ÿæ•™ç¨‹" class="quick-icon"
                                    onerror="this.onerror=null;this.src='icon/default.png';">
                                <span>èœé¸Ÿæ•™ç¨‹</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å†…å®¹å¡ç‰‡4ï¼šç³»ç»Ÿè®¾ç½® -->
        <div id="content-settings" class="content-card">
            <div class="container">
                <h1 class="main-title">ç³»ç»Ÿè®¾ç½®</h1>
                <div class="settings-content">
                    <div class="settings-section">
                        <h3>å¤–è§‚è®¾ç½®</h3>
                        <div class="setting-item">
                            <label>ä¸»é¢˜æ¨¡å¼</label>
                            <div class="theme-selector">
                                <button class="theme-option active" data-theme="auto">ğŸŒ— è‡ªåŠ¨</button>
                                <button class="theme-option" data-theme="light">â˜€ï¸ æ˜äº®</button>
                                <button class="theme-option" data-theme="dark">ğŸŒ™ æ·±è‰²</button>
                            </div>
                        </div>
                    </div>
                    <div class="settings-section">
                        <h3>ç¼“å­˜ç®¡ç†</h3>
                        <div class="setting-item">
                            <button id="clearCacheBtn" class="clear-cache-btn">ğŸ—‘ï¸ æ¸…ç©ºç¼“å­˜</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="dock">
        <div class="dock-bubble"></div>
        <a href="#" class="dock-item active" data-content="home">
            <span class="dock-icon">ğŸ </span>
            <span class="dock-label">ä¸»é¡µ</span>
        </a>
        <a href="#" class="dock-item" data-content="search">
            <span class="dock-icon">ğŸ‘¨â€ğŸ“</span>
            <span class="dock-label">å­¦æœ¯</span>
        </a>
        <a href="#" class="dock-item" data-content="coding">
            <span class="dock-icon">ğŸ’»</span>
            <span class="dock-label">ç¼–ç </span>
        </a>
        <a href="#" class="dock-item" data-content="settings">
            <span class="dock-icon">âš™ï¸</span>
            <span class="dock-label">è®¾ç½®</span>
        </a>
    </div>
    <script>
        const CONFIG = {
            ANIMATION_DURATION: 500,
            LOADING_DELAY: 300,
            ERROR_DISPLAY_TIME: 5000,
            PARALLAX_FACTOR: 0.02,
            BUBBLE_TRANSITION: 'cubic-bezier(0.4, 0, 0.2, 1)',
            RETRY_ATTEMPTS: 3,
            RETRY_DELAY: 1000
        };

        const AppState = {
            isLoading: false,
            currentTheme: 'auto',
            currentContent: 'home',
            retryCount: 0,
            links: [],
            isOffline: false
        };

        const Utils = {
            debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            },

            throttle(func, limit) {
                let inThrottle;
                return function() {
                    const args = arguments;
                    const context = this;
                    if (!inThrottle) {
                        func.apply(context, args);
                        inThrottle = true;
                        setTimeout(() => inThrottle = false, limit);
                    }
                }
            },

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            },

            safeQuerySelector(selector) {
                try {
                    return document.querySelector(selector);
                } catch (e) {
                    console.warn(`Invalid selector: ${selector}`);
                    return null;
                }
            },

            getDomain(url) {
                try {
                    return new URL(url).hostname;
                } catch (e) {
                    console.warn(`Invalid URL: ${url}`);
                    return null;
                }
            },

            isMobileDevice() {
                const userAgent = navigator.userAgent || navigator.vendor || window.opera;
                const mobileRegex = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i;
                const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
                const isSmallScreen = window.innerWidth <= 768;
                
                return mobileRegex.test(userAgent) || (isTouchDevice && isSmallScreen);
            }
        };

        const LoadingManager = {
            show(text = 'æ­£åœ¨åŠ è½½...') {
                const overlay = document.getElementById('global-loading');
                const loadingText = overlay?.querySelector('.loading-text');
                if (overlay) {
                    if (loadingText) loadingText.textContent = text;
                    overlay.style.display = 'flex';
                    AppState.isLoading = true;
                }
            },

            hide() {
                const overlay = document.getElementById('global-loading');
                if (overlay) {
                    overlay.style.display = 'none';
                    AppState.isLoading = false;
                }
            },

            showSection(sectionId) {
                const section = document.getElementById(`${sectionId}-loading`);
                if (section) section.style.display = 'block';
            },

            hideSection(sectionId) {
                const section = document.getElementById(`${sectionId}-loading`);
                if (section) section.style.display = 'none';
            }
        };

        const ErrorManager = {
            show(message, type = 'error', duration = CONFIG.ERROR_DISPLAY_TIME) {
                const toast = document.getElementById('error-toast');
                const messageEl = toast?.querySelector('.error-message');
                const iconEl = toast?.querySelector('.error-icon');
                
                if (toast && messageEl && iconEl) {
                    if (this.hideTimer) {
                        clearTimeout(this.hideTimer);
                    }
                    toast.classList.remove('hide');
                    
                    messageEl.textContent = message;
                    iconEl.textContent = type === 'warning' ? 'âš ï¸' : type === 'success' ? 'âœ…' : 'âŒ';
                    toast.className = `error-toast ${type} show`;
                    this.hideTimer = setTimeout(() => this.hide(), duration);
                }
            },

            hide() {
                const toast = document.getElementById('error-toast');
                if (toast) {
                    toast.classList.add('hide');
                    toast.classList.remove('show');
                    setTimeout(() => {
                        toast.style.visibility = 'hidden';
                        toast.classList.remove('hide');
                    }, 300);
                    if (this.hideTimer) {
                        clearTimeout(this.hideTimer);
                        this.hideTimer = null;
                    }
                }
            },

            showSection(sectionId, message, retryCallback) {
                const errorEl = document.getElementById(`${sectionId}-error`);
                const messageEl = errorEl?.querySelector('p');
                const retryBtn = errorEl?.querySelector('.retry-button');
                
                if (errorEl) {
                    if (messageEl) messageEl.textContent = message;
                    if (retryBtn && retryCallback) {
                        retryBtn.onclick = retryCallback;
                    }
                    errorEl.style.display = 'block';
                }
            },

            hideSection(sectionId) {
                const errorEl = document.getElementById(`${sectionId}-error`);
                if (errorEl) errorEl.style.display = 'none';
            }
        };

        window.hideErrorToast = () => ErrorManager.hide();
        window.retryLoadLinks = () => LinkManager.loadWithRetry();

        const SearchManager = {
            defaultEngine: sessionStorage.getItem('defaultSearchEngine') || 'google',
            currentEngine: sessionStorage.getItem('defaultSearchEngine') || 'google',
            
            updateSearchIcon(engine) {
                const searchIcon = document.querySelector('#main-search-btn .search-icon');
                const searchButton = document.getElementById('main-search-btn');
                if (!searchIcon || !searchButton) return;
                
                searchIcon.innerHTML = '';
                
                switch (engine) {
                    case 'google':
                        const googleImg = document.createElement('img');
                        googleImg.setAttribute('src', 'icon/google.com.png');
                        googleImg.setAttribute('alt', 'Google');
                        googleImg.setAttribute('style', 'width: 16px; height: 16px;');
                        
                        googleImg.addEventListener('error', function() {
                            const textIcon = document.createElement('span');
                            textIcon.textContent = 'G';
                            textIcon.style.cssText = `
                                display: inline-flex;
                                align-items: center;
                                justify-content: center;
                                width: 16px;
                                height: 16px;
                                background: #4285f4;
                                color: white;
                                border-radius: 2px;
                                font-size: 10px;
                                font-weight: bold;
                            `;
                            this.parentNode.replaceChild(textIcon, this);
                        });
                        
                        searchIcon.appendChild(googleImg);
                        searchButton.setAttribute('title', 'ä½¿ç”¨ Google æœç´¢');
                        break;
                        
                    case 'baidu':
                        const baiduImg = document.createElement('img');
                        baiduImg.setAttribute('src', 'icon/baidu.com.png');
                        baiduImg.setAttribute('alt', 'ç™¾åº¦');
                        baiduImg.setAttribute('style', 'width: 16px; height: 16px;');
                        baiduImg.addEventListener('error', function() {
                            const textIcon = document.createElement('span');
                            textIcon.textContent = 'ç™¾';
                            textIcon.style.cssText = `
                                display: inline-flex;
                                align-items: center;
                                justify-content: center;
                                width: 16px;
                                height: 16px;
                                background: #2932e1;
                                color: white;
                                border-radius: 2px;
                                font-size: 10px;
                                font-weight: bold;
                            `;
                            this.parentNode.replaceChild(textIcon, this);
                        });
                        
                        searchIcon.appendChild(baiduImg);
                        searchButton.setAttribute('title', 'ä½¿ç”¨ç™¾åº¦æœç´¢');
                        break;
                        
                    default:
                        searchIcon.textContent = 'ğŸ”';
                        searchButton.setAttribute('title', 'æœç´¢');
                }
            },
            
            search(query, engine = this.currentEngine) {
                if (!query.trim()) {
                    ErrorManager.show('è¯·è¾“å…¥æœç´¢å†…å®¹', 'warning', 2000);
                    return;
                }
                
                const encodedQuery = encodeURIComponent(query.trim());
                let searchUrl;
                
                switch (engine) {
                    case 'google':
                        searchUrl = `https://www.google.com/search?q=${encodedQuery}`;
                        break;
                    case 'baidu':
                        searchUrl = `https://www.baidu.com/s?wd=${encodedQuery}`;
                        break;
                    case 'scholar':
                        if (this.currentEngine === 'baidu') {
                            searchUrl = `https://xueshu.baidu.com/s?wd=${encodedQuery}`;
                        } else {
                            searchUrl = `https://scholar.google.com/scholar?q=${encodedQuery}`;
                        }
                        break;
                    case 'coding':
                        searchUrl = `https://github.com/search?q=${encodedQuery}&type=repositories`;
                        setTimeout(() => {
                            window.open(`https://stackoverflow.com/search?q=${encodedQuery}`, '_blank');
                        }, 100);
                        break;
                    default:
                        if (this.currentEngine === 'baidu') {
                            searchUrl = `https://www.baidu.com/s?wd=${encodedQuery}`;
                        } else {
                            searchUrl = `https://www.google.com/search?q=${encodedQuery}`;
                        }
                }
                
                window.open(searchUrl, '_blank');
            }
        };

        const LinkManager = {
            CACHE_KEY: 'linksCache',
            VERSION_URL: './links.version.json',
            LINKS_URL: './links.json',
            VERSION_TIMEOUT_MS: 1200,

            getCache() {
                try {
                    const raw = localStorage.getItem(this.CACHE_KEY);
                    if (!raw) return null;
                    const parsed = JSON.parse(raw);
                    if (!Array.isArray(parsed?.data)) return null;
                    return parsed;
                } catch (err) {
                    return null;
                }
            },

            setCache(links, version) {
                try {
                    localStorage.setItem(this.CACHE_KEY, JSON.stringify({
                        data: links,
                        version,
                        cachedAt: Date.now()
                    }));
                } catch (err) {
                    // Ignore quota or serialization errors.
                }
            },

            async fetchVersion(signal) {
                const res = await fetch(this.VERSION_URL, { signal });
                if (!res.ok) throw new Error('ç‰ˆæœ¬è·å–å¤±è´¥');
                const data = await res.json();
                if (!data?.version) throw new Error('ç‰ˆæœ¬å·ç¼ºå¤±');
                return data.version;
            },

            async fetchLinks() {
                const response = await fetch(this.LINKS_URL);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                const links = await response.json();
                if (!Array.isArray(links)) {
                    throw new Error('é“¾æ¥æ•°æ®æ ¼å¼é”™è¯¯');
                }
                return links;
            },

            async load() {
                const cached = this.getCache();
                if (cached?.data) {
                    AppState.links = cached.data;
                    this.render(cached.data);
                }

                ErrorManager.hideSection('link');
                LoadingManager.showSection('link');

                try {
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), this.VERSION_TIMEOUT_MS);
                    const version = await this.fetchVersion(controller.signal);
                    clearTimeout(timeoutId);

                    if (cached?.version === version && cached?.data?.length) {
                        return; // Cache is fresh for this version.
                    }

                    const links = await this.fetchLinks();
                    AppState.links = links;
                    this.render(links);
                    this.setCache(links, version);
                    AppState.retryCount = 0;
                } catch (error) {
                    this.handleError(error);
                } finally {
                    LoadingManager.hideSection('link');
                }
            },

            async loadWithRetry() {
                if (AppState.retryCount >= CONFIG.RETRY_ATTEMPTS) {
                    ErrorManager.show('é‡è¯•æ¬¡æ•°è¿‡å¤šï¼Œè¯·ç¨åå†è¯•', 'error');
                    return;
                }
                
                AppState.retryCount++;
                await Utils.delay(CONFIG.RETRY_DELAY * AppState.retryCount);
                this.load();
            },

            handleError(error) {
                const message = error.message || 'åŠ è½½é“¾æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥';
                if (!AppState.links || AppState.links.length === 0) {
                    ErrorManager.showSection('link', message, () => this.loadWithRetry());
                    ErrorManager.show(message, 'error');
                } else {
                    ErrorManager.show(`${message}ï¼Œå·²ä½¿ç”¨ç¼“å­˜æ•°æ®`, 'warning');
                }
            },

            render(links = []) {
                const linkList = document.getElementById('link-list');
                if (!linkList) return;

                linkList.innerHTML = '';
                
                if (links.length === 0) {
                    linkList.innerHTML = '<p style="text-align:center; color: var(--text-secondary);">æš‚æ— é“¾æ¥æ•°æ®</p>';
                    return;
                }

                const fragment = document.createDocumentFragment();
                
                links.forEach(link => {
                    if (!link.url || !link.name) {
                        return;
                    }
                    
                    const linkItem = this.createLinkElement(link);
                    fragment.appendChild(linkItem);
                });

                linkList.appendChild(fragment);
            },

            createLinkElement(link) {
                const linkItem = document.createElement('a');
                linkItem.href = link.url;
                linkItem.target = '_blank';
                linkItem.className = 'link-item';
                const favicon = this.createFaviconElement(link.url);
                linkItem.appendChild(favicon);
                const nameSpan = document.createElement('span');
                nameSpan.textContent = link.name;
                nameSpan.title = link.name; 
                linkItem.appendChild(nameSpan);

                return linkItem;
            },

            createFaviconElement(url) {
                const favicon = document.createElement('img');
                favicon.className = 'favicon';
                favicon.loading = 'lazy';
                const domain = Utils.getDomain(url);
                if (domain) {
                    favicon.src = `icon/${domain}.png`;
                } else {
                    favicon.style.display = 'none';
                }
                return favicon;
            },
        };

        const ThemeManager = {
            init() {
                const savedTheme = localStorage.getItem('theme') || 'auto';
                this.setTheme(savedTheme);
                this.updateThemeUI(savedTheme);
            },

            setTheme(theme) {
                AppState.currentTheme = theme;
                localStorage.setItem('theme', theme);
                
                if (theme === 'dark') {
                    document.body.classList.add('dark-mode');
                } else if (theme === 'light') {
                    document.body.classList.remove('dark-mode');
                } else {
                    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    document.body.classList.toggle('dark-mode', isDarkMode);
                }
            },

            updateThemeUI(theme) {
                const themeOptions = document.querySelectorAll('.theme-option');
                themeOptions.forEach(option => {
                    option.classList.toggle('active', option.getAttribute('data-theme') === theme);
                });
            },

            toggle() {
                const currentTheme = AppState.currentTheme;
                const nextTheme = currentTheme === 'light' ? 'dark' : 'light';
                this.setTheme(nextTheme);
                this.updateThemeUI(nextTheme);
            }
        };

        const ContentManager = {
            menuOrder: { 'home': 0, 'search': 1, 'coding': 2, 'settings': 3 },
            
            init() {
                this.initializeContentCards();
                this.updateActiveStates(AppState.currentContent);
            },
            
            initializeContentCards() {
                const contentCards = document.querySelectorAll('.content-card');
                
                contentCards.forEach(card => {
                    const cardId = card.id;
                    const contentType = cardId.replace('content-', '');
                    card.classList.remove('active', 'prev', 'next', 'from-right', 'from-left', 'exit-left', 'exit-right');
                    
                    if (contentType === AppState.currentContent) {
                        card.classList.add('active');
                    }
                });
            },
            
            switch(targetContent) {
                if (AppState.currentContent === targetContent) return;
                
                const currentIndex = this.menuOrder[AppState.currentContent];
                const targetIndex = this.menuOrder[targetContent];
                const isMovingRight = targetIndex > currentIndex;
                
                this.animateTransition(AppState.currentContent, targetContent, isMovingRight);
                this.updateActiveStates(targetContent);
                
                AppState.currentContent = targetContent;
            },

            animateTransition(currentContent, targetContent, isMovingRight) {
                const currentCard = document.getElementById(`content-${currentContent}`);
                const targetCard = document.getElementById(`content-${targetContent}`);
                if (!currentCard || !targetCard) return;
                currentCard.classList.add(isMovingRight ? 'exit-left' : 'exit-right');
                setTimeout(() => {
                    document.querySelectorAll('.content-card').forEach(card => {
                        card.classList.remove('active', 'prev', 'next', 'from-right', 'from-left', 'exit-left', 'exit-right');
                    });
                    targetCard.classList.add('active');
                    targetCard.classList.add(isMovingRight ? 'from-right' : 'from-left');
                    setTimeout(() => {
                        targetCard.classList.remove('from-right', 'from-left');
                    }, CONFIG.ANIMATION_DURATION);
                }, 50);
            },

            updateActiveStates(targetContent) {
                document.querySelectorAll('.dock-item').forEach(item => {
                    const isActive = item.getAttribute('data-content') === targetContent;
                    item.classList.toggle('active', isActive);
                });
                const targetMenuItem = document.querySelector(`.dock-item[data-content="${targetContent}"]`);
                if (targetMenuItem) {
                    DockManager.moveBubbleTo(targetMenuItem);
                }
            }
        };

        const EventManager = {
            init() {
                this.setupDockEvents();
                this.setupSearchEvents();
                this.setupThemeEvents();
                this.setupKeyboardEvents();
                this.setupGlobalEvents();
                this.setupClearCacheEvents();
            },

            setupDockEvents() {
                const dockItems = document.querySelectorAll('.dock-item');
                dockItems.forEach(item => {
                    item.addEventListener('click', this.handleDockItemClick.bind(this));
                    item.addEventListener('mouseenter', this.handleDockItemHover.bind(this));
                    item.addEventListener('mouseleave', this.handleDockItemLeave.bind(this));
                    
                    if ('ontouchstart' in window) {
                        item.addEventListener('touchstart', this.handleDockItemTouch.bind(this));
                        item.addEventListener('touchend', this.handleDockItemTouchEnd.bind(this));
                    }
                });

                const dock = document.querySelector('.dock');
                if (dock) {
                    dock.addEventListener('mouseenter', this.handleDockHover.bind(this));
                    dock.addEventListener('mouseleave', this.handleDockLeave.bind(this));
                }
            },

            setupSearchEvents() {
                const mainSearchInput = document.getElementById('main-search-input');
                const mainSearchButton = document.getElementById('main-search-btn');
                
                if (mainSearchButton) {
                    mainSearchButton.addEventListener('click', () => this.handleMainSearch());
                }
                
                if (mainSearchInput) {
                    mainSearchInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            this.handleMainSearch();
                        }
                    });
                }

                const scholarSearchInput = document.getElementById('scholar-search-input');
                const scholarSearchButton = document.getElementById('scholar-search-btn');
                
                if (scholarSearchButton) {
                    scholarSearchButton.addEventListener('click', () => this.handleScholarSearch());
                }

                if (scholarSearchInput) {
                    scholarSearchInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            this.handleScholarSearch();
                        }
                    });
                }

                const codingSearchInput = document.getElementById('coding-search-input');
                const codingSearchButton = document.getElementById('coding-search-btn');
                
                if (codingSearchButton) {
                    codingSearchButton.addEventListener('click', () => this.handleCodingSearch());
                }

                if (codingSearchInput) {
                    codingSearchInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            this.handleCodingSearch();
                        }
                    });
                }

                const suggestionTags = document.querySelectorAll('.tag');
                suggestionTags.forEach(tag => {
                    tag.addEventListener('click', this.handleTagClick.bind(this));
                });
            },

            setupThemeEvents() {
                const themeToggle = document.querySelector('.theme-toggle');
                const themeOptions = document.querySelectorAll('.theme-option');
                
                if (themeToggle) {
                    themeToggle.addEventListener('click', (e) => {
                        e.preventDefault();
                        ThemeManager.toggle();
                    });
                }

                themeOptions.forEach(option => {
                    option.addEventListener('click', this.handleThemeOptionClick.bind(this));
                });
            },

            setupKeyboardEvents() {
                document.addEventListener('keydown', this.handleKeyDown.bind(this));
            },

            setupGlobalEvents() {
                window.addEventListener('resize', Utils.debounce(this.handleResize.bind(this), 250));
                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', this.handleSystemThemeChange.bind(this));
            },

            setupClearCacheEvents() {
                const clearCacheBtn = document.getElementById('clearCacheBtn');
                if (clearCacheBtn) {
                    clearCacheBtn.addEventListener('click', this.handleClearCacheClick.bind(this));
                }
            },

            handleDockItemClick(e) {
                e.preventDefault();
                const targetContent = e.currentTarget.getAttribute('data-content');
                ContentManager.switch(targetContent);
            },

            handleDockItemHover(e) {
                DockManager.moveBubbleTo(e.currentTarget);
                DockManager.addMagneticEffect(e.currentTarget);
            },

            handleDockItemLeave(e) {
                DockManager.resetMagneticEffect();
            },

            handleDockItemTouch(e) {
                e.preventDefault();
                DockManager.moveBubbleTo(e.currentTarget);
                e.currentTarget.style.transform = 'scale(0.95)';
            },

            handleDockItemTouchEnd(e) {
                e.preventDefault();
                e.currentTarget.style.transform = '';
                const targetContent = e.currentTarget.getAttribute('data-content');
                ContentManager.switch(targetContent);
            },

            handleDockHover(e) {
                e.currentTarget.style.transform = 'translateX(-50%) translateY(-2px) scale(1.02)';
            },

            handleDockLeave(e) {
                e.currentTarget.style.transform = 'translateX(-50%) translateY(0) scale(1)';
                
                setTimeout(() => {
                    const activeItem = document.querySelector('.dock-item.active');
                    if (activeItem) {
                        DockManager.moveBubbleTo(activeItem);
                    }
                    DockManager.resetMagneticEffect();
                }, 150);
            },

            async handleMainSearch() {
                const searchInput = document.getElementById('main-search-input');
                const query = searchInput?.value.trim();
                
                if (!query) {
                    ErrorManager.show('è¯·è¾“å…¥æœç´¢å†…å®¹', 'warning', 2000);
                    return;
                }

                try {
                    this.setMainSearchLoading(true);
                    await Utils.delay(300);
                    SearchManager.search(query);
                } catch (error) {
                    ErrorManager.show('æœç´¢å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                } finally {
                    this.setMainSearchLoading(false);
                }
            },

            async handleScholarSearch() {
                const searchInput = document.getElementById('scholar-search-input');
                const query = searchInput?.value.trim();
                
                if (!query) {
                    ErrorManager.show('è¯·è¾“å…¥æœç´¢å†…å®¹', 'warning', 2000);
                    return;
                }

                try {
                    this.setScholarSearchLoading(true);
                    await Utils.delay(300);
                    SearchManager.search(query, 'scholar');
                } catch (error) {
                    ErrorManager.show('å­¦æœ¯æœç´¢å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                } finally {
                    this.setScholarSearchLoading(false);
                }
            },

            async handleCodingSearch() {
                const searchInput = document.getElementById('coding-search-input');
                const query = searchInput?.value.trim();
                
                if (!query) {
                    ErrorManager.show('è¯·è¾“å…¥æœç´¢å†…å®¹', 'warning', 2000);
                    return;
                }

                try {
                    this.setCodingSearchLoading(true);
                    await Utils.delay(300);
                    SearchManager.search(query, 'coding');
                } catch (error) {
                    ErrorManager.show('ç¼–ç æœç´¢å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                } finally {
                    this.setCodingSearchLoading(false);
                }
            },

            handleSearch() {
                this.handleScholarSearch();
            },

            handleSearchKeyPress(e) {
                if (e.key === 'Enter') {
                    this.handleScholarSearch();
                }
            },

            handleSearchInput(e) {
                const query = e.target.value.trim();
                console.log('æœç´¢è¾“å…¥:', query);
            },

            handleTagClick(e) {
                const query = e.target.textContent;
                let searchEngine;
                if (AppState.currentContent === 'search') {
                    searchEngine = 'scholar';
                } else if (AppState.currentContent === 'coding') {
                    searchEngine = 'coding';
                } else {
                    searchEngine = SearchManager.currentEngine;
                }
                SearchManager.search(query, searchEngine);
            },

            handleThemeOptionClick(e) {
                const theme = e.currentTarget.getAttribute('data-theme');
                ThemeManager.setTheme(theme);
                ThemeManager.updateThemeUI(theme);
            },

            handleKeyDown(e) {
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key) {
                        case '1':
                            e.preventDefault();
                            ContentManager.switch('home');
                            break;
                        case '2':
                            e.preventDefault();
                            ContentManager.switch('search');
                            break;
                        case '3':
                            e.preventDefault();
                            ContentManager.switch('settings');
                            break;
                        case 'd':
                            e.preventDefault();
                            ThemeManager.toggle();
                            break;
                    }
                }
                
                if (e.key === 'Escape') {
                    ErrorManager.hide();
                }
            },

            handleResize() {
                console.log('çª—å£å¤§å°æ”¹å˜');
            },

            handleSystemThemeChange(e) {
                if (AppState.currentTheme === 'auto') {
                    document.body.classList.toggle('dark-mode', e.matches);
                }
            },

            setMainSearchLoading(isLoading) {
                const searchIcon = document.querySelector('#main-search-btn .search-icon');
                const searchLoading = document.querySelector('#main-search-btn .search-loading');
                const searchButton = document.getElementById('main-search-btn');
                
                if (searchIcon && searchLoading && searchButton) {
                    searchIcon.style.display = isLoading ? 'none' : 'inline-flex';
                    searchLoading.style.display = isLoading ? 'inline' : 'none';
                    searchButton.disabled = isLoading;
                }
            },

            setScholarSearchLoading(isLoading) {
                const searchIcon = document.querySelector('#scholar-search-btn .search-icon');
                const searchLoading = document.querySelector('#scholar-search-btn .search-loading');
                const searchButton = document.getElementById('scholar-search-btn');
                
                if (searchIcon && searchLoading && searchButton) {
                    searchIcon.style.display = isLoading ? 'none' : 'inline';
                    searchLoading.style.display = isLoading ? 'inline' : 'none';
                    searchButton.disabled = isLoading;
                }
            },

            setCodingSearchLoading(isLoading) {
                const searchIcon = document.querySelector('#coding-search-btn .search-icon');
                const searchLoading = document.querySelector('#coding-search-btn .search-loading');
                const searchButton = document.getElementById('coding-search-btn');
                
                if (searchIcon && searchLoading && searchButton) {
                    searchIcon.style.display = isLoading ? 'none' : 'inline';
                    searchLoading.style.display = isLoading ? 'inline' : 'none';
                    searchButton.disabled = isLoading;
                }
            },

            setSearchLoading(isLoading) {
                this.setScholarSearchLoading(isLoading);
            },

            handleClearCacheClick(e) {
                const btn = e.currentTarget;
                if (btn.classList.contains('confirm')) {
                    this.performClearCache();
                } else {
                    btn.classList.add('confirm');
                    btn.textContent = 'â—ç¡®å®šå—â—';
                    setTimeout(() => {
                        if (btn.classList.contains('confirm')) {
                            btn.classList.remove('confirm');
                            btn.textContent = 'ğŸ—‘ï¸ æ¸…ç©ºç¼“å­˜';
                        }
                    }, 3000);
                }
            },

            async performClearCache() {
                this.playShredderAnimation();
                await Utils.delay(2000);
                try {
                    localStorage.clear();
                    sessionStorage.clear();
                    if ('caches' in window) {
                        const cacheNames = await caches.keys();
                        await Promise.all(
                            cacheNames.map(cacheName => caches.delete(cacheName))
                        );
                    }
                    
                    window.location.reload(true);
                } catch (error) {
                    ErrorManager.show('æ¸…ç©ºç¼“å­˜å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨åˆ·æ–°é¡µé¢', 'error');
                }
            },

            playShredderAnimation() {
                const overlay = document.createElement('div');
                overlay.className = 'shredder-overlay';
                const shredderTop = document.createElement('div');
                shredderTop.className = 'shredder-top';
                overlay.appendChild(shredderTop);
                const stripCount = Math.floor(window.innerWidth / 20) + 1;
                for (let i = 0; i < stripCount; i++) {
                    const strip = document.createElement('div');
                    strip.className = 'paper-strip';
                    strip.style.left = `${i * 20}px`;
                    strip.style.animationDelay = `${Math.random() * 0.3}s`;
                    overlay.appendChild(strip);
                }
                
                document.body.appendChild(overlay);
                setTimeout(() => {
                    overlay.remove();
                }, 2500);
            }
        };
        // Dockç®¡ç† - Dock Management
        const DockManager = {
            init() {
                const activeItem = document.querySelector('.dock-item.active');
                if (activeItem) {
                    setTimeout(() => this.moveBubbleTo(activeItem), 100);
                }
            },

            moveBubbleTo(item) {
                if (!item) return;
                
                const bubble = document.querySelector('.dock-bubble');
                const dock = document.querySelector('.dock');
                if (!bubble || !dock) return;
                
                const itemRect = item.getBoundingClientRect();
                const dockRect = dock.getBoundingClientRect();
                const left = itemRect.left - dockRect.left;
                const width = itemRect.width;

                bubble.style.left = `${left}px`;
                bubble.style.width = `${width}px`;
                bubble.style.opacity = '1';
                bubble.style.transform = 'scale(1)';
                
                const isDarkMode = document.body.classList.contains('dark-mode');
                const glowColor = isDarkMode ? 'rgba(10, 132, 255, 0.2)' : 'rgba(0, 113, 227, 0.15)';
                
                if (item.classList.contains('active')) {
                    bubble.style.boxShadow = `
                        0 4px 16px rgba(0, 0, 0, 0.1),
                        inset 0 1px 1px rgba(255, 255, 255, 0.3),
                        0 0 20px ${glowColor}
                    `;
                } else {
                    bubble.style.boxShadow = `
                        0 4px 16px rgba(0, 0, 0, 0.1),
                        inset 0 1px 1px rgba(255, 255, 255, 0.3)
                    `;
                }
            },

            addMagneticEffect(hoveredItem) {
                const dockItems = document.querySelectorAll('.dock-item');
                const hoveredIndex = Array.from(dockItems).indexOf(hoveredItem);
                
                dockItems.forEach((item, index) => {
                    const distance = Math.abs(index - hoveredIndex);
                    if (distance === 1) {
                        const direction = index < hoveredIndex ? 2 : -2;
                        item.style.transform = `translateX(${direction}px) scale(1.02)`;
                    } else if (distance > 1) {
                        item.style.transform = '';
                    }
                });
            },

            resetMagneticEffect() {
                document.querySelectorAll('.dock-item').forEach(item => {
                    item.style.transform = '';
                });
            },

            hide() {
                const bubble = document.querySelector('.dock-bubble');
                if (bubble) {
                    bubble.style.opacity = '0';
                    bubble.style.transform = 'scale(0.9)';
                }
            }
        };

        const DockAutoHideManager = {
            isAtBottom: false,
            isDockHidden: false,
            lastScrollY: 0,
            scrollDirection: 'up',
            isMouseOverIndicator: false,
            hideTimeout: null,
            showTimeout: null, 

            init() {
                try {
                    const isMobile = Utils.isMobileDevice();
                    if (isMobile) {
                        return;
                    }
                    this.setupHoverEvents();
                    this.lastScrollY = window.scrollY;
                } catch (error) {
                }
            },

            setupHoverEvents() {
                const dock = document.querySelector('.dock');
                const indicator = document.querySelector('.bottom-indicator');
                if (indicator) {
                    indicator.addEventListener('mouseenter', () => {
                        this.isMouseOverIndicator = true;
                        this.clearShowTimeout();
                        this.clearHideTimeout();
                        if (this.isDockHidden) {
                            this.showDock();
                        }
                    });

                    indicator.addEventListener('mouseleave', () => {
                        this.isMouseOverIndicator = false;
                        if (this.isDockHidden === false) {
                            this.scheduleShowTimeout();
                        }
                    });

                    indicator.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        if (this.isDockHidden) {
                            this.showDock();
                            this.scheduleShowTimeout();
                        }
                    });
                }

                if (dock) {
                    dock.addEventListener('mouseenter', () => {
                        if (this.isDockHidden) {
                            this.showDock();
                        }
                        this.clearHideTimeout();
                        this.clearShowTimeout();
                    });

                    dock.addEventListener('mouseleave', () => {
                        if (!this.isMouseOverIndicator) {
                            this.scheduleShowTimeout();
                        }
                    });
                }
            },
            scheduleHideDock() {
                this.clearHideTimeout();
                this.hideTimeout = setTimeout(() => {
                    if (this.isAtBottom && !this.isMouseOverIndicator) {
                        this.hideDock();
                    }
                }, 800); 
            },

            hideDock() {
                const dock = document.querySelector('.dock');
                const indicator = document.querySelector('.bottom-indicator');
                
                if (dock && !this.isDockHidden) {
                    dock.classList.add('hidden');
                    dock.classList.remove('showing');
                    this.isDockHidden = true;
                }
                
                if (indicator) {
                    indicator.classList.add('visible');
                }
            },

            showDock() {
                const dock = document.querySelector('.dock');
                const indicator = document.querySelector('.bottom-indicator');
                
                if (dock) {
                    dock.classList.remove('hidden');
                    dock.classList.add('showing');
                    this.isDockHidden = false;
                    
                    setTimeout(() => {
                        if (!this.isDockHidden) {
                            const parallax = this.lastScrollY * CONFIG.PARALLAX_FACTOR;
                            dock.style.transform = `translateX(-50%) translateY(${parallax}px)`;
                        }
                    }, 100);
                }
                
                if (indicator) {
                    indicator.classList.remove('visible');
                }
            },

            clearHideTimeout() {
                if (this.hideTimeout) {
                    clearTimeout(this.hideTimeout);
                    this.hideTimeout = null;
                }
            },

            scheduleShowTimeout() {
                this.clearShowTimeout();
                this.showTimeout = setTimeout(() => {
                    if (!this.isMouseOverIndicator) {
                        this.hideDock();
                    }
                    this.showTimeout = null;
                }, 3000);
            },

            clearShowTimeout() {
                if (this.showTimeout) {
                    clearTimeout(this.showTimeout);
                    this.showTimeout = null;
                }
            }
        };

        const App = {
            async init() {
                try {
                    LoadingManager.show('æ­£åœ¨åˆå§‹åŒ–åº”ç”¨...');
                    this.preloadResources();
                    ThemeManager.init();
                    DockManager.init();
                    ContentManager.init();
                    EventManager.init();
                    
                    const defaultEngine = sessionStorage.getItem('defaultSearchEngine') || 'google';
                    SearchManager.updateSearchIcon(defaultEngine);                    
                    await LinkManager.load();
                    this.preloadIcons();
                    LoadingManager.hide();
                    this.showFirstTimeHints();
                } catch (error) {
                    LoadingManager.hide();
                    ErrorManager.show('åº”ç”¨åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 'error');
                }
            },

            preloadResources() {
                const criticalResources = [
                    'styles/variables.css',
                    'styles/base.css'
                ];
                
                criticalResources.forEach(href => {
                    const link = document.createElement('link');
                    link.rel = 'preload';
                    link.as = 'style';
                    link.href = href;
                    document.head.appendChild(link);
                });
            },

            preloadIcons() {
                const commonDomains = [
                    'google.com', 'github.com', 'baidu.com', 
                    'apple.com.cn', 'microsoft.com'
                ];
                
                commonDomains.forEach(domain => {
                    const img = new Image();
                    img.src = `icon/${domain}.png`;
                    img.onerror = () => {
                        const fallbackImg = new Image();
                        fallbackImg.src = `https://www.google.com/s2/favicons?domain=${domain}&sz=32`;
                    };
                });
            },

            showFirstTimeHints() {
                const hasVisited = localStorage.getItem('hasVisited');
                if (!hasVisited) {
                    setTimeout(() => {
                        ErrorManager.show('ğŸ’¡ æç¤ºï¼šä½¿ç”¨ Ctrl/Cmd + 1/2/3 å¿«é€Ÿåˆ‡æ¢é¡µé¢ï¼ŒCtrl/Cmd + D åˆ‡æ¢ä¸»é¢˜ã€‚æœç´¢æŒ‰é’®å›¾æ ‡æ˜¾ç¤ºå½“å‰ä½¿ç”¨çš„æœç´¢å¼•æ“ï¼', 'success', 10000);
                        localStorage.setItem('hasVisited', 'true');
                    }, 3000);
                }
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            App.init();
        });
        window.toggleTheme = () => ThemeManager.toggle();
        window.switchContent = (content) => ContentManager.switch(content);
    </script>
</body>
</html>
