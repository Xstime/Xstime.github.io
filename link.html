<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>ç”±æ­¤å‡ºå‘ğŸ›«</title>
    <link rel="icon" type="image/png" href="touxiang.png">   
    <link rel="stylesheet" href="styles/variables.css">
    <link rel="stylesheet" href="styles/base.css">
    <link rel="stylesheet" href="styles/safe-area.css">
    <link rel="stylesheet" href="styles/components.css">
    <link rel="stylesheet" href="styles/layout.css">
    <link rel="stylesheet" href="styles/animations.css">
    <link rel="stylesheet" href="styles/link.css">
    <link rel="stylesheet" href="styles/loading.css">
    
    <!-- è¶…çº§ç®€åŒ–æµ‹è¯•è„šæœ¬ -->
    <script>
        console.log('ğŸŸ¢ å®šæ—¶éšè—è„šæœ¬å¼€å§‹');
        
        // å…¨å±€é”™è¯¯æ•è·
        window.onerror = function(msg, url, line, col, error) {
            console.error('ğŸš¨ JavaScripté”™è¯¯:', msg, 'at', line + ':' + col);
            return false;
        };
        
        // é¡µé¢åŠ è½½å®Œæˆå1ç§’è‡ªåŠ¨éšè—dock
        window.addEventListener('load', function() {
            console.log('ğŸŸ¢ é¡µé¢åŠ è½½å®Œæˆï¼Œ1ç§’åéšè—dock');
            
            setTimeout(() => {
                console.log('â° å¼€å§‹æ‰§è¡Œéšè—é€»è¾‘');
                
                try {
                    const dock = document.querySelector('.dock');
                    console.log('ğŸ¯ dockå…ƒç´ :', dock ? 'æ‰¾åˆ°' : 'æœªæ‰¾åˆ°');
                    
                    if (dock) {
                        console.log('ğŸ«¥ éšè—dock');
                        
                        // åˆ›å»ºåº•éƒ¨æŒ‡ç¤ºå™¨
                        const indicator = document.createElement('div');
                        indicator.className = 'bottom-indicator';
                        indicator.style.cssText = `
                            position: fixed;
                            bottom: 8px;
                            left: 50%;
                            transform: translateX(-50%);
                            width: 40px;
                            height: 4px;
                            background: rgba(120, 120, 120, 0.8);
                            border-radius: 2px;
                            opacity: 0.8;
                            transition: all 0.3s ease;
                            z-index: 1001;
                            cursor: pointer;
                        `;
                        document.body.appendChild(indicator);
                        console.log('ğŸ“ åº•éƒ¨æŒ‡ç¤ºå™¨å·²åˆ›å»º');
                        
                        // éšè—dock (å‘æ­£ä¸‹éšè—)
                        dock.style.setProperty('transform', 'translateX(-50%) translateY(100%)', 'important');
                        dock.style.setProperty('opacity', '0', 'important');
                        dock.style.setProperty('transition', 'all 0.3s ease', 'important');
                        console.log('âœ… dockå·²éšè—');
                        
                        // é¼ æ ‡æ‚¬åœæŒ‡ç¤ºå™¨æ—¶æ˜¾ç¤ºdock
                        let showTimeout = null;
                        indicator.addEventListener('mouseenter', function() {
                            console.log('ğŸ‘ï¸ é¼ æ ‡è¿›å…¥æŒ‡ç¤ºå™¨ï¼Œæ˜¾ç¤ºdock');
                            
                            // æ¸…é™¤ä»»ä½•ç°æœ‰çš„éšè—è®¡æ—¶å™¨
                            if (showTimeout) {
                                clearTimeout(showTimeout);
                                showTimeout = null;
                            }
                            
                            dock.style.setProperty('transform', 'translateX(-50%) translateY(0)', 'important');
                            dock.style.setProperty('opacity', '1', 'important');
                            indicator.style.opacity = '0';
                        });
                        
                        // é¼ æ ‡ç¦»å¼€æŒ‡ç¤ºå™¨æ—¶è®¾ç½®3ç§’å»¶è¿Ÿéšè—
                        indicator.addEventListener('mouseleave', function() {
                            console.log('ğŸ«¥ é¼ æ ‡ç¦»å¼€æŒ‡ç¤ºå™¨ï¼Œ3ç§’åéšè—dock');
                            
                            // è®¾ç½®3ç§’åéšè—
                            showTimeout = setTimeout(function() {
                                console.log('â° 3ç§’æ—¶é—´åˆ°ï¼Œéšè—dock');
                                dock.style.setProperty('transform', 'translateX(-50%) translateY(100%)', 'important');
                                dock.style.setProperty('opacity', '0', 'important');
                                indicator.style.opacity = '0.8';
                                showTimeout = null;
                            }, 3000);
                        });
                        
                        console.log('ğŸ‰ å®šæ—¶éšè—åŠŸèƒ½è®¾ç½®å®Œæˆ');
                    }
                } catch (err) {
                    console.error('âŒ é”™è¯¯:', err);
                }
            }, 1000);  // 1ç§’åæ‰§è¡Œ
        });
    </script>
</head>
<body>

    <a href="index.html" class="fixed-button back-button">â†</a>
    <button class="fixed-button theme-toggle">ğŸŒ—</button>
    <a href="http://192.168.5.1/cgi-bin/luci/" target="_blank" class="fixed-button router-button">ğŸ›œ</a>

    <!-- å…¨å±€åŠ è½½é®ç½© - Global Loading Overlay -->
    <div id="global-loading" class="loading-overlay">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p class="loading-text">æ­£åœ¨åŠ è½½...</p>
        </div>
    </div>

    <!-- å…¨å±€é”™è¯¯æç¤º - Global Error Toast -->
    <div id="error-toast" class="error-toast">
        <div class="error-content">
            <span class="error-icon">âš ï¸</span>
            <span class="error-message"></span>
            <button class="error-close" onclick="hideErrorToast()">Ã—</button>
        </div>
    </div>

    <!-- ä¸»å†…å®¹å®¹å™¨ - Main Content Container -->
    <div class="main-container">
        
        <!-- å†…å®¹å¡ç‰‡1ï¼šç”±æ­¤å‡ºå‘ - Content Card 1: Launch Pad -->
        <div id="content-home" class="content-card active">
            <div class="container">
                <h1 class="main-title">ç”±æ­¤å‡ºå‘</h1>
                
                <!-- ä¸»æœç´¢æ¡† - Main Search Box -->
                <div class="main-search-container">
                    <div class="search-box main-search-box">
                        <input type="text" id="main-search-input" placeholder="æœç´¢..." class="search-input main-search-input">
                        <button class="search-button" id="main-search-btn">
                            <span class="search-icon">ğŸ”</span>
                            <span class="search-loading" style="display: none;">â³</span>
                        </button>
                    </div>
                </div>
                
                <!-- é“¾æ¥åˆ—è¡¨åŠ è½½çŠ¶æ€ -->
                <div id="link-loading" class="section-loading">
                    <div class="skeleton-grid">
                        <div class="skeleton-item" v-for="i in 8"></div>
                        <div class="skeleton-item"></div>
                        <div class="skeleton-item"></div>
                        <div class="skeleton-item"></div>
                        <div class="skeleton-item"></div>
                        <div class="skeleton-item"></div>
                        <div class="skeleton-item"></div>
                        <div class="skeleton-item"></div>
                        <div class="skeleton-item"></div>
                    </div>
                </div>
                <div id="link-list"></div>
                <!-- é“¾æ¥åˆ—è¡¨é”™è¯¯çŠ¶æ€ -->
                <div id="link-error" class="error-state" style="display: none;">
                    <div class="error-icon">ğŸ˜µ</div>
                    <h3>åŠ è½½å¤±è´¥</h3>
                    <p>æ— æ³•åŠ è½½é“¾æ¥æ•°æ®ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥</p>
                    <button class="retry-button" onclick="retryLoadLinks()">é‡è¯•</button>
                </div>
            </div>
        </div>

        <!-- å†…å®¹å¡ç‰‡2ï¼šæœç´¢å‘ç° - Content Card 2: Search & Discovery -->
        <div id="content-search" class="content-card">
            <div class="container">
                <h1 class="main-title">å­¦æœ¯èµ„æº</h1>
                <div class="search-content">
                    <div class="search-box">
                        <input type="text" id="scholar-search-input" placeholder="æœç´¢å­¦æœ¯è®ºæ–‡ã€ä½œè€…æˆ–æœŸåˆŠ..." class="search-input">
                        <button class="search-button" id="scholar-search-btn">
                            <span class="search-icon">ğŸ“</span>
                            <span class="search-loading" style="display: none;">â³</span>
                        </button>
                    </div>
                    <div class="search-suggestions">
                        <h3>å¸¸ç”¨å­¦æœ¯æ ‡ç­¾</h3>
                        <div class="suggestion-tags">
                            <span class="tag">è®ºæ–‡æ£€ç´¢</span>
                            <span class="tag">å­¦æœ¯æ•°æ®åº“</span>
                            <span class="tag">æ–‡çŒ®ç®¡ç†</span>
                            <span class="tag">å­¦æœ¯å†™ä½œ</span>
                            <span class="tag">å¼€æºæœŸåˆŠ</span>
                        </div>
                    </div>
                    <div class="quick-access">
                        <h3>å¿«é€Ÿè®¿é—®</h3>
                        <div class="quick-links">
                            <a href="https://scholar.google.com" target="_blank" class="quick-link">
                          <img src="icon/scholar.google.com.png" alt="Google Scholar" class="quick-icon" 
                              onerror="this.onerror=null;this.src='icon/default.png';">
                                <span>Google Scholar</span>
                            </a>
                            <a href="https://www.cnki.net" target="_blank" class="quick-link">
                          <img src="icon/www.cnki.net.png" alt="ä¸­å›½çŸ¥ç½‘" class="quick-icon"
                             onerror="this.onerror=null;this.src='icon/default.png';">
                                <span>ä¸­å›½çŸ¥ç½‘</span>
                            </a>
                            <a href="https://www.webofscience.com" target="_blank" class="quick-link">
                          <img src="icon/www.webofscience.com.png" alt="Web of Science" class="quick-icon" 
                              onerror="this.onerror=null;this.src='icon/default.png';">
                                <span>Web of Science</span>
                            </a>
                            <a href="https://www.wanfangdata.com.cn" target="_blank" class="quick-link">
                          <img src="icon/www.wanfangdata.com.cn.png" alt="ä¸‡æ–¹æ•°æ®" class="quick-icon"
                              onerror="this.onerror=null;this.src='icon/default.png';">
                                <span>ä¸‡æ–¹æ•°æ®</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å†…å®¹å¡ç‰‡3ï¼šç³»ç»Ÿè®¾ç½® - Content Card 3: System Settings -->
        <div id="content-settings" class="content-card">
            <div class="container">
                <h1 class="main-title">ç³»ç»Ÿè®¾ç½®</h1>
                <div class="settings-content">
                    <div class="settings-section">
                        <h3>å¤–è§‚è®¾ç½®</h3>
                        <div class="setting-item">
                            <label>ä¸»é¢˜æ¨¡å¼</label>
                            <div class="theme-selector">
                                <button class="theme-option active" data-theme="auto">ğŸŒ— è‡ªåŠ¨</button>
                                <button class="theme-option" data-theme="light">â˜€ï¸ æ˜äº®</button>
                                <button class="theme-option" data-theme="dark">ğŸŒ™ æ·±è‰²</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="dock">
        <div class="dock-bubble"></div>
        <a href="#" class="dock-item active" data-content="home">
            <span class="dock-icon">ğŸ </span>
            <span class="dock-label">ä¸»é¡µ</span>
        </a>
        <a href="#" class="dock-item" data-content="search">
            <span class="dock-icon">ğŸ‘¨â€ğŸ“</span>
            <span class="dock-label">å­¦æœ¯</span>
        </a>
        <a href="#" class="dock-item" data-content="settings">
            <span class="dock-icon">âš™ï¸</span>
            <span class="dock-label">è®¾ç½®</span>
        </a>
    </div>

    <!-- iOS-style bottom indicator -->
    <div class="bottom-indicator"></div>

    <script>
        // å…¨å±€é…ç½®å¸¸é‡ - Global Configuration Constants
        const CONFIG = {
            ANIMATION_DURATION: 500,
            LOADING_DELAY: 300,
            ERROR_DISPLAY_TIME: 5000,
            PARALLAX_FACTOR: 0.02,
            BUBBLE_TRANSITION: 'cubic-bezier(0.4, 0, 0.2, 1)',
            RETRY_ATTEMPTS: 3,
            RETRY_DELAY: 1000
        };

        // å…¨å±€çŠ¶æ€ç®¡ç† - Global State Management
        const AppState = {
            isLoading: false,
            currentTheme: 'auto',
            currentContent: 'home',
            retryCount: 0,
            links: [],
            googleAvailable: false, // æ·»åŠ Googleå¯ç”¨æ€§çŠ¶æ€
            isOffline: false
        };

        // å·¥å…·å‡½æ•° - Utility Functions
        const Utils = {
            // é˜²æŠ–å‡½æ•°
            debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            },

            // èŠ‚æµå‡½æ•°
            throttle(func, limit) {
                let inThrottle;
                return function() {
                    const args = arguments;
                    const context = this;
                    if (!inThrottle) {
                        func.apply(context, args);
                        inThrottle = true;
                        setTimeout(() => inThrottle = false, limit);
                    }
                }
            },

            // å»¶è¿Ÿæ‰§è¡Œ
            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            },

            // å®‰å…¨çš„DOMæ“ä½œ
            safeQuerySelector(selector) {
                try {
                    return document.querySelector(selector);
                } catch (e) {
                    console.warn(`Invalid selector: ${selector}`);
                    return null;
                }
            },

            // è·å–åŸŸå
            getDomain(url) {
                try {
                    return new URL(url).hostname;
                } catch (e) {
                    console.warn(`Invalid URL: ${url}`);
                    return null;
                }
            }
        };

        // åŠ è½½çŠ¶æ€ç®¡ç† - Loading State Management
        const LoadingManager = {
            show(text = 'æ­£åœ¨åŠ è½½...') {
                const overlay = document.getElementById('global-loading');
                const loadingText = overlay?.querySelector('.loading-text');
                if (overlay) {
                    if (loadingText) loadingText.textContent = text;
                    overlay.style.display = 'flex';
                    AppState.isLoading = true;
                }
            },

            hide() {
                const overlay = document.getElementById('global-loading');
                if (overlay) {
                    overlay.style.display = 'none';
                    AppState.isLoading = false;
                }
            },

            showSection(sectionId) {
                const section = document.getElementById(`${sectionId}-loading`);
                if (section) section.style.display = 'block';
            },

            hideSection(sectionId) {
                const section = document.getElementById(`${sectionId}-loading`);
                if (section) section.style.display = 'none';
            }
        };

        // é”™è¯¯å¤„ç†ç®¡ç† - Error Handling Management
        const ErrorManager = {
            show(message, type = 'error', duration = CONFIG.ERROR_DISPLAY_TIME) {
                const toast = document.getElementById('error-toast');
                const messageEl = toast?.querySelector('.error-message');
                const iconEl = toast?.querySelector('.error-icon');
                
                if (toast && messageEl && iconEl) {
                    // æ¸…é™¤ä¹‹å‰çš„éšè—è®¡æ—¶å™¨å’ŒåŠ¨ç”»ç±»
                    if (this.hideTimer) {
                        clearTimeout(this.hideTimer);
                    }
                    toast.classList.remove('hide');
                    
                    messageEl.textContent = message;
                    iconEl.textContent = type === 'warning' ? 'âš ï¸' : type === 'success' ? 'âœ…' : 'âŒ';
                    toast.className = `error-toast ${type} show`;
                    
                    // è‡ªåŠ¨éšè—
                    this.hideTimer = setTimeout(() => this.hide(), duration);
                }
            },

            hide() {
                const toast = document.getElementById('error-toast');
                if (toast) {
                    // æ·»åŠ éšè—åŠ¨ç”»ç±»
                    toast.classList.add('hide');
                    toast.classList.remove('show');
                    
                    // åŠ¨ç”»å®Œæˆåå®Œå…¨éšè—
                    setTimeout(() => {
                        toast.style.visibility = 'hidden';
                        toast.classList.remove('hide');
                    }, 300); // ä¸CSSåŠ¨ç”»æ—¶é—´åŒ¹é…
                    
                    if (this.hideTimer) {
                        clearTimeout(this.hideTimer);
                        this.hideTimer = null;
                    }
                }
            },

            showSection(sectionId, message, retryCallback) {
                const errorEl = document.getElementById(`${sectionId}-error`);
                const messageEl = errorEl?.querySelector('p');
                const retryBtn = errorEl?.querySelector('.retry-button');
                
                if (errorEl) {
                    if (messageEl) messageEl.textContent = message;
                    if (retryBtn && retryCallback) {
                        retryBtn.onclick = retryCallback;
                    }
                    errorEl.style.display = 'block';
                }
            },

            hideSection(sectionId) {
                const errorEl = document.getElementById(`${sectionId}-error`);
                if (errorEl) errorEl.style.display = 'none';
            }
        };

        // å…¨å±€é”™è¯¯å¤„ç†å‡½æ•°
        window.hideErrorToast = () => ErrorManager.hide();
        window.retryLoadLinks = () => LinkManager.loadWithRetry();

        // æœç´¢å¼•æ“ç®¡ç† - Search Engine Management
        const SearchManager = {
            defaultEngine: 'google',
            currentEngine: 'google',
            
            async detectSearchEngine() {
                const searchIcon = document.querySelector('#main-search-btn .search-icon');
                
                // åˆå§‹æ˜¾ç¤ºæ£€æµ‹çŠ¶æ€
                if (searchIcon) {
                    searchIcon.textContent = 'ğŸ”';
                }
                
                try {
                    console.log('å¼€å§‹æ£€æµ‹æœç´¢å¼•æ“å¯ç”¨æ€§...');
                    // å°è¯•æ£€æµ‹ç½‘ç»œè¿æ¥å’Œè®¿é—®è°·æ­Œ
                    const canAccessGoogle = await this.checkGoogleAccess();
                    
                    console.log('Google è®¿é—®æ£€æµ‹ç»“æœ:', canAccessGoogle);
                    
                    if (canAccessGoogle) {
                        this.currentEngine = 'google';
                        this.updateSearchIcon('google');
                    } else {
                        this.currentEngine = 'baidu';
                        this.updateSearchIcon('baidu');
                    }
                } catch (error) {
                    console.log('æœç´¢å¼•æ“æ£€æµ‹å¤±è´¥ï¼Œä½¿ç”¨ç™¾åº¦ä½œä¸ºå¤‡é€‰:', error);
                    this.currentEngine = 'baidu';
                    this.updateSearchIcon('baidu');
                    AppState.googleAvailable = false;
                }
            },

            updateSearchIcon(engine) {
                const searchIcon = document.querySelector('#main-search-btn .search-icon');
                const searchButton = document.getElementById('main-search-btn');
                if (!searchIcon || !searchButton) return;
                
                // æ¸…ç©ºå½“å‰å†…å®¹
                searchIcon.innerHTML = '';
                
                switch (engine) {
                    case 'google':
                        // å°è¯•ä½¿ç”¨æœ¬åœ°å›¾æ ‡ï¼Œå¦‚æœå¤±è´¥åˆ™ä½¿ç”¨æ–‡æœ¬
                        const googleImg = document.createElement('img');
                        googleImg.setAttribute('src', 'icon/google.com.png');
                        googleImg.setAttribute('alt', 'Google');
                        googleImg.setAttribute('style', 'width: 16px; height: 16px;');
                        
                        // è®¾ç½®é”™è¯¯å¤„ç† - é¿å…ä½¿ç”¨Googleçš„faviconæœåŠ¡
                        googleImg.addEventListener('error', function() {
                            // ç›´æ¥ä½¿ç”¨æ–‡æœ¬å›¾æ ‡è€Œä¸æ˜¯GoogleæœåŠ¡
                            const textIcon = document.createElement('span');
                            textIcon.textContent = 'G';
                            textIcon.style.cssText = `
                                display: inline-flex;
                                align-items: center;
                                justify-content: center;
                                width: 16px;
                                height: 16px;
                                background: #4285f4;
                                color: white;
                                border-radius: 2px;
                                font-size: 10px;
                                font-weight: bold;
                            `;
                            this.parentNode.replaceChild(textIcon, this);
                        });
                        
                        searchIcon.appendChild(googleImg);
                        searchButton.setAttribute('title', 'ä½¿ç”¨ Google æœç´¢');
                        break;
                        
                    case 'baidu':
                        // ä½¿ç”¨æœ¬åœ°å›¾æ ‡æˆ–æ–‡æœ¬
                        const baiduImg = document.createElement('img');
                        baiduImg.setAttribute('src', 'icon/baidu.com.png');
                        baiduImg.setAttribute('alt', 'ç™¾åº¦');
                        baiduImg.setAttribute('style', 'width: 16px; height: 16px;');
                        
                        // è®¾ç½®é”™è¯¯å¤„ç†
                        baiduImg.addEventListener('error', function() {
                            const textIcon = document.createElement('span');
                            textIcon.textContent = 'ç™¾';
                            textIcon.style.cssText = `
                                display: inline-flex;
                                align-items: center;
                                justify-content: center;
                                width: 16px;
                                height: 16px;
                                background: #2932e1;
                                color: white;
                                border-radius: 2px;
                                font-size: 10px;
                                font-weight: bold;
                            `;
                            this.parentNode.replaceChild(textIcon, this);
                        });
                        
                        searchIcon.appendChild(baiduImg);
                        searchButton.setAttribute('title', 'ä½¿ç”¨ç™¾åº¦æœç´¢');
                        break;
                        
                    default:
                        searchIcon.textContent = 'ğŸ”';
                        searchButton.setAttribute('title', 'æœç´¢');
                }
            },
            
            async checkGoogleAccess() {
                try {
                    console.log('å¼€å§‹æ£€æµ‹ Google è®¿é—®æ€§...');
                    // ä½¿ç”¨å¤šç§æ–¹æ³•æ£€æµ‹Googleè®¿é—®æ€§
                    const promises = [
                        this.pingGoogle(),
                        this.checkDNS(),
                        this.testImageLoad()
                    ];
                    
                    // å¦‚æœä»»ä½•ä¸€ä¸ªæ–¹æ³•æˆåŠŸï¼Œå°±è®¤ä¸ºå¯ä»¥è®¿é—®Google
                    const results = await Promise.allSettled(promises);
                    console.log('æ£€æµ‹ç»“æœ:', results.map((r, i) => ({
                        method: ['pingGoogle', 'checkDNS', 'testImageLoad'][i],
                        status: r.status,
                        value: r.value
                    })));
                    
                    const canAccess = results.some(result => result.status === 'fulfilled' && result.value === true);
                    console.log('æœ€ç»ˆæ£€æµ‹ç»“æœ: Google å¯è®¿é—® =', canAccess);
                    return canAccess;
                } catch (error) {
                    console.log('æ£€æµ‹è¿‡ç¨‹å‡ºé”™:', error);
                    return false;
                }
            },
            
            async pingGoogle() {
                try {
                    // å°è¯•è®¿é—®Googleçš„faviconï¼Œè¿™ä¸ªè¯·æ±‚é€šå¸¸å¾ˆå¿«
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 2000); // ç¼©çŸ­è¶…æ—¶æ—¶é—´
                    
                    const response = await fetch(`https://www.google.com/favicon.ico?t=${Date.now()}`, {
                        method: 'HEAD',
                        mode: 'no-cors',
                        signal: controller.signal,
                        cache: 'no-cache'
                    });
                    
                    clearTimeout(timeoutId);
                    return true;
                } catch (error) {
                    console.log('Google ping å¤±è´¥:', error.name);
                    return false;
                }
            },
            
            async checkDNS() {
                try {
                    // å°è¯•è§£æGoogleåŸŸå
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 1500); // ç¼©çŸ­è¶…æ—¶æ—¶é—´
                    
                    await fetch(`https://google.com?t=${Date.now()}`, {
                        method: 'HEAD',
                        mode: 'no-cors',
                        signal: controller.signal,
                        cache: 'no-cache'
                    });
                    
                    clearTimeout(timeoutId);
                    return true;
                } catch (error) {
                    console.log('Google DNS æ£€æŸ¥å¤±è´¥:', error.name);
                    return false;
                }
            },
            
            async testImageLoad() {
                return new Promise((resolve) => {
                    const img = new Image();
                    const timeout = setTimeout(() => {
                        img.onload = img.onerror = null;
                        resolve(false);
                    }, 1500); // ç¼©çŸ­è¶…æ—¶æ—¶é—´
                    
                    img.onload = () => {
                        clearTimeout(timeout);
                        resolve(true);
                    };
                    
                    img.onerror = () => {
                        clearTimeout(timeout);
                        console.log('Google å›¾ç‰‡åŠ è½½å¤±è´¥');
                        resolve(false);
                    };
                    
                    img.src = `https://www.google.com/images/branding/googleg/1x/googleg_standard_color_128dp.png?t=${Date.now()}`;
                });
            },
            
            search(query, engine = this.currentEngine) {
                if (!query.trim()) {
                    ErrorManager.show('è¯·è¾“å…¥æœç´¢å†…å®¹', 'warning', 2000);
                    return;
                }
                
                const encodedQuery = encodeURIComponent(query.trim());
                let searchUrl;
                
                switch (engine) {
                    case 'google':
                        searchUrl = `https://www.google.com/search?q=${encodedQuery}`;
                        break;
                    case 'baidu':
                        searchUrl = `https://www.baidu.com/s?wd=${encodedQuery}`;
                        break;
                    case 'scholar':
                        // å­¦æœ¯æœç´¢ä¹Ÿè¦æ ¹æ®å½“å‰å¼•æ“é€‰æ‹©
                        if (this.currentEngine === 'baidu') {
                            // ä½¿ç”¨ç™¾åº¦å­¦æœ¯
                            searchUrl = `https://xueshu.baidu.com/s?wd=${encodedQuery}`;
                        } else {
                            // é»˜è®¤ä½¿ç”¨Google Scholar
                            searchUrl = `https://scholar.google.com/scholar?q=${encodedQuery}`;
                        }
                        break;
                    default:
                        // é»˜è®¤æƒ…å†µä¸‹æ ¹æ®å½“å‰æ£€æµ‹åˆ°çš„å¼•æ“é€‰æ‹©
                        if (this.currentEngine === 'baidu') {
                            searchUrl = `https://www.baidu.com/s?wd=${encodedQuery}`;
                        } else {
                            searchUrl = `https://www.google.com/search?q=${encodedQuery}`;
                        }
                }
                
                window.open(searchUrl, '_blank');
            }
        };

        // é“¾æ¥ç®¡ç† - Link Management
        const LinkManager = {
            async load() {
                try {
                    LoadingManager.showSection('link');
                    ErrorManager.hideSection('link');
                    
                    const response = await fetch('./links.json');
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const links = await response.json();
                    if (!Array.isArray(links)) {
                        throw new Error('é“¾æ¥æ•°æ®æ ¼å¼é”™è¯¯');
                    }
                    
                    AppState.links = links;
                    this.render(links);
                    AppState.retryCount = 0; // é‡ç½®é‡è¯•è®¡æ•°
                    
                } catch (error) {
                    console.error('åŠ è½½é“¾æ¥å¤±è´¥:', error);
                    this.handleError(error);
                } finally {
                    LoadingManager.hideSection('link');
                }
            },

            async loadWithRetry() {
                if (AppState.retryCount >= CONFIG.RETRY_ATTEMPTS) {
                    ErrorManager.show('é‡è¯•æ¬¡æ•°è¿‡å¤šï¼Œè¯·ç¨åå†è¯•', 'error');
                    return;
                }
                
                AppState.retryCount++;
                await Utils.delay(CONFIG.RETRY_DELAY * AppState.retryCount);
                this.load();
            },

            handleError(error) {
                const message = error.message || 'åŠ è½½é“¾æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥';
                ErrorManager.showSection('link', message, () => this.loadWithRetry());
                ErrorManager.show(message, 'error');
            },

            render(links = []) {
                const linkList = document.getElementById('link-list');
                if (!linkList) return;

                linkList.innerHTML = '';
                
                if (links.length === 0) {
                    linkList.innerHTML = '<p style="text-align:center; color: var(--text-secondary);">æš‚æ— é“¾æ¥æ•°æ®</p>';
                    return;
                }

                const fragment = document.createDocumentFragment();
                
                links.forEach(link => {
                    if (!link.url || !link.name) {
                        console.warn('è·³è¿‡æ— æ•ˆé“¾æ¥:', link);
                        return;
                    }
                    
                    const linkItem = this.createLinkElement(link);
                    fragment.appendChild(linkItem);
                });

                linkList.appendChild(fragment);
            },

            createLinkElement(link) {
                const linkItem = document.createElement('a');
                linkItem.href = link.url;
                linkItem.target = '_blank';
                linkItem.className = 'link-item';

                // åˆ›å»ºå›¾æ ‡
                const favicon = this.createFaviconElement(link.url);
                linkItem.appendChild(favicon);
                
                // åˆ›å»ºåç§°
                const nameSpan = document.createElement('span');
                nameSpan.textContent = link.name;
                nameSpan.title = link.name; // æ·»åŠ å·¥å…·æç¤º
                linkItem.appendChild(nameSpan);

                return linkItem;
            },

            createFaviconElement(url) {
                const favicon = document.createElement('img');
                favicon.className = 'favicon';
                favicon.loading = 'lazy'; // æ·»åŠ æ‡’åŠ è½½
                
                const domain = Utils.getDomain(url);
                if (domain) {
                    favicon.src = `icon/${domain}.png`;
                    favicon.onerror = () => {
                        // æ ¹æ®å½“å‰æ£€æµ‹åˆ°çš„æœç´¢å¼•æ“çŠ¶æ€å†³å®šæ˜¯å¦ä½¿ç”¨Googleçš„æœåŠ¡
                        if (this.canUseGoogleServices()) {
                            favicon.src = `https://www.google.com/s2/favicons?domain=${domain}&sz=32`;
                            favicon.onerror = () => {
                                this.setFallbackIcon(favicon, domain);
                            };
                        } else {
                            this.setFallbackIcon(favicon, domain);
                        }
                    };
                } else {
                    favicon.style.display = 'none';
                }
                
                return favicon;
            },

            canUseGoogleServices() {
                // æ£€æŸ¥AppStateä¸­çš„Googleå¯ç”¨æ€§çŠ¶æ€
                return AppState.googleAvailable;
            },

            setFallbackIcon(favicon, domain) {
                // è®¾ç½®å¤‡é€‰å›¾æ ‡ï¼šä½¿ç”¨emojiæˆ–éšè—
                const fallbackEmojis = {
                    'github.com': 'ğŸ™',
                    'baidu.com': 'ğŸ”',
                    'google.com': 'G',
                    'apple.com': 'ğŸ',
                    'microsoft.com': 'ğŸ“',
                    'zhihu.com': 'çŸ¥',
                    'bilibili.com': 'ğŸ“º',
                    'weibo.com': 'å¾®',
                    'taobao.com': 'ğŸ›’',
                    'jd.com': 'ğŸ›ï¸'
                };

                const emoji = fallbackEmojis[domain];
                if (emoji) {
                    // åˆ›å»ºæ–‡æœ¬å›¾æ ‡
                    const textIcon = document.createElement('div');
                    textIcon.className = 'favicon text-favicon';
                    textIcon.textContent = emoji;
                    textIcon.style.cssText = `
                        width: 32px;
                        height: 32px;
                        border-radius: 8px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        background: var(--card-bg);
                        color: var(--text-color);
                        font-size: 16px;
                        font-weight: bold;
                        border: 1px solid var(--border-color);
                    `;
                    favicon.parentNode.replaceChild(textIcon, favicon);
                    } else {
                        // ä½¿ç”¨é»˜è®¤å›¾ç‰‡
                        const defaultImg = document.createElement('img');
                        defaultImg.className = 'favicon';
                        defaultImg.src = 'icon/default.png';
                        defaultImg.alt = 'é»˜è®¤å›¾æ ‡';
                        defaultImg.style.cssText = `
                            width: 32px;
                            height: 32px;
                            border-radius: 8px;
                            background: var(--card-bg);
                            border: 1px solid var(--border-color);
                        `;
                        favicon.parentNode.replaceChild(defaultImg, favicon);
                }
            }
        };

        // ä¸»é¢˜ç®¡ç† - Theme Management
        const ThemeManager = {
            init() {
                // ä»æœ¬åœ°å­˜å‚¨æ¢å¤ä¸»é¢˜è®¾ç½®
                const savedTheme = localStorage.getItem('theme') || 'auto';
                this.setTheme(savedTheme);
                this.updateThemeUI(savedTheme);
            },

            setTheme(theme) {
                AppState.currentTheme = theme;
                localStorage.setItem('theme', theme);
                
                if (theme === 'dark') {
                    document.body.classList.add('dark-mode');
                } else if (theme === 'light') {
                    document.body.classList.remove('dark-mode');
                } else {
                    // Auto theme
                    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    document.body.classList.toggle('dark-mode', isDarkMode);
                }
            },

            updateThemeUI(theme) {
                const themeOptions = document.querySelectorAll('.theme-option');
                themeOptions.forEach(option => {
                    option.classList.toggle('active', option.getAttribute('data-theme') === theme);
                });
            },

            toggle() {
                const currentTheme = AppState.currentTheme;
                const nextTheme = currentTheme === 'light' ? 'dark' : 'light';
                this.setTheme(nextTheme);
                this.updateThemeUI(nextTheme);
            }
        };

        // å†…å®¹åˆ‡æ¢ç®¡ç† - Content Switching Management
        const ContentManager = {
            menuOrder: { 'home': 0, 'search': 1, 'settings': 2 },
            
            init() {
                // ç¡®ä¿åªæœ‰å½“å‰æ´»åŠ¨çš„å†…å®¹å¡ç‰‡æ˜¾ç¤ºï¼Œå…¶ä»–éšè—
                this.initializeContentCards();
                // ç¡®ä¿èœå•é¡¹çŠ¶æ€æ­£ç¡®
                this.updateActiveStates(AppState.currentContent);
            },
            
            initializeContentCards() {
                // è·å–æ‰€æœ‰å†…å®¹å¡ç‰‡
                const contentCards = document.querySelectorAll('.content-card');
                
                contentCards.forEach(card => {
                    const cardId = card.id;
                    const contentType = cardId.replace('content-', '');
                    
                    // æ¸…ç†æ‰€æœ‰åŠ¨ç”»ç±»
                    card.classList.remove('active', 'prev', 'next', 'from-right', 'from-left', 'exit-left', 'exit-right');
                    
                    // åªç»™å½“å‰æ´»åŠ¨å†…å®¹æ·»åŠ  active ç±»
                    if (contentType === AppState.currentContent) {
                        card.classList.add('active');
                    }
                });
            },
            
            switch(targetContent) {
                if (AppState.currentContent === targetContent) return;
                
                const currentIndex = this.menuOrder[AppState.currentContent];
                const targetIndex = this.menuOrder[targetContent];
                const isMovingRight = targetIndex > currentIndex;
                
                this.animateTransition(AppState.currentContent, targetContent, isMovingRight);
                this.updateActiveStates(targetContent);
                
                AppState.currentContent = targetContent;
            },

            animateTransition(currentContent, targetContent, isMovingRight) {
                const currentCard = document.getElementById(`content-${currentContent}`);
                const targetCard = document.getElementById(`content-${targetContent}`);
                
                if (!currentCard || !targetCard) return;
                
                // æ·»åŠ é€€å‡ºåŠ¨ç”»
                currentCard.classList.add(isMovingRight ? 'exit-left' : 'exit-right');
                
                setTimeout(() => {
                    // æ¸…ç†æ‰€æœ‰çŠ¶æ€
                    document.querySelectorAll('.content-card').forEach(card => {
                        card.classList.remove('active', 'prev', 'next', 'from-right', 'from-left', 'exit-left', 'exit-right');
                    });
                    
                    // æ¿€æ´»ç›®æ ‡å¡ç‰‡
                    targetCard.classList.add('active');
                    targetCard.classList.add(isMovingRight ? 'from-right' : 'from-left');
                    
                    // æ¸…ç†åŠ¨ç”»ç±»
                    setTimeout(() => {
                        targetCard.classList.remove('from-right', 'from-left');
                    }, CONFIG.ANIMATION_DURATION);
                    
                }, 50);
            },

            updateActiveStates(targetContent) {
                // æ›´æ–°èœå•é¡¹çŠ¶æ€
                document.querySelectorAll('.dock-item').forEach(item => {
                    const isActive = item.getAttribute('data-content') === targetContent;
                    item.classList.toggle('active', isActive);
                });
                
                // æ›´æ–°æ°”æ³¡ä½ç½®
                const targetMenuItem = document.querySelector(`.dock-item[data-content="${targetContent}"]`);
                if (targetMenuItem) {
                    DockManager.moveBubbleTo(targetMenuItem);
                }
            }
        };

        // äº‹ä»¶å¤„ç†ç®¡ç† - Event Handler Management
        const EventManager = {
            init() {
                this.setupDockEvents();
                this.setupSearchEvents();
                this.setupThemeEvents();
                this.setupKeyboardEvents();
                this.setupGlobalEvents();
            },

            setupDockEvents() {
                const dockItems = document.querySelectorAll('.dock-item');
                dockItems.forEach(item => {
                    item.addEventListener('click', this.handleDockItemClick.bind(this));
                    item.addEventListener('mouseenter', this.handleDockItemHover.bind(this));
                    item.addEventListener('mouseleave', this.handleDockItemLeave.bind(this));
                    
                    // è§¦æ‘¸äº‹ä»¶æ”¯æŒ
                    if ('ontouchstart' in window) {
                        item.addEventListener('touchstart', this.handleDockItemTouch.bind(this));
                        item.addEventListener('touchend', this.handleDockItemTouchEnd.bind(this));
                    }
                });

                const dock = document.querySelector('.dock');
                if (dock) {
                    dock.addEventListener('mouseenter', this.handleDockHover.bind(this));
                    dock.addEventListener('mouseleave', this.handleDockLeave.bind(this));
                }
            },

            setupSearchEvents() {
                // ä¸»æœç´¢æ¡†äº‹ä»¶
                const mainSearchInput = document.getElementById('main-search-input');
                const mainSearchButton = document.getElementById('main-search-btn');
                
                if (mainSearchButton) {
                    mainSearchButton.addEventListener('click', () => this.handleMainSearch());
                }
                
                if (mainSearchInput) {
                    mainSearchInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            this.handleMainSearch();
                        }
                    });
                }

                // å­¦æœ¯æœç´¢æ¡†äº‹ä»¶
                const scholarSearchInput = document.getElementById('scholar-search-input');
                const scholarSearchButton = document.getElementById('scholar-search-btn');
                
                if (scholarSearchButton) {
                    scholarSearchButton.addEventListener('click', () => this.handleScholarSearch());
                }

                if (scholarSearchInput) {
                    scholarSearchInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            this.handleScholarSearch();
                        }
                    });
                }

                // æ ‡ç­¾ç‚¹å‡»æœç´¢
                const suggestionTags = document.querySelectorAll('.tag');
                suggestionTags.forEach(tag => {
                    tag.addEventListener('click', this.handleTagClick.bind(this));
                });
            },

            setupThemeEvents() {
                const themeToggle = document.querySelector('.theme-toggle');
                const themeOptions = document.querySelectorAll('.theme-option');
                
                if (themeToggle) {
                    themeToggle.addEventListener('click', (e) => {
                        e.preventDefault();
                        ThemeManager.toggle();
                    });
                }

                themeOptions.forEach(option => {
                    option.addEventListener('click', this.handleThemeOptionClick.bind(this));
                });
            },

            setupKeyboardEvents() {
                document.addEventListener('keydown', this.handleKeyDown.bind(this));
            },

            setupGlobalEvents() {
                window.addEventListener('resize', Utils.debounce(this.handleResize.bind(this), 250));
                
                // ç›‘å¬ç³»ç»Ÿä¸»é¢˜å˜åŒ–
                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', this.handleSystemThemeChange.bind(this));
            },

            // äº‹ä»¶å¤„ç†æ–¹æ³•
            handleDockItemClick(e) {
                e.preventDefault();
                const targetContent = e.currentTarget.getAttribute('data-content');
                ContentManager.switch(targetContent);
            },

            handleDockItemHover(e) {
                DockManager.moveBubbleTo(e.currentTarget);
                DockManager.addMagneticEffect(e.currentTarget);
            },

            handleDockItemLeave(e) {
                DockManager.resetMagneticEffect();
            },

            handleDockItemTouch(e) {
                e.preventDefault();
                DockManager.moveBubbleTo(e.currentTarget);
                e.currentTarget.style.transform = 'scale(0.95)';
            },

            handleDockItemTouchEnd(e) {
                e.preventDefault();
                e.currentTarget.style.transform = '';
                const targetContent = e.currentTarget.getAttribute('data-content');
                ContentManager.switch(targetContent);
            },

            handleDockHover(e) {
                e.currentTarget.style.transform = 'translateX(-50%) translateY(-2px) scale(1.02)';
            },

            handleDockLeave(e) {
                e.currentTarget.style.transform = 'translateX(-50%) translateY(0) scale(1)';
                
                setTimeout(() => {
                    const activeItem = document.querySelector('.dock-item.active');
                    if (activeItem) {
                        DockManager.moveBubbleTo(activeItem);
                    }
                    DockManager.resetMagneticEffect();
                }, 150);
            },

            async handleMainSearch() {
                const searchInput = document.getElementById('main-search-input');
                const query = searchInput?.value.trim();
                
                if (!query) {
                    ErrorManager.show('è¯·è¾“å…¥æœç´¢å†…å®¹', 'warning', 2000);
                    return;
                }

                try {
                    this.setMainSearchLoading(true);
                    await Utils.delay(300); // çŸ­æš‚å»¶è¿Ÿä»¥æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                    SearchManager.search(query);
                } catch (error) {
                    ErrorManager.show('æœç´¢å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                } finally {
                    this.setMainSearchLoading(false);
                }
            },

            async handleScholarSearch() {
                const searchInput = document.getElementById('scholar-search-input');
                const query = searchInput?.value.trim();
                
                if (!query) {
                    ErrorManager.show('è¯·è¾“å…¥æœç´¢å†…å®¹', 'warning', 2000);
                    return;
                }

                try {
                    this.setScholarSearchLoading(true);
                    await Utils.delay(300);
                    SearchManager.search(query, 'scholar');
                } catch (error) {
                    ErrorManager.show('å­¦æœ¯æœç´¢å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                } finally {
                    this.setScholarSearchLoading(false);
                }
            },

            handleSearch() {
                // ä¿ç•™åŸæœ‰çš„æœç´¢æ–¹æ³•ä»¥å…¼å®¹
                this.handleScholarSearch();
            },

            handleSearchKeyPress(e) {
                if (e.key === 'Enter') {
                    this.handleScholarSearch();
                }
            },

            handleSearchInput(e) {
                // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æœç´¢å»ºè®®é€»è¾‘
                const query = e.target.value.trim();
                console.log('æœç´¢è¾“å…¥:', query);
            },

            handleTagClick(e) {
                const query = e.target.textContent;
                SearchManager.search(query);
            },

            handleThemeOptionClick(e) {
                const theme = e.currentTarget.getAttribute('data-theme');
                ThemeManager.setTheme(theme);
                ThemeManager.updateThemeUI(theme);
            },

            handleKeyDown(e) {
                // é”®ç›˜å¿«æ·é”®
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key) {
                        case '1':
                            e.preventDefault();
                            ContentManager.switch('home');
                            break;
                        case '2':
                            e.preventDefault();
                            ContentManager.switch('search');
                            break;
                        case '3':
                            e.preventDefault();
                            ContentManager.switch('settings');
                            break;
                        case 'd':
                            e.preventDefault();
                            ThemeManager.toggle();
                            break;
                    }
                }
                
                // ESC é”®éšè—é”™è¯¯æç¤º
                if (e.key === 'Escape') {
                    ErrorManager.hide();
                }
            },

            handleResize() {
                // å“åº”å¼å¤„ç†
                console.log('çª—å£å¤§å°æ”¹å˜');
            },

            handleSystemThemeChange(e) {
                if (AppState.currentTheme === 'auto') {
                    document.body.classList.toggle('dark-mode', e.matches);
                }
            },

            setMainSearchLoading(isLoading) {
                const searchIcon = document.querySelector('#main-search-btn .search-icon');
                const searchLoading = document.querySelector('#main-search-btn .search-loading');
                const searchButton = document.getElementById('main-search-btn');
                
                if (searchIcon && searchLoading && searchButton) {
                    searchIcon.style.display = isLoading ? 'none' : 'inline-flex';
                    searchLoading.style.display = isLoading ? 'inline' : 'none';
                    searchButton.disabled = isLoading;
                }
            },

            setScholarSearchLoading(isLoading) {
                const searchIcon = document.querySelector('#scholar-search-btn .search-icon');
                const searchLoading = document.querySelector('#scholar-search-btn .search-loading');
                const searchButton = document.getElementById('scholar-search-btn');
                
                if (searchIcon && searchLoading && searchButton) {
                    searchIcon.style.display = isLoading ? 'none' : 'inline';
                    searchLoading.style.display = isLoading ? 'inline' : 'none';
                    searchButton.disabled = isLoading;
                }
            },

            setSearchLoading(isLoading) {
                // å…¼å®¹æ–¹æ³•ï¼Œè°ƒç”¨å­¦æœ¯æœç´¢åŠ è½½çŠ¶æ€
                this.setScholarSearchLoading(isLoading);
            }
        };
        // Dockç®¡ç† - Dock Management
        const DockManager = {
            init() {
                const activeItem = document.querySelector('.dock-item.active');
                if (activeItem) {
                    setTimeout(() => this.moveBubbleTo(activeItem), 100);
                }
            },

            moveBubbleTo(item) {
                if (!item) return;
                
                const bubble = document.querySelector('.dock-bubble');
                const dock = document.querySelector('.dock');
                if (!bubble || !dock) return;
                
                const itemRect = item.getBoundingClientRect();
                const dockRect = dock.getBoundingClientRect();
                const left = itemRect.left - dockRect.left;
                const width = itemRect.width;

                bubble.style.left = `${left}px`;
                bubble.style.width = `${width}px`;
                bubble.style.opacity = '1';
                bubble.style.transform = 'scale(1)';
                
                // æ·»åŠ å‘å…‰æ•ˆæœ
                const isDarkMode = document.body.classList.contains('dark-mode');
                const glowColor = isDarkMode ? 'rgba(10, 132, 255, 0.2)' : 'rgba(0, 113, 227, 0.15)';
                
                if (item.classList.contains('active')) {
                    bubble.style.boxShadow = `
                        0 4px 16px rgba(0, 0, 0, 0.1),
                        inset 0 1px 1px rgba(255, 255, 255, 0.3),
                        0 0 20px ${glowColor}
                    `;
                } else {
                    bubble.style.boxShadow = `
                        0 4px 16px rgba(0, 0, 0, 0.1),
                        inset 0 1px 1px rgba(255, 255, 255, 0.3)
                    `;
                }
            },

            addMagneticEffect(hoveredItem) {
                const dockItems = document.querySelectorAll('.dock-item');
                const hoveredIndex = Array.from(dockItems).indexOf(hoveredItem);
                
                dockItems.forEach((item, index) => {
                    const distance = Math.abs(index - hoveredIndex);
                    if (distance === 1) {
                        const direction = index < hoveredIndex ? 2 : -2;
                        item.style.transform = `translateX(${direction}px) scale(1.02)`;
                    } else if (distance > 1) {
                        item.style.transform = '';
                    }
                });
            },

            resetMagneticEffect() {
                document.querySelectorAll('.dock-item').forEach(item => {
                    item.style.transform = '';
                });
            },

            hide() {
                const bubble = document.querySelector('.dock-bubble');
                if (bubble) {
                    bubble.style.opacity = '0';
                    bubble.style.transform = 'scale(0.9)';
                }
            }
        };

        // Dockè‡ªåŠ¨éšè—ç®¡ç† - Dock Auto Hide Management
        const DockAutoHideManager = {
            isAtBottom: false,
            isDockHidden: false,
            lastScrollY: 0,
            scrollDirection: 'up',
            isMouseOverIndicator: false,
            hideTimeout: null,
            showTimeout: null, // æ–°å¢ï¼šç”¨äº3ç§’æ˜¾ç¤ºè®¡æ—¶

            init() {
                console.log('=== DockAutoHideManager å¼€å§‹åˆå§‹åŒ– ===');
                try {
                    this.setupScrollListener();
                    this.setupHoverEvents();
                    this.lastScrollY = window.scrollY;
                    console.log('=== DockAutoHideManager åˆå§‹åŒ–å®Œæˆ ===');
                    
                    // æµ‹è¯•ï¼šç«‹å³æ‰§è¡Œä¸€æ¬¡handleScroll
                    console.log('æµ‹è¯•ï¼šæ‰§è¡Œä¸€æ¬¡handleScroll');
                    this.handleScroll();
                } catch (error) {
                    console.error('DockAutoHideManager åˆå§‹åŒ–å¤±è´¥:', error);
                }
            },

            setupScrollListener() {
                console.log('=== è®¾ç½®æ»šåŠ¨ç›‘å¬å™¨ ===');
                let ticking = false;
                
                window.addEventListener('scroll', () => {
                    console.log('æ»šåŠ¨äº‹ä»¶è§¦å‘');
                    if (!ticking) {
                        requestAnimationFrame(() => {
                            this.handleScroll();
                            ticking = false;
                        });
                        ticking = true;
                    }
                });
                console.log('=== æ»šåŠ¨ç›‘å¬å™¨è®¾ç½®å®Œæˆ ===');
            },

            setupHoverEvents() {
                console.log('è®¾ç½®æ‚¬åœäº‹ä»¶...');
                const dock = document.querySelector('.dock');
                const indicator = document.querySelector('.bottom-indicator');

                console.log('Dockå…ƒç´ :', dock);
                console.log('Indicatorå…ƒç´ :', indicator);

                if (indicator) {
                    // é¼ æ ‡è¿›å…¥æŒ‡ç¤ºå™¨
                    indicator.addEventListener('mouseenter', () => {
                        console.log('é¼ æ ‡è¿›å…¥æŒ‡ç¤ºå™¨');
                        this.isMouseOverIndicator = true;
                        
                        // æ¸…é™¤ä»»ä½•ç°æœ‰çš„è®¡æ—¶å™¨
                        this.clearShowTimeout();
                        this.clearHideTimeout();
                        
                        if (this.isDockHidden) {
                            this.showDock();
                        }
                    });

                    // é¼ æ ‡ç¦»å¼€æŒ‡ç¤ºå™¨
                    indicator.addEventListener('mouseleave', () => {
                        console.log('é¼ æ ‡ç¦»å¼€æŒ‡ç¤ºå™¨ï¼Œè®¾ç½®3ç§’åéšè—');
                        this.isMouseOverIndicator = false;
                        
                        if (this.isDockHidden === false) {
                            // è®¾ç½®3ç§’åéšè—
                            this.scheduleShowTimeout();
                        }
                    });

                    // ç‚¹å‡»æŒ‡ç¤ºå™¨
                    indicator.addEventListener('click', (e) => {
                        console.log('ç‚¹å‡»æŒ‡ç¤ºå™¨');
                        e.preventDefault();
                        e.stopPropagation();
                        if (this.isDockHidden) {
                            this.showDock();
                            // æ˜¾ç¤º3ç§’åå†æ¬¡éšè—
                            this.scheduleShowTimeout();
                        }
                    });
                    console.log('æŒ‡ç¤ºå™¨äº‹ä»¶ç»‘å®šå®Œæˆ');
                }

                if (dock) {
                    // é¼ æ ‡è¿›å…¥dockæ—¶
                    dock.addEventListener('mouseenter', () => {
                        console.log('é¼ æ ‡è¿›å…¥dock');
                        if (this.isDockHidden) {
                            this.showDock();
                        }
                        // æ¸…é™¤æ‰€æœ‰è®¡æ—¶å™¨
                        this.clearHideTimeout();
                        this.clearShowTimeout();
                    });

                    // é¼ æ ‡ç¦»å¼€dockæ—¶
                    dock.addEventListener('mouseleave', () => {
                        console.log('é¼ æ ‡ç¦»å¼€dock');
                        if (!this.isMouseOverIndicator) {
                            // è®¾ç½®3ç§’åéšè—
                            this.scheduleShowTimeout();
                        }
                    });
                    console.log('Dockäº‹ä»¶ç»‘å®šå®Œæˆ');
                }
                console.log('æ‚¬åœäº‹ä»¶è®¾ç½®å®Œæˆ');
            },

            handleScroll() {
                const currentScrollY = window.scrollY;
                const maxScroll = document.documentElement.scrollHeight - window.innerHeight;
                
                console.log('æ»šåŠ¨è°ƒè¯•ä¿¡æ¯:', {
                    currentScrollY: currentScrollY,
                    maxScroll: maxScroll,
                    documentHeight: document.documentElement.scrollHeight,
                    windowHeight: window.innerHeight
                });
                
                // åˆ¤æ–­æ»šåŠ¨æ–¹å‘
                this.scrollDirection = currentScrollY > this.lastScrollY ? 'down' : 'up';
                this.lastScrollY = currentScrollY;

                // åˆ¤æ–­æ˜¯å¦æ»šåŠ¨åˆ°50%ä½ç½®ï¼ˆè¿›ä¸€æ­¥é™ä½é˜ˆå€¼ä»¥ä¾¿æµ‹è¯•ï¼‰
                const wasAtBottom = this.isAtBottom;
                // ä¿®æ­£æ»šåŠ¨ç™¾åˆ†æ¯”è®¡ç®—ï¼šå½“å‰æ»šåŠ¨ä½ç½®ä¸æ€»å¯æ»šåŠ¨è·ç¦»çš„æ¯”ä¾‹
                const scrollPercentage = maxScroll > 0 ? (currentScrollY / maxScroll) : 0;
                // å½“æ»šåŠ¨è¶…è¿‡50%æ—¶è§¦å‘éšè—ï¼ˆè¿›ä¸€æ­¥é™ä½é˜ˆå€¼ï¼‰
                this.isAtBottom = scrollPercentage >= 0.5;
                
                console.log('æ»šåŠ¨ç™¾åˆ†æ¯”:', Math.round(scrollPercentage * 100) + '%', 'æ˜¯å¦è¾¾åˆ°50%:', this.isAtBottom);

                if (this.isAtBottom !== wasAtBottom) {
                    console.log('æ»šåŠ¨ä½ç½®çŠ¶æ€æ”¹å˜:', this.isAtBottom ? 'åˆ°è¾¾50%ä½ç½®' : 'ç¦»å¼€50%ä½ç½®', 'å½“å‰æ»šåŠ¨ç™¾åˆ†æ¯”:', Math.round(scrollPercentage * 100) + '%');
                }

                // å¦‚æœåˆšç¦»å¼€50%ä½ç½®ï¼Œæ˜¾ç¤ºdockå¹¶éšè—æŒ‡ç¤ºå™¨
                if (!this.isAtBottom && wasAtBottom) {
                    console.log('ç¦»å¼€50%ä½ç½®ï¼Œæ˜¾ç¤ºdock');
                    this.showDock();
                }
                
                // å¦‚æœåˆšåˆ°è¾¾50%ä½ç½®ä¸”é¼ æ ‡ä¸åœ¨æŒ‡ç¤ºå™¨ä¸Šï¼Œéšè—dock
                if (this.isAtBottom && !wasAtBottom && !this.isMouseOverIndicator) {
                    console.log('åˆ°è¾¾50%ä½ç½®ä¸”é¼ æ ‡ä¸åœ¨æŒ‡ç¤ºå™¨ä¸Šï¼Œå‡†å¤‡éšè—dock');
                    this.scheduleHideDock();
                }

                // å¤„ç†parallaxæ•ˆæœï¼ˆåªåœ¨dockå¯è§æ—¶ï¼‰
                if (!this.isDockHidden) {
                    const parallax = currentScrollY * CONFIG.PARALLAX_FACTOR;
                    const dock = document.querySelector('.dock');
                    if (dock && !dock.classList.contains('hidden')) {
                        dock.style.transform = `translateX(-50%) translateY(${parallax}px)`;
                    }
                }
            },

            scheduleHideDock() {
                console.log('è®¡åˆ’éšè—dock (800mså)');
                this.clearHideTimeout();
                this.hideTimeout = setTimeout(() => {
                    if (this.isAtBottom && !this.isMouseOverIndicator) {
                        console.log('æ‰§è¡Œéšè—dock');
                        this.hideDock();
                    } else {
                        console.log('å–æ¶ˆéšè—dock - æ¡ä»¶ä¸æ»¡è¶³');
                    }
                }, 800); // å»¶è¿Ÿ800msåéšè—
            },

            hideDock() {
                console.log('éšè—dock');
                const dock = document.querySelector('.dock');
                const indicator = document.querySelector('.bottom-indicator');
                
                if (dock && !this.isDockHidden) {
                    dock.classList.add('hidden');
                    dock.classList.remove('showing');
                    this.isDockHidden = true;
                    console.log('Dockå·²éšè—');
                }
                
                if (indicator) {
                    indicator.classList.add('visible');
                    console.log('æŒ‡ç¤ºå™¨å·²æ˜¾ç¤º');
                }
            },

            showDock() {
                console.log('æ˜¾ç¤ºdock');
                const dock = document.querySelector('.dock');
                const indicator = document.querySelector('.bottom-indicator');
                
                if (dock) {
                    dock.classList.remove('hidden');
                    dock.classList.add('showing');
                    this.isDockHidden = false;
                    
                    // æ¢å¤parallaxä½ç½®ï¼Œä½†éœ€è¦å»¶è¿Ÿæ‰§è¡Œé¿å…è¢«CSS transitionè¦†ç›–
                    setTimeout(() => {
                        if (!this.isDockHidden) {
                            const parallax = this.lastScrollY * CONFIG.PARALLAX_FACTOR;
                            dock.style.transform = `translateX(-50%) translateY(${parallax}px)`;
                        }
                    }, 100);
                    console.log('Dockå·²æ˜¾ç¤º');
                }
                
                if (indicator) {
                    indicator.classList.remove('visible');
                    console.log('æŒ‡ç¤ºå™¨å·²éšè—');
                }
            },

            clearHideTimeout() {
                if (this.hideTimeout) {
                    clearTimeout(this.hideTimeout);
                    this.hideTimeout = null;
                    console.log('æ¸…é™¤éšè—è®¡æ—¶å™¨');
                }
            },

            scheduleShowTimeout() {
                console.log('è®¾ç½®3ç§’åéšè—dock');
                this.clearShowTimeout();
                this.showTimeout = setTimeout(() => {
                    console.log('3ç§’æ—¶é—´åˆ°ï¼Œéšè—dock');
                    if (!this.isMouseOverIndicator) {
                        this.hideDock();
                    }
                    this.showTimeout = null;
                }, 3000);
            },

            clearShowTimeout() {
                if (this.showTimeout) {
                    clearTimeout(this.showTimeout);
                    this.showTimeout = null;
                    console.log('æ¸…é™¤3ç§’æ˜¾ç¤ºè®¡æ—¶å™¨');
                }
            }
        };

        // åº”ç”¨åˆå§‹åŒ– - Application Initialization
        const App = {
            async init() {
                try {
                    LoadingManager.show('æ­£åœ¨åˆå§‹åŒ–åº”ç”¨...');
                    
                    // é¢„åŠ è½½å…³é”®èµ„æº
                    this.preloadResources();
                    
                    // åˆå§‹åŒ–å„ä¸ªç®¡ç†å™¨
                    console.log('å¼€å§‹åˆå§‹åŒ–å„ä¸ªç®¡ç†å™¨...');
                    ThemeManager.init();
                    console.log('ThemeManager åˆå§‹åŒ–å®Œæˆ');
                    DockManager.init();
                    console.log('DockManager åˆå§‹åŒ–å®Œæˆ');
                    // DockAutoHideManager å·²è¢«æ–°ç‰ˆæœ¬æ›¿æ¢ï¼Œä¸å†éœ€è¦åˆå§‹åŒ–
                    ContentManager.init();
                    console.log('ContentManager åˆå§‹åŒ–å®Œæˆ');
                    EventManager.init();
                    console.log('EventManager åˆå§‹åŒ–å®Œæˆ');
                    
                    // æ£€æµ‹æœç´¢å¼•æ“ï¼ˆå¹¶è¡Œæ‰§è¡Œï¼‰
                    const searchDetectionPromise = SearchManager.detectSearchEngine();
                    
                    // åŠ è½½é“¾æ¥æ•°æ®
                    await LinkManager.load();
                    
                    // ç­‰å¾…æœç´¢å¼•æ“æ£€æµ‹å®Œæˆ
                    await searchDetectionPromise;
                    
                    // æ€§èƒ½ä¼˜åŒ–ï¼šé¢„åŠ è½½å›¾æ ‡
                    this.preloadIcons();
                    
                    // åˆå§‹åŒ–å®Œæˆ
                    LoadingManager.hide();
                    
                    // æ˜¾ç¤ºä½¿ç”¨æç¤ºï¼ˆä»…é¦–æ¬¡è®¿é—®ï¼‰
                    this.showFirstTimeHints();
                    
                } catch (error) {
                    console.error('åº”ç”¨åˆå§‹åŒ–å¤±è´¥:', error);
                    LoadingManager.hide();
                    ErrorManager.show('åº”ç”¨åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 'error');
                }
            },

            preloadResources() {
                // é¢„åŠ è½½å…³é”®CSSå’Œå­—ä½“
                const criticalResources = [
                    'styles/variables.css',
                    'styles/base.css'
                ];
                
                criticalResources.forEach(href => {
                    const link = document.createElement('link');
                    link.rel = 'preload';
                    link.as = 'style';
                    link.href = href;
                    document.head.appendChild(link);
                });
            },

            preloadIcons() {
                // é¢„åŠ è½½å¸¸ç”¨åŸŸåçš„å›¾æ ‡
                const commonDomains = [
                    'google.com', 'github.com', 'baidu.com', 
                    'apple.com.cn', 'microsoft.com'
                ];
                
                commonDomains.forEach(domain => {
                    const img = new Image();
                    img.src = `icon/${domain}.png`;
                    img.onerror = () => {
                        // å¦‚æœæœ¬åœ°å›¾æ ‡ä¸å­˜åœ¨ï¼Œé¢„åŠ è½½Googleå›¾æ ‡
                        const fallbackImg = new Image();
                        fallbackImg.src = `https://www.google.com/s2/favicons?domain=${domain}&sz=32`;
                    };
                });
            },

            showFirstTimeHints() {
                const hasVisited = localStorage.getItem('hasVisited');
                if (!hasVisited) {
                    setTimeout(() => {
                        ErrorManager.show('ğŸ’¡ æç¤ºï¼šä½¿ç”¨ Ctrl/Cmd + 1/2/3 å¿«é€Ÿåˆ‡æ¢é¡µé¢ï¼ŒCtrl/Cmd + D åˆ‡æ¢ä¸»é¢˜ã€‚æœç´¢æŒ‰é’®å›¾æ ‡æ˜¾ç¤ºå½“å‰ä½¿ç”¨çš„æœç´¢å¼•æ“ï¼', 'success', 10000);
                        localStorage.setItem('hasVisited', 'true');
                    }, 3000);
                }
            }
        };

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', () => {
            App.init();
        });

        // å…¼å®¹æ—§ç‰ˆæœ¬çš„å…¨å±€å‡½æ•°
        window.toggleTheme = () => ThemeManager.toggle();
        window.switchContent = (content) => ContentManager.switch(content);
    </script>

    <!-- Dock è‡ªåŠ¨éšè—åŠŸèƒ½ - è¶…çº§ç®€åŒ–ç‰ˆæœ¬ -->
    <script>
        console.log('ğŸš€ å¼€å§‹åŠ è½½è‡ªåŠ¨éšè—åŠŸèƒ½');
        
        // æ»šåŠ¨éšè—åŠŸèƒ½
        let scrollCount = 0;
        let hideTimeout;
        
        // ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–æ»šåŠ¨éšè—åŠŸèƒ½
        document.addEventListener('DOMContentLoaded', function() {
            const dock = document.querySelector('.dock');
            const indicator = document.querySelector('.bottom-indicator');
            
            if (dock) {
                function handleScroll() {
                    scrollCount++;
                    const scrollY = window.scrollY;
                    const maxScroll = document.documentElement.scrollHeight - window.innerHeight;
                    const percentage = maxScroll > 0 ? (scrollY / maxScroll) * 100 : 0;
                    
                    console.log(`âšª æ»šåŠ¨äº‹ä»¶ #${scrollCount}:`);
                    console.log(`   scrollY: ${scrollY}, ç™¾åˆ†æ¯”: ${percentage.toFixed(1)}%`);
                    
                    clearTimeout(hideTimeout);
                    
                    if (percentage >= 10) { // é™ä½åˆ°10%æ›´å®¹æ˜“è§¦å‘
                        console.log('â¬‡ï¸ è¾¾åˆ°10%ï¼Œå‡†å¤‡éšè—dock');
                        hideTimeout = setTimeout(() => {
                            console.log('ğŸ”½ æ‰§è¡Œæ»šåŠ¨éšè—');
                            dock.style.setProperty('transform', 'translateX(-50%) translateY(100%)', 'important');
                            dock.style.opacity = '0';
                            if (indicator) indicator.style.opacity = '0.8';
                        }, 100); // å‡å°‘åˆ°100ms
                    } else {
                        console.log('â¬†ï¸ å›åˆ°10%ä»¥ä¸‹ï¼Œæ˜¾ç¤ºdock');
                        dock.style.setProperty('transform', 'translateX(-50%) translateY(0)', 'important');
                        dock.style.opacity = '1';
                        if (indicator) indicator.style.opacity = '0';
                    }
                }
                
                // æ·»åŠ æ»šåŠ¨äº‹ä»¶ç›‘å¬å™¨
                window.addEventListener('scroll', handleScroll);
                console.log('ğŸ‰ æ»šåŠ¨éšè—åŠŸèƒ½åˆå§‹åŒ–å®Œæˆ');
            }
        });
        
        console.log('ğŸ‰ åº”ç”¨åˆå§‹åŒ–å®Œæˆ');
    </script>
</body>
</html>
