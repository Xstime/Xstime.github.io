<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>由此出发🛫</title>
    <link rel="icon" type="image/png" href="touxiang.png">   
    <link rel="stylesheet" href="styles/variables.css">
    <link rel="stylesheet" href="styles/base.css">
    <link rel="stylesheet" href="styles/components.css">
    <link rel="stylesheet" href="styles/layout.css">
    <link rel="stylesheet" href="styles/animations.css">
    <link rel="stylesheet" href="styles/link.css">
    <link rel="stylesheet" href="styles/loading.css">
</head>
<body>

    <a href="index.html" class="fixed-button back-button">←</a>
    <button class="fixed-button theme-toggle">🌗</button>
    <a href="http://192.168.5.1/cgi-bin/luci/" target="_blank" class="fixed-button router-button">🛜</a>

    <!-- 全局加载遮罩 - Global Loading Overlay -->
    <div id="global-loading" class="loading-overlay">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p class="loading-text">正在加载...</p>
        </div>
    </div>

    <!-- 全局错误提示 - Global Error Toast -->
    <div id="error-toast" class="error-toast">
        <div class="error-content">
            <span class="error-icon">⚠️</span>
            <span class="error-message"></span>
            <button class="error-close" onclick="hideErrorToast()">×</button>
        </div>
    </div>

    <!-- 主内容容器 - Main Content Container -->
    <div class="main-container">
        
        <!-- 内容卡片1：由此出发 - Content Card 1: Launch Pad -->
        <div id="content-home" class="content-card active">
            <div class="container">
                <h1 class="main-title">由此出发</h1>
                <!-- 链接列表加载状态 -->
                <div id="link-loading" class="section-loading">
                    <div class="skeleton-grid">
                        <div class="skeleton-item" v-for="i in 8"></div>
                        <div class="skeleton-item"></div>
                        <div class="skeleton-item"></div>
                        <div class="skeleton-item"></div>
                        <div class="skeleton-item"></div>
                        <div class="skeleton-item"></div>
                        <div class="skeleton-item"></div>
                        <div class="skeleton-item"></div>
                        <div class="skeleton-item"></div>
                    </div>
                </div>
                <div id="link-list"></div>
                <!-- 链接列表错误状态 -->
                <div id="link-error" class="error-state" style="display: none;">
                    <div class="error-icon">😵</div>
                    <h3>加载失败</h3>
                    <p>无法加载链接数据，请检查网络连接</p>
                    <button class="retry-button" onclick="retryLoadLinks()">重试</button>
                </div>
            </div>
        </div>

        <!-- 内容卡片2：搜索发现 - Content Card 2: Search & Discovery -->
        <div id="content-search" class="content-card">
            <div class="container">
                <h1 class="main-title">学术资源</h1>
                <div class="search-content">
                    <div class="search-box">
                        <input type="text" id="search-input" placeholder="搜索学术数据库、论文或工具..." class="search-input">
                        <button class="search-button" id="search-btn">
                            <span class="search-icon">🔍</span>
                            <span class="search-loading" style="display: none;">⏳</span>
                        </button>
                    </div>
                    <div class="search-suggestions">
                        <h3>常用学术标签</h3>
                        <div class="suggestion-tags">
                            <span class="tag">论文检索</span>
                            <span class="tag">学术数据库</span>
                            <span class="tag">文献管理</span>
                            <span class="tag">学术写作</span>
                            <span class="tag">开源期刊</span>
                        </div>
                    </div>
                    <div class="quick-access">
                        <h3>快速访问</h3>
                        <div class="quick-links">
                            <a href="https://scholar.google.com" target="_blank" class="quick-link">
                                <img src="icon/scholar.google.com.png" alt="Google Scholar" class="quick-icon" 
                                     onerror="this.src='https://www.google.com/s2/favicons?domain=scholar.google.com&sz=32'">
                                <span>Google Scholar</span>
                            </a>
                            <a href="https://www.cnki.net" target="_blank" class="quick-link">
                                <img src="icon/www.cnki.net.png" alt="中国知网" class="quick-icon"
                                    onerror="this.src='https://www.google.com/s2/favicons?domain=www.cnki.net&sz=32'">
                                <span>中国知网</span>
                            </a>
                            <a href="https://www.webofscience.com" target="_blank" class="quick-link">
                                <img src="icon/www.webofscience.com.png" alt="Web of Science" class="quick-icon" 
                                     onerror="this.src='https://www.google.com/s2/favicons?domain=www.webofscience.com&sz=32'">
                                <span>Web of Science</span>
                            </a>
                            <a href="https://www.wanfangdata.com.cn" target="_blank" class="quick-link">
                                <img src="icon/www.wanfangdata.com.cn.png" alt="万方数据" class="quick-icon"
                                     onerror="this.src='https://www.google.com/s2/favicons?domain=www.wanfangdata.com.cn&sz=32'">
                                <span>万方数据</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 内容卡片3：系统设置 - Content Card 3: System Settings -->
        <div id="content-settings" class="content-card">
            <div class="container">
                <h1 class="main-title">系统设置</h1>
                <div class="settings-content">
                    <div class="settings-section">
                        <h3>外观设置</h3>
                        <div class="setting-item">
                            <label>主题模式</label>
                            <div class="theme-selector">
                                <button class="theme-option active" data-theme="auto">🌗 自动</button>
                                <button class="theme-option" data-theme="light">☀️ 明亮</button>
                                <button class="theme-option" data-theme="dark">🌙 深色</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="dock">
        <div class="dock-bubble"></div>
        <a href="#" class="dock-item active" data-content="home">
            <span class="dock-icon">🏠</span>
            <span class="dock-label">主页</span>
        </a>
        <a href="#" class="dock-item" data-content="search">
            <span class="dock-icon">👨‍🎓</span>
            <span class="dock-label">学术</span>
        </a>
        <a href="#" class="dock-item" data-content="settings">
            <span class="dock-icon">⚙️</span>
            <span class="dock-label">设置</span>
        </a>
    </div>

    <script>
        // 全局配置常量 - Global Configuration Constants
        const CONFIG = {
            ANIMATION_DURATION: 500,
            LOADING_DELAY: 300,
            ERROR_DISPLAY_TIME: 5000,
            PARALLAX_FACTOR: 0.02,
            BUBBLE_TRANSITION: 'cubic-bezier(0.4, 0, 0.2, 1)',
            RETRY_ATTEMPTS: 3,
            RETRY_DELAY: 1000
        };

        // 全局状态管理 - Global State Management
        const AppState = {
            isLoading: false,
            currentTheme: 'auto',
            currentContent: 'home',
            retryCount: 0,
            links: []
        };

        // 工具函数 - Utility Functions
        const Utils = {
            // 防抖函数
            debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            },

            // 节流函数
            throttle(func, limit) {
                let inThrottle;
                return function() {
                    const args = arguments;
                    const context = this;
                    if (!inThrottle) {
                        func.apply(context, args);
                        inThrottle = true;
                        setTimeout(() => inThrottle = false, limit);
                    }
                }
            },

            // 延迟执行
            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            },

            // 安全的DOM操作
            safeQuerySelector(selector) {
                try {
                    return document.querySelector(selector);
                } catch (e) {
                    console.warn(`Invalid selector: ${selector}`);
                    return null;
                }
            },

            // 获取域名
            getDomain(url) {
                try {
                    return new URL(url).hostname;
                } catch (e) {
                    console.warn(`Invalid URL: ${url}`);
                    return null;
                }
            }
        };

        // 加载状态管理 - Loading State Management
        const LoadingManager = {
            show(text = '正在加载...') {
                const overlay = document.getElementById('global-loading');
                const loadingText = overlay?.querySelector('.loading-text');
                if (overlay) {
                    if (loadingText) loadingText.textContent = text;
                    overlay.style.display = 'flex';
                    AppState.isLoading = true;
                }
            },

            hide() {
                const overlay = document.getElementById('global-loading');
                if (overlay) {
                    overlay.style.display = 'none';
                    AppState.isLoading = false;
                }
            },

            showSection(sectionId) {
                const section = document.getElementById(`${sectionId}-loading`);
                if (section) section.style.display = 'block';
            },

            hideSection(sectionId) {
                const section = document.getElementById(`${sectionId}-loading`);
                if (section) section.style.display = 'none';
            }
        };

        // 错误处理管理 - Error Handling Management
        const ErrorManager = {
            show(message, type = 'error', duration = CONFIG.ERROR_DISPLAY_TIME) {
                const toast = document.getElementById('error-toast');
                const messageEl = toast?.querySelector('.error-message');
                const iconEl = toast?.querySelector('.error-icon');
                
                if (toast && messageEl && iconEl) {
                    // 清除之前的隐藏计时器和动画类
                    if (this.hideTimer) {
                        clearTimeout(this.hideTimer);
                    }
                    toast.classList.remove('hide');
                    
                    messageEl.textContent = message;
                    iconEl.textContent = type === 'warning' ? '⚠️' : type === 'success' ? '✅' : '❌';
                    toast.className = `error-toast ${type} show`;
                    
                    // 自动隐藏
                    this.hideTimer = setTimeout(() => this.hide(), duration);
                }
            },

            hide() {
                const toast = document.getElementById('error-toast');
                if (toast) {
                    // 添加隐藏动画类
                    toast.classList.add('hide');
                    toast.classList.remove('show');
                    
                    // 动画完成后完全隐藏
                    setTimeout(() => {
                        toast.style.visibility = 'hidden';
                        toast.classList.remove('hide');
                    }, 300); // 与CSS动画时间匹配
                    
                    if (this.hideTimer) {
                        clearTimeout(this.hideTimer);
                        this.hideTimer = null;
                    }
                }
            },

            showSection(sectionId, message, retryCallback) {
                const errorEl = document.getElementById(`${sectionId}-error`);
                const messageEl = errorEl?.querySelector('p');
                const retryBtn = errorEl?.querySelector('.retry-button');
                
                if (errorEl) {
                    if (messageEl) messageEl.textContent = message;
                    if (retryBtn && retryCallback) {
                        retryBtn.onclick = retryCallback;
                    }
                    errorEl.style.display = 'block';
                }
            },

            hideSection(sectionId) {
                const errorEl = document.getElementById(`${sectionId}-error`);
                if (errorEl) errorEl.style.display = 'none';
            }
        };

        // 全局错误处理函数
        window.hideErrorToast = () => ErrorManager.hide();
        window.retryLoadLinks = () => LinkManager.loadWithRetry();

        // 链接管理 - Link Management
        const LinkManager = {
            async load() {
                try {
                    LoadingManager.showSection('link');
                    ErrorManager.hideSection('link');
                    
                    const response = await fetch('./links.json');
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const links = await response.json();
                    if (!Array.isArray(links)) {
                        throw new Error('链接数据格式错误');
                    }
                    
                    AppState.links = links;
                    this.render(links);
                    AppState.retryCount = 0; // 重置重试计数
                    
                } catch (error) {
                    console.error('加载链接失败:', error);
                    this.handleError(error);
                } finally {
                    LoadingManager.hideSection('link');
                }
            },

            async loadWithRetry() {
                if (AppState.retryCount >= CONFIG.RETRY_ATTEMPTS) {
                    ErrorManager.show('重试次数过多，请稍后再试', 'error');
                    return;
                }
                
                AppState.retryCount++;
                await Utils.delay(CONFIG.RETRY_DELAY * AppState.retryCount);
                this.load();
            },

            handleError(error) {
                const message = error.message || '加载链接失败，请检查网络连接';
                ErrorManager.showSection('link', message, () => this.loadWithRetry());
                ErrorManager.show(message, 'error');
            },

            render(links = []) {
                const linkList = document.getElementById('link-list');
                if (!linkList) return;

                linkList.innerHTML = '';
                
                if (links.length === 0) {
                    linkList.innerHTML = '<p style="text-align:center; color: var(--text-secondary);">暂无链接数据</p>';
                    return;
                }

                const fragment = document.createDocumentFragment();
                
                links.forEach(link => {
                    if (!link.url || !link.name) {
                        console.warn('跳过无效链接:', link);
                        return;
                    }
                    
                    const linkItem = this.createLinkElement(link);
                    fragment.appendChild(linkItem);
                });

                linkList.appendChild(fragment);
            },

            createLinkElement(link) {
                const linkItem = document.createElement('a');
                linkItem.href = link.url;
                linkItem.target = '_blank';
                linkItem.className = 'link-item';

                // 创建图标
                const favicon = this.createFaviconElement(link.url);
                linkItem.appendChild(favicon);
                
                // 创建名称
                const nameSpan = document.createElement('span');
                nameSpan.textContent = link.name;
                nameSpan.title = link.name; // 添加工具提示
                linkItem.appendChild(nameSpan);

                return linkItem;
            },

            createFaviconElement(url) {
                const favicon = document.createElement('img');
                favicon.className = 'favicon';
                favicon.loading = 'lazy'; // 添加懒加载
                
                const domain = Utils.getDomain(url);
                if (domain) {
                    favicon.src = `icon/${domain}.png`;
                    favicon.onerror = () => {
                        favicon.src = `https://www.google.com/s2/favicons?domain=${domain}&sz=32`;
                        favicon.onerror = () => {
                            favicon.style.display = 'none';
                        };
                    };
                } else {
                    favicon.style.display = 'none';
                }
                
                return favicon;
            }
        };

        // 主题管理 - Theme Management
        const ThemeManager = {
            init() {
                // 从本地存储恢复主题设置
                const savedTheme = localStorage.getItem('theme') || 'auto';
                this.setTheme(savedTheme);
                this.updateThemeUI(savedTheme);
            },

            setTheme(theme) {
                AppState.currentTheme = theme;
                localStorage.setItem('theme', theme);
                
                if (theme === 'dark') {
                    document.body.classList.add('dark-mode');
                } else if (theme === 'light') {
                    document.body.classList.remove('dark-mode');
                } else {
                    // Auto theme
                    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    document.body.classList.toggle('dark-mode', isDarkMode);
                }
            },

            updateThemeUI(theme) {
                const themeOptions = document.querySelectorAll('.theme-option');
                themeOptions.forEach(option => {
                    option.classList.toggle('active', option.getAttribute('data-theme') === theme);
                });
            },

            toggle() {
                const currentTheme = AppState.currentTheme;
                const nextTheme = currentTheme === 'light' ? 'dark' : 'light';
                this.setTheme(nextTheme);
                this.updateThemeUI(nextTheme);
            }
        };

        // 内容切换管理 - Content Switching Management
        const ContentManager = {
            menuOrder: { 'home': 0, 'search': 1, 'settings': 2 },
            
            switch(targetContent) {
                if (AppState.currentContent === targetContent) return;
                
                const currentIndex = this.menuOrder[AppState.currentContent];
                const targetIndex = this.menuOrder[targetContent];
                const isMovingRight = targetIndex > currentIndex;
                
                this.animateTransition(AppState.currentContent, targetContent, isMovingRight);
                this.updateActiveStates(targetContent);
                
                AppState.currentContent = targetContent;
            },

            animateTransition(currentContent, targetContent, isMovingRight) {
                const currentCard = document.getElementById(`content-${currentContent}`);
                const targetCard = document.getElementById(`content-${targetContent}`);
                
                if (!currentCard || !targetCard) return;
                
                // 添加退出动画
                currentCard.classList.add(isMovingRight ? 'exit-left' : 'exit-right');
                
                setTimeout(() => {
                    // 清理所有状态
                    document.querySelectorAll('.content-card').forEach(card => {
                        card.classList.remove('active', 'prev', 'next', 'from-right', 'from-left', 'exit-left', 'exit-right');
                    });
                    
                    // 激活目标卡片
                    targetCard.classList.add('active');
                    targetCard.classList.add(isMovingRight ? 'from-right' : 'from-left');
                    
                    // 清理动画类
                    setTimeout(() => {
                        targetCard.classList.remove('from-right', 'from-left');
                    }, CONFIG.ANIMATION_DURATION);
                    
                }, 50);
            },

            updateActiveStates(targetContent) {
                // 更新菜单项状态
                document.querySelectorAll('.dock-item').forEach(item => {
                    const isActive = item.getAttribute('data-content') === targetContent;
                    item.classList.toggle('active', isActive);
                });
                
                // 更新气泡位置
                const targetMenuItem = document.querySelector(`.dock-item[data-content="${targetContent}"]`);
                if (targetMenuItem) {
                    DockManager.moveBubbleTo(targetMenuItem);
                }
            }
        };

        // 事件处理管理 - Event Handler Management
        const EventManager = {
            init() {
                this.setupDockEvents();
                this.setupSearchEvents();
                this.setupThemeEvents();
                this.setupKeyboardEvents();
                this.setupGlobalEvents();
            },

            setupDockEvents() {
                const dockItems = document.querySelectorAll('.dock-item');
                dockItems.forEach(item => {
                    item.addEventListener('click', this.handleDockItemClick.bind(this));
                    item.addEventListener('mouseenter', this.handleDockItemHover.bind(this));
                    item.addEventListener('mouseleave', this.handleDockItemLeave.bind(this));
                    
                    // 触摸事件支持
                    if ('ontouchstart' in window) {
                        item.addEventListener('touchstart', this.handleDockItemTouch.bind(this));
                        item.addEventListener('touchend', this.handleDockItemTouchEnd.bind(this));
                    }
                });

                const dock = document.querySelector('.dock');
                if (dock) {
                    dock.addEventListener('mouseenter', this.handleDockHover.bind(this));
                    dock.addEventListener('mouseleave', this.handleDockLeave.bind(this));
                }
            },

            setupSearchEvents() {
                const searchInput = document.getElementById('search-input');
                const searchButton = document.getElementById('search-btn');
                const suggestionTags = document.querySelectorAll('.tag');

                if (searchButton) {
                    searchButton.addEventListener('click', this.handleSearch.bind(this));
                }

                if (searchInput) {
                    searchInput.addEventListener('keypress', this.handleSearchKeyPress.bind(this));
                    searchInput.addEventListener('input', Utils.debounce(this.handleSearchInput.bind(this), 300));
                }

                suggestionTags.forEach(tag => {
                    tag.addEventListener('click', this.handleTagClick.bind(this));
                });
            },

            setupThemeEvents() {
                const themeToggle = document.querySelector('.theme-toggle');
                const themeOptions = document.querySelectorAll('.theme-option');
                
                if (themeToggle) {
                    themeToggle.addEventListener('click', (e) => {
                        e.preventDefault();
                        ThemeManager.toggle();
                    });
                }

                themeOptions.forEach(option => {
                    option.addEventListener('click', this.handleThemeOptionClick.bind(this));
                });
            },

            setupKeyboardEvents() {
                document.addEventListener('keydown', this.handleKeyDown.bind(this));
            },

            setupGlobalEvents() {
                window.addEventListener('scroll', Utils.throttle(this.handleScroll.bind(this), 16));
                window.addEventListener('resize', Utils.debounce(this.handleResize.bind(this), 250));
                
                // 监听系统主题变化
                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', this.handleSystemThemeChange.bind(this));
            },

            // 事件处理方法
            handleDockItemClick(e) {
                e.preventDefault();
                const targetContent = e.currentTarget.getAttribute('data-content');
                ContentManager.switch(targetContent);
            },

            handleDockItemHover(e) {
                DockManager.moveBubbleTo(e.currentTarget);
                DockManager.addMagneticEffect(e.currentTarget);
            },

            handleDockItemLeave(e) {
                DockManager.resetMagneticEffect();
            },

            handleDockItemTouch(e) {
                e.preventDefault();
                DockManager.moveBubbleTo(e.currentTarget);
                e.currentTarget.style.transform = 'scale(0.95)';
            },

            handleDockItemTouchEnd(e) {
                e.preventDefault();
                e.currentTarget.style.transform = '';
                const targetContent = e.currentTarget.getAttribute('data-content');
                ContentManager.switch(targetContent);
            },

            handleDockHover(e) {
                e.currentTarget.style.transform = 'translateX(-50%) translateY(-2px) scale(1.02)';
            },

            handleDockLeave(e) {
                e.currentTarget.style.transform = 'translateX(-50%) translateY(0) scale(1)';
                
                setTimeout(() => {
                    const activeItem = document.querySelector('.dock-item.active');
                    if (activeItem) {
                        DockManager.moveBubbleTo(activeItem);
                    }
                    DockManager.resetMagneticEffect();
                }, 150);
            },

            async handleSearch() {
                const searchInput = document.getElementById('search-input');
                const searchButton = document.getElementById('search-btn');
                const query = searchInput?.value.trim();
                
                if (!query) {
                    ErrorManager.show('请输入搜索内容', 'warning', 2000);
                    return;
                }

                try {
                    this.setSearchLoading(true);
                    await Utils.delay(500); // 模拟搜索延迟
                    window.open(`https://www.google.com/search?q=${encodeURIComponent(query)}`, '_blank');
                } catch (error) {
                    ErrorManager.show('搜索失败，请重试', 'error');
                } finally {
                    this.setSearchLoading(false);
                }
            },

            handleSearchKeyPress(e) {
                if (e.key === 'Enter') {
                    this.handleSearch();
                }
            },

            handleSearchInput(e) {
                // 可以在这里添加搜索建议逻辑
                const query = e.target.value.trim();
                console.log('搜索输入:', query);
            },

            handleTagClick(e) {
                const query = e.target.textContent;
                window.open(`https://www.google.com/search?q=${encodeURIComponent(query)}`, '_blank');
            },

            handleThemeOptionClick(e) {
                const theme = e.currentTarget.getAttribute('data-theme');
                ThemeManager.setTheme(theme);
                ThemeManager.updateThemeUI(theme);
            },

            handleKeyDown(e) {
                // 键盘快捷键
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key) {
                        case '1':
                            e.preventDefault();
                            ContentManager.switch('home');
                            break;
                        case '2':
                            e.preventDefault();
                            ContentManager.switch('search');
                            break;
                        case '3':
                            e.preventDefault();
                            ContentManager.switch('settings');
                            break;
                        case 'd':
                            e.preventDefault();
                            ThemeManager.toggle();
                            break;
                    }
                }
                
                // ESC 键隐藏错误提示
                if (e.key === 'Escape') {
                    ErrorManager.hide();
                }
            },

            handleScroll() {
                const scrolled = window.pageYOffset;
                const parallax = scrolled * CONFIG.PARALLAX_FACTOR;
                const dock = document.querySelector('.dock');
                if (dock) {
                    dock.style.transform = `translateX(-50%) translateY(${parallax}px)`;
                }
            },

            handleResize() {
                // 响应式处理
                console.log('窗口大小改变');
            },

            handleSystemThemeChange(e) {
                if (AppState.currentTheme === 'auto') {
                    document.body.classList.toggle('dark-mode', e.matches);
                }
            },

            setSearchLoading(isLoading) {
                const searchIcon = document.querySelector('.search-icon');
                const searchLoading = document.querySelector('.search-loading');
                const searchButton = document.getElementById('search-btn');
                
                if (searchIcon && searchLoading && searchButton) {
                    searchIcon.style.display = isLoading ? 'none' : 'inline';
                    searchLoading.style.display = isLoading ? 'inline' : 'none';
                    searchButton.disabled = isLoading;
                }
            }
        };
        // Dock管理 - Dock Management
        const DockManager = {
            init() {
                const activeItem = document.querySelector('.dock-item.active');
                if (activeItem) {
                    setTimeout(() => this.moveBubbleTo(activeItem), 100);
                }
            },

            moveBubbleTo(item) {
                if (!item) return;
                
                const bubble = document.querySelector('.dock-bubble');
                const dock = document.querySelector('.dock');
                if (!bubble || !dock) return;
                
                const itemRect = item.getBoundingClientRect();
                const dockRect = dock.getBoundingClientRect();
                const left = itemRect.left - dockRect.left;
                const width = itemRect.width;

                bubble.style.left = `${left}px`;
                bubble.style.width = `${width}px`;
                bubble.style.opacity = '1';
                bubble.style.transform = 'scale(1)';
                
                // 添加发光效果
                const isDarkMode = document.body.classList.contains('dark-mode');
                const glowColor = isDarkMode ? 'rgba(10, 132, 255, 0.2)' : 'rgba(0, 113, 227, 0.15)';
                
                if (item.classList.contains('active')) {
                    bubble.style.boxShadow = `
                        0 4px 16px rgba(0, 0, 0, 0.1),
                        inset 0 1px 1px rgba(255, 255, 255, 0.3),
                        0 0 20px ${glowColor}
                    `;
                } else {
                    bubble.style.boxShadow = `
                        0 4px 16px rgba(0, 0, 0, 0.1),
                        inset 0 1px 1px rgba(255, 255, 255, 0.3)
                    `;
                }
            },

            addMagneticEffect(hoveredItem) {
                const dockItems = document.querySelectorAll('.dock-item');
                const hoveredIndex = Array.from(dockItems).indexOf(hoveredItem);
                
                dockItems.forEach((item, index) => {
                    const distance = Math.abs(index - hoveredIndex);
                    if (distance === 1) {
                        const direction = index < hoveredIndex ? 2 : -2;
                        item.style.transform = `translateX(${direction}px) scale(1.02)`;
                    } else if (distance > 1) {
                        item.style.transform = '';
                    }
                });
            },

            resetMagneticEffect() {
                document.querySelectorAll('.dock-item').forEach(item => {
                    item.style.transform = '';
                });
            },

            hide() {
                const bubble = document.querySelector('.dock-bubble');
                if (bubble) {
                    bubble.style.opacity = '0';
                    bubble.style.transform = 'scale(0.9)';
                }
            }
        };

        // 应用初始化 - Application Initialization
        const App = {
            async init() {
                try {
                    LoadingManager.show('正在初始化应用...');
                    
                    // 预加载关键资源
                    this.preloadResources();
                    
                    // 初始化各个管理器
                    ThemeManager.init();
                    DockManager.init();
                    EventManager.init();
                    
                    // 加载链接数据
                    await LinkManager.load();
                    
                    // 性能优化：预加载图标
                    this.preloadIcons();
                    
                    // 初始化完成
                    LoadingManager.hide();
                    
                    // 显示使用提示（仅首次访问）
                    this.showFirstTimeHints();
                    
                } catch (error) {
                    console.error('应用初始化失败:', error);
                    LoadingManager.hide();
                    ErrorManager.show('应用初始化失败，请刷新页面重试', 'error');
                }
            },

            preloadResources() {
                // 预加载关键CSS和字体
                const criticalResources = [
                    'styles/variables.css',
                    'styles/base.css'
                ];
                
                criticalResources.forEach(href => {
                    const link = document.createElement('link');
                    link.rel = 'preload';
                    link.as = 'style';
                    link.href = href;
                    document.head.appendChild(link);
                });
            },

            preloadIcons() {
                // 预加载常用域名的图标
                const commonDomains = [
                    'google.com', 'github.com', 'baidu.com', 
                    'apple.com.cn', 'microsoft.com'
                ];
                
                commonDomains.forEach(domain => {
                    const img = new Image();
                    img.src = `icon/${domain}.png`;
                    img.onerror = () => {
                        // 如果本地图标不存在，预加载Google图标
                        const fallbackImg = new Image();
                        fallbackImg.src = `https://www.google.com/s2/favicons?domain=${domain}&sz=32`;
                    };
                });
            },

            showFirstTimeHints() {
                const hasVisited = localStorage.getItem('hasVisited');
                if (!hasVisited) {
                    setTimeout(() => {
                        ErrorManager.show('💡 提示：使用 Ctrl/Cmd + 1/2/3 快速切换页面，Ctrl/Cmd + D 切换主题', 'success', 8000);
                        localStorage.setItem('hasVisited', 'true');
                    }, 2000);
                }
            }
        };

        // 页面加载完成后初始化应用
        document.addEventListener('DOMContentLoaded', () => {
            App.init();
        });

        // 兼容旧版本的全局函数
        window.toggleTheme = () => ThemeManager.toggle();
        window.switchContent = (content) => ContentManager.switch(content);
    </script>
</body>
</html>
